Client Deal Pipeline CLI

- Single-file Python 3 script, standard library only. Provides a terminal-based pipeline manager for small-business client deals with stages, values, and follow-up dates.
- Data model:
  - Deal fields: id (int), title (str), client (str), value (float), stage (one of: "Lead", "Qualified", "Proposal", "Negotiation", "Won", "Lost"), owner (str), created_at (ISO datetime), next_action (optional ISO date), notes (str).
  - Persistent storage: one JSON file in the same directory as the script (e.g., "deals.json"). On first run, file is created if missing.
- Command-line interface:
  - Use argparse to implement subcommands: add, list, move, edit, delete, stats, export, undo, redo.
  - General CLI format: `python deals.py <command> [options]`.
  - Global flags: `--data-file PATH` to override default JSON file path; `--compact` for more compact tabular output where applicable.
- Commands:
  - add:
    - Options: `--title`, `--client`, `--value`, `--stage` (default "Lead"), `--owner`, `--next-action`, `--notes`.
    - If any required field is missing, interactively prompt user in the terminal with input().
    - Auto-assign sequential id (1, 2, 3, ...) based on existing deals.
    - Print confirmation including assigned id.
  - list:
    - Options: `--stage`, `--owner`, `--min-value`, `--max-value`, `--search` (substring match across title, client, notes), `--sort` (one of: "value", "stage", "client", "owner", "next_action", "created_at"), `--reverse` (bool).
    - Display deals in a text table: columns at least id, title (truncated), client, value, stage, owner, next_action.
    - Highlight overdue next_action (date before today) with a marker like "!" in a separate column.
    - If `--compact` is set, use shorter column widths and truncate text more aggressively.
  - move:
    - Options: `id` (positional), `--stage` (required).
    - Move deal to a new stage and update internal timestamp for "updated_at" (not shown but stored).
    - Print before/after stage change summary.
  - edit:
    - Options: `id` (positional), optional field flags (`--title`, `--client`, `--value`, `--stage`, `--owner`, `--next-action`, `--notes`).
    - Only update fields that are specified; others remain unchanged.
    - Print summary of changed fields.
  - delete:
    - Options: `id` (positional), `--force` to skip confirmation.
    - By default, ask for "Type DELETE to confirm" before removal.
  - stats:
    - Show aggregated metrics:
      - Count of deals per stage.
      - Total and average value per stage.
      - Sum of all open deals (stages not Won/Lost).
    - Optional flags: `--owner`, `--stage` to filter before computing stats.
  - export:
    - Option: `--format` with choices "json" or "csv", and `--output PATH` (default: print to stdout).
    - JSON export: pretty-printed with indentation.
    - CSV export: header row plus one row per deal.
- Undo/redo system:
  - Maintain an in-memory history stack of states (full deal list snapshots) and a redo stack.
  - After any mutating command (add, move, edit, delete), push previous state onto undo stack and clear redo stack.
  - Commands:
    - undo: revert to previous state if available, move current state to redo stack, print a one-line description of what changed (e.g., "Reverted last add" or generic "Undid last operation").
    - redo: reapply previously undone state if available, move it back to undo stack, print one-line description.
  - Persist the current state only; history stacks are not persisted between runs (undo/redo applies only during current session).
- Persistence behavior:
  - After successful mutating commands and after undo/redo, write entire deal list to JSON file.
  - Use atomic save: write to a temporary file then replace the main file, to reduce corruption risk.
  - On startup, safely handle malformed JSON: back up the broken file (e.g., "deals.json.bak") and start with an empty list, printing a warning to stderr.
- TUI enhancements (simple, text-only):
  - Use clear, predictable text output; avoid special characters that might not render on basic terminals.
  - For `list`, align columns using string formatting; no third-party libraries.
  - Provide a `--plain` global option that disables any additional color codes or styling (if basic ANSI highlighting is implemented).
- Date and time handling:
  - Use datetime and dateutil-like parsing via standard library only (e.g., `datetime.strptime`) with a defined date format such as "YYYY-MM-DD" for next_action and ISO datetime for created_at.
  - Validate user-provided dates; on invalid input from CLI flags, print an error and exit with non-zero status.
- Configuration:
  - Optional simple config file: if a file named ".dealsrc" exists in the userâ€™s home directory, load default values such as default owner and default data file path.
  - Format: INI via configparser with a `[defaults]` section and keys like `owner` and `data_file`.
  - Command-line arguments always override config values.
- Discoverability and help:
  - Implement argparse help text for each subcommand, including a brief example usage.
  - If script is run with no arguments, print a short usage overview and the most common commands with one-line descriptions.
- Testing hooks:
  - Provide an environment variable (e.g., DEALS_DATA_FILE) that, if set, overrides the default storage path, allowing easy testing in temporary directories.
  - Implement a `--no-save` global flag that keeps all operations in memory for the session without touching the filesystem (useful for dry-run/testing).
- Code structure:
  - Organize main logic under `if __name__ == "__main__":` using a main() function.
  - Separate concerns into small functions: loading/saving data, command dispatch, validation, formatting.
  - Avoid external dependencies; use only standard library modules such as argparse, json, os, sys, datetime, pathlib, configparser, tempfile, shutil, and textwrap.

(Generated: 2026-01-12T01:43:42.868117Z, seed=59780, theme=small business utilities, extras=dark/light auto theme, share via URL hash, undo/redo, kind=py)
