Pocket Invoice Studio

- Purpose: Single-file offline-first web app (one HTML file with inline CSS+JS) to create, edit, and send simple single-page invoices and estimates for small businesses; includes client/items library, PDF export via browser print, undo/redo, drag-and-drop line reordering, and persistent localStorage save with optional JSON export/import for backups. 

- UI & layout (must fit one file, responsive):
  - Top toolbar with app title, New Invoice, Save, Export JSON, Import JSON, Print (PDF), and Online status indicator. Keyboard-accessible buttons with aria-labels.
  - Left pane: Client list (compact) with Add/Edit/Delete client modal. Right/main pane: Invoice editor (header fields, client selector, invoice number auto-sequence, date, due date, notes, tax percent).
  - Invoice body: editable line items table (description, qty, unit price, discount%, line total). Support adding a blank line, duplicating a line, and deleting line. Lines must be reorderable by dragging a visible grab-handle.
  - Footer: computed subtotal, tax, total; Undo and Redo buttons with keyboard shortcuts (Ctrl+Z / Ctrl+Y). Visible sync/dirty indicator when unsaved changes exist.

- Data model (store as JSON in localStorage under key "pocket-invoice-v1"):
  - metadata: lastInvoiceNumber (int), autoSave (boolean)
  - clients: array of {id, name, company, email, phone, address}
  - invoices: array of {id, number, date, dueDate, clientId, items[], taxPercent, notes, createdAt, updatedAt, status}
  - items in invoice: {id, description, qty (number), unitPrice (number), discountPercent (number), position (int)}
  - changeQueue: for undo/redo maintain a capped history stack in memory and persist last index to localStorage.

- Core features (must be implementable in one HTML file):
  - Offline-first persistence: all edits immediately update localStorage (single-source-of-truth). Edits are applied to local model then persisted. Provide atomic save function that serializes to JSON and writes to localStorage with a timestamp.
  - Auto-sequence invoice numbers: New invoice increments lastInvoiceNumber and stores it.
  - Undo/Redo: Action-based history of user operations (add/edit/delete/reorder lines, client changes, invoice field changes). Keep history size configurable (default 50). Undo/Redo must update UI and persist state.
  - Drag-and-drop lines: Use HTML5 drag-and-drop to reorder invoice lines; update positions and push reorder event to history.
  - Inline validation: numeric fields validate on input (qty >=0, price >=0, discount 0–100). Show accessible error hints.
  - Keyboard accessibility:
    - Alt+N: New Invoice, Alt+S: Save, Ctrl+Z / Ctrl+Y: Undo/Redo, Enter in client selector to open client edit, Arrow keys navigate between line cells, Delete key removes focused line if focused on line row.
    - All interactive controls must have tabindex and aria attributes.
  - Export/Import:
    - Export JSON: download full local dataset as timestamped JSON file.
    - Import JSON: allow user to select JSON file and merge or replace data (confirm dialog). Validate schema and show errors.
  - Print to PDF: Format invoice for print (clean CSS print rules) and call window.print(); include "Print" toolbar button and keyboard shortcut (Ctrl+P).
  - Offline/online hint: Listen to navigator.onLine and show status; when back online, attempt to invoke a user-defined sync hook (no network implementation required) and mark as synced.
  - Storage quota warning: Use navigator.storage.estimate() when available; display a non-blocking warning if usage > 80%.
  - Lightweight client/item library: ability to drag a saved product/item from a "Saved Items" list onto invoice to create a line populated with saved values.
  - Small-business niceties:
    - Mark invoice status (Draft / Sent / Paid).
    - Quick-send simulated flow: clicking Send changes status to Sent and marks sentAt; show confirmation and checkbox to include notes. (No actual email; provide copy-to-clipboard of printable invoice HTML).
    - Simple tax handling: global taxPercent per invoice and optional per-line override.
  - Accessibility: semantic HTML, high-contrast focus outlines, labels for form controls, modals trap focus, ARIA live region for status messages (save/undo/validation).
  - Performance & size: Keep DOM minimal; limit localStorage size by capping history; debounce autosave (300ms) during rapid edits.

- Implementation notes for developer (precise, no external libs):
  - Single HTML file must include CSS variables for theme, responsive grid. Use flexbox for layout.
  - Use a single JS module block with clear sections: storage layer (load/save/backup), model layer (create/update/delete/invoice/clients), UI layer (render lists, render invoice, bind events), history manager (push/undo/redo), drag-and-drop handlers, import/export, print stylesheet.
  - Serialize dates as ISO strings. Use small utility IDs (prefixed timestamps).
  - Provide clear error handling and user messages in the ARIA live region.
  - Ensure all file interactions use the browser File API for import/export; no network calls.
  - Include at least one sample client and one sample saved item inserted on first-run bootstrap.

- Testable acceptance criteria:
  - Opening the file initializes data (bootstrap sample if none).
  - Create a new invoice: invoice number increments and persists across reloads.
  - Add three lines, reorder via drag-and-drop, undo twice, redo once — UI and stored JSON reflect each step.
  - Export JSON, then clear app (via a Reset button), then Import JSON and verify data restored.
  - Print outputs a printer-friendly invoice layout.
  - Storage quota warning appears when storage estimate >80% (simulate by mocking if needed).
  - Keyboard shortcuts function as specified and modals trap focus.

- Constraints:
  - Single HTML file, no external libraries or network requests.
  - Implementable in under ~1000 lines of code.
  - Keep UI simple and focused on functionality; styling modest but accessible.

(Generated: 2025-12-19T12:38:45.446195Z, seed=46228, theme=small business utilities, extras=offline-first with localStorage, undo/redo, drag-and-drop, kind=html)
