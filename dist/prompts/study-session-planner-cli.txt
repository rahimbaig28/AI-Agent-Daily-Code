Study Session Planner CLI

- Purpose: Single-file Python 3 command-line app to plan, track, and review study sessions with a focus on keyboard-only use and print-friendly text reports.

- Environment & constraints:
  - Python 3 standard library only (no third-party packages).
  - Runs as a single script, storing data in a JSON file in the user’s home directory (e.g., ~/.study_sessions.json on POSIX, %USERPROFILE%\.study_sessions.json on Windows).
  - Pure terminal I/O, no GUI.
  - Must be usable entirely by keyboard with clear prompts and short command names.

- Data model:
  - Study session:
    - id (integer, auto-increment).
    - date (ISO string yyyy-mm-dd).
    - start_time (HH:MM, 24h).
    - end_time (HH:MM, 24h).
    - duration_minutes (int, computed).
    - subject (string).
    - tags (list of strings, e.g., ["math", "review"]).
    - notes (string, free text).
    - focus_rating (int 1–5).
  - Subject summary:
    - Computed in-memory only from sessions: total_minutes, session_count, average_focus.
  - Config:
    - Stored in same JSON file:
      - time_format ("24h" or "12h") for display only.
      - default_print_width (int, e.g., 80).
      - default_daily_goal_minutes (int).

- Storage:
  - Single JSON file with top-level keys: "sessions" (list of session objects) and "config" (dict).
  - On startup:
    - If file missing, create with empty sessions list and default config.
    - If corrupted JSON, back up to a .bak file and start with fresh data, informing user.
  - On each data-changing operation, write out atomically:
    - Write to a temporary file then replace original to avoid data loss.

- CLI entry point:
  - Use argparse to support subcommands:
    - add, list, edit, delete, summary, today, subject, print, config, import, export.
  - If run with no arguments, start an interactive prompt loop (REPL-like), accepting the same subcommand names.
  - Standard usage:
    - study.py add
    - study.py list --date 2026-01-10
    - study.py summary --week
  - Help:
    - study.py -h (global help).
    - study.py add -h, etc. for subcommands.

- Core commands:

  - add:
    - Prompts user interactively (one line at a time) for:
      - date (default: today).
      - start_time and end_time; validate and compute duration.
      - subject (required).
      - tags (comma-separated, optional).
      - focus_rating (1–5, optional).
      - notes (multi-line, end on blank line or EOF).
    - Allows providing some fields via CLI flags:
      - --date, --start, --end, --subject, --tags, --focus.
    - Displays a summary of the entry and asks for confirmation (y/n) before saving.

  - list:
    - Options:
      - --date DATE: show sessions for that date only.
      - --from DATE --to DATE: inclusive range.
      - --subject SUBJECT: filter by subject (case-insensitive).
      - --tag TAG: filter by sessions that include TAG.
    - Output:
      - Tabular text: id, date, time range, duration, subject, focus_rating, tags.
      - At bottom: total sessions and total minutes for the filtered set.
    - Sorted by date then start_time.

  - edit:
    - Arguments:
      - edit ID (required).
    - Shows existing session fields and allows selective editing:
      - Prompt for each field with current value in brackets; Enter keeps value.
    - Recomputes duration if times change.
    - Shows final session and asks for confirmation before saving.

  - delete:
    - Arguments:
      - delete ID
    - Confirms deletion by showing brief details and asking y/n.
    - Offers optional --force to skip confirmation.

  - summary:
    - Options:
      - --day DATE (default: today).
      - --week [ISO_WEEK or "this"], --month [YYYY-MM or "this"], only one of day/week/month allowed.
    - Shows:
      - Total minutes and hours.
      - Total sessions.
      - Top subjects by total minutes.
      - Average focus_rating over the period.
    - Displays progress against daily_goal_minutes for day or average per day for week/month.

  - today:
    - Shortcut for summary --day today plus list --date today.
    - Displays:
      - All of today’s sessions in table.
      - Today’s total minutes vs daily goal with a simple text progress bar:
        - e.g., [#####-----] 50% (150/300 min).

  - subject:
    - Options:
      - Required: SUBJECT name.
      - Optional: --from DATE, --to DATE.
    - Shows per-subject stats:
      - Total minutes, number of sessions.
      - Average focus_rating.
      - Last 5 sessions (date, duration, focus_rating).

  - print:
    - Generates a print-friendly plain-text report.
    - Options:
      - --day DATE or --from DATE --to DATE.
      - --subject SUBJECT (optional filter).
      - --width N to override default_print_width.
    - Output characteristics:
      - No color, no box-drawing characters; just ASCII.
      - Clear section headers using underlines with = or -.
      - Includes:
        - Time period description.
        - Aggregate statistics.
        - Chronological session list with wrapped notes trimmed or wrapped to width.
      - When run non-interactively, prints report to stdout, allowing redirection to a file for printing.

  - config:
    - Sub-options:
      - config show: prints current configuration.
      - config set key value:
        - Allowed keys: time_format, default_print_width, default_daily_goal_minutes.
    - Validates values and persists them.

  - import:
    - Reads JSON data from a specified file path.
    - Supports:
      - Full export format (sessions + config).
      - Minimal format: list of sessions only.
    - On conflict:
      - If an imported session has an ID colliding with existing, assign a new ID.
    - Requires confirmation and displays count of imported sessions.

  - export:
    - Writes current data to a specified file path.
    - Options:
      - --sessions-only: export only sessions.
    - Uses pretty-printed JSON for human inspection.

- Interactive REPL mode:
  - Triggered when script is run without arguments.
  - Features:
    - Simple prompt, e.g., "study> ".
    - Commands: same subcommand names (add, list, summary, today, etc.) and "help", "quit", "exit".
    - Supports command history and line editing if readline is available; otherwise falls back gracefully.
  - Shortcuts:
    - t => today
    - s => summary
    - a => add
    - l => list
  - Error feedback:
    - For unknown commands, show "Unknown command; type 'help' for options."

- Keyboard-first UX details:
  - All input through stdin; no reliance on mouse.
  - Short, memorable subcommands and one-letter aliases in REPL.
  - For yes/no prompts, allow "y", "n", "Y", "N", and default on Enter (displayed in prompt, e.g., [Y/n]).
  - Provide minimal keystrokes for common paths:
    - Default current date and time suggestions where possible.
    - Allow quick acceptance of defaults by pressing Enter.

- Validation and error handling:
  - Date parsing:
    - Accept yyyy-mm-dd; also allow "today", "yesterday" in interactive mode.
    - On invalid date, display error and re-prompt in interactive flow; exit with non-zero code for CLI-only calls.
  - Time parsing:
    - Accept HH:MM 24h strictly.
    - Ensure end_time is after start_time; otherwise re-prompt or reject.
  - Focus rating:
    - Enforce integer 1–5; re-prompt if invalid.
  - IDs:
    - If given ID does not exist for edit/delete, show a clear message and list nearby IDs optionally.
  - File errors:
    - If data file not writable, print error to stderr and exit with non-zero code.

- Implementation notes:
  - Use:
    - argparse for CLI structure.
    - json and pathlib/os for storage.
    - datetime for dates and durations.
    - textwrap for wrapping print reports.
    - shutil for atomic file replacement (move temporary to final).
    - readline (if available) to enhance REPL; import conditionally.
  - Structure:
    - main() parses initial arguments.
    - Separate functions for each subcommand, receiving parsed args and shared data.
    - Shared helper for loading/saving data and generating next session id.

- Testable behaviors (examples):
  - Running "python study.py add" then "python study.py today" shows the newly added session and updates total time.
  - "python study.py summary --week this" prints total minutes > 0 if there are sessions this week.
  - "python study.py export backup.json" creates a readable JSON file with sessions and config.
  - In REPL mode, typing "a" then adding a session, then "t" shows that session in today's summary.

(Generated: 2026-01-11T01:47:01.213047Z, seed=29048, theme=learning & study tools, extras=keyboard-first UX, print-friendly view, offline-first with localStorage, kind=py)
