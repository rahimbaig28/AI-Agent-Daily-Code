<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-12-10T04:33:39.825168Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Small Business Invoice Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 1rem;
    max-width: 700px;
  }
  h1 {
    text-align: center;
  }
  label {
    display: block;
    margin-top: 0.8rem;
    font-weight: bold;
  }
  input[type="text"], input[type="number"], input[type="date"] {
    width: 100%;
    padding: 0.3rem;
    margin-top: 0.2rem;
    box-sizing: border-box;
  }
  button {
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    cursor: pointer;
  }
  .line-item {
    border: 1px solid #ccc;
    padding: 0.5rem;
    margin-top: 0.5rem;
    position: relative;
  }
  .line-item > button.remove-item {
    position: absolute;
    top: 0.3rem;
    right: 0.3rem;
    background: #e74c3c;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 3px;
    padding: 0 0.4rem;
  }
  .error {
    color: #e74c3c;
    font-weight: bold;
  }
  pre {
    background: #f4f4f4;
    padding: 1rem;
    white-space: pre-wrap;
    max-height: 300px;
    overflow-y: auto;
  }
  nav {
    margin-bottom: 1rem;
  }
  nav button {
    margin-right: 0.5rem;
  }
  .hidden {
    display: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.5rem;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 0.3rem 0.5rem;
    text-align: left;
  }
  th {
    background: #f0f0f0;
  }
  .footer {
    margin-top: 2rem;
    font-size: 0.8rem;
    color: #666;
    text-align: center;
  }
</style>
</head>
<body>
<h1>Small Business Invoice Generator</h1>
<nav role="navigation" aria-label="Main menu">
  <button id="btn-create" aria-controls="section-create" aria-expanded="false">Create Invoice</button>
  <button id="btn-list" aria-controls="section-list" aria-expanded="false">List Invoices</button>
  <button id="btn-view" aria-controls="section-view" aria-expanded="false">View Invoice</button>
  <button id="btn-delete" aria-controls="section-delete" aria-expanded="false">Delete Invoice</button>
  <button id="btn-export" aria-controls="section-export" aria-expanded="false">Export Invoice</button>
</nav>

<section id="section-create" class="hidden" aria-label="Create new invoice">
  <form id="form-create" novalidate>
    <fieldset>
      <legend>Client Details</legend>
      <label for="client-name">Client Name *</label>
      <input type="text" id="client-name" name="clientName" required autocomplete="off" />
      <label for="client-email">Client Email</label>
      <input type="text" id="client-email" name="clientEmail" autocomplete="off" />
      <label for="invoice-date">Invoice Date *</label>
      <input type="date" id="invoice-date" name="invoiceDate" required />
    </fieldset>

    <fieldset>
      <legend>Invoice Items</legend>
      <div id="items-container" aria-live="polite"></div>
      <button type="button" id="btn-add-item">Add Line Item</button>
    </fieldset>

    <fieldset>
      <legend>Tax & Summary</legend>
      <label for="tax-rate">Tax Rate (%) *</label>
      <input type="number" id="tax-rate" name="taxRate" min="0" step="0.01" value="0" required />
      <div>
        <strong>Subtotal:</strong> $<span id="subtotal">0.00</span><br />
        <strong>Tax:</strong> $<span id="tax-amount">0.00</span><br />
        <strong>Grand Total:</strong> $<span id="grand-total">0.00</span>
      </div>
    </fieldset>

    <button type="submit">Save Invoice</button>
    <div id="create-error" class="error" role="alert" aria-live="assertive"></div>
    <div id="create-success" role="status" aria-live="polite" style="color:green;"></div>
  </form>
</section>

<section id="section-list" class="hidden" aria-label="List all invoices">
  <h2>Saved Invoices</h2>
  <table id="invoice-list-table" aria-describedby="list-desc">
    <caption id="list-desc">List of saved invoices with ID, client name, date, and total amount</caption>
    <thead>
      <tr>
        <th>Invoice ID</th>
        <th>Client Name</th>
        <th>Date</th>
        <th>Total Amount ($)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="list-empty" role="alert" aria-live="polite" class="error hidden">No invoices saved.</div>
</section>

<section id="section-view" class="hidden" aria-label="View invoice details">
  <h2>View Invoice</h2>
  <form id="form-view">
    <label for="view-invoice-id">Enter Invoice ID *</label>
    <input type="text" id="view-invoice-id" name="viewInvoiceId" required autocomplete="off" />
    <button type="submit">View</button>
  </form>
  <pre id="view-output" tabindex="0" aria-live="polite"></pre>
  <div id="view-error" class="error" role="alert" aria-live="assertive"></div>
</section>

<section id="section-delete" class="hidden" aria-label="Delete invoice">
  <h2>Delete Invoice</h2>
  <form id="form-delete">
    <label for="delete-invoice-id">Enter Invoice ID *</label>
    <input type="text" id="delete-invoice-id" name="deleteInvoiceId" required autocomplete="off" />
    <button type="submit">Delete</button>
  </form>
  <div id="delete-error" class="error" role="alert" aria-live="assertive"></div>
  <div id="delete-success" role="status" aria-live="polite" style="color:green;"></div>
</section>

<section id="section-export" class="hidden" aria-label="Export invoice to text file">
  <h2>Export Invoice</h2>
  <form id="form-export">
    <label for="export-invoice-id">Enter Invoice ID *</label>
    <input type="text" id="export-invoice-id" name="exportInvoiceId" required autocomplete="off" />
    <button type="submit">Export</button>
  </form>
  <div id="export-error" class="error" role="alert" aria-live="assertive"></div>
  <div id="export-success" role="status" aria-live="polite" style="color:green;"></div>
</section>

<div class="footer" role="contentinfo">
  &copy; Small Business Invoice Generator
</div>

<script>
  (() => {
    "use strict";

    // Storage key
    const STORAGE_KEY = "invoices_data";

    // Elements
    const sections = {
      create: document.getElementById("section-create"),
      list: document.getElementById("section-list"),
      view: document.getElementById("section-view"),
      delete: document.getElementById("section-delete"),
      export: document.getElementById("section-export"),
    };
    const navButtons = {
      create: document.getElementById("btn-create"),
      list: document.getElementById("btn-list"),
      view: document.getElementById("btn-view"),
      delete: document.getElementById("btn-delete"),
      export: document.getElementById("btn-export"),
    };

    // Create invoice form elements
    const formCreate = document.getElementById("form-create");
    const clientNameInput = document.getElementById("client-name");
    const clientEmailInput = document.getElementById("client-email");
    const invoiceDateInput = document.getElementById("invoice-date");
    const taxRateInput = document.getElementById("tax-rate");
    const itemsContainer = document.getElementById("items-container");
    const btnAddItem = document.getElementById("btn-add-item");
    const subtotalSpan = document.getElementById("subtotal");
    const taxAmountSpan = document.getElementById("tax-amount");
    const grandTotalSpan = document.getElementById("grand-total");
    const createError = document.getElementById("create-error");
    const createSuccess = document.getElementById("create-success");

    // List invoices
    const invoiceListTableBody = document.querySelector("#invoice-list-table tbody");
    const listEmpty = document.getElementById("list-empty");

    // View invoice
    const formView = document.getElementById("form-view");
    const viewInvoiceIdInput = document.getElementById("view-invoice-id");
    const viewOutput = document.getElementById("view-output");
    const viewError = document.getElementById("view-error");

    // Delete invoice
    const formDelete = document.getElementById("form-delete");
    const deleteInvoiceIdInput = document.getElementById("delete-invoice-id");
    const deleteError = document.getElementById("delete-error");
    const deleteSuccess = document.getElementById("delete-success");

    // Export invoice
    const formExport = document.getElementById("form-export");
    const exportInvoiceIdInput = document.getElementById("export-invoice-id");
    const exportError = document.getElementById("export-error");
    const exportSuccess = document.getElementById("export-success");

    // Utility: Load invoices from localStorage
    function loadInvoices() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch {
        return {};
      }
    }

    // Utility: Save invoices to localStorage
    function saveInvoices(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Generate unique invoice ID (simple incremental or UUID-like)
    function generateInvoiceID() {
      const invoices = loadInvoices();
      const keys = Object.keys(invoices);
      if (keys.length === 0) return "INV-1000";
      // Find max numeric suffix
      let maxNum = 1000;
      keys.forEach(k => {
        const m = k.match(/^INV-(\d+)$/);
        if (m) {
          const n = parseInt(m[1], 10);
          if (n > maxNum) maxNum = n;
        }
      });
      return `INV-${maxNum + 1}`;
    }

    // Format date YYYY-MM-DD to readable
    function formatDate(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr);
      if (isNaN(d)) return dateStr;
      return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" });
    }

    // Format number as currency string with 2 decimals
    function formatCurrency(num) {
      return num.toFixed(2);
    }

    // Create a new line item element
    function createLineItemElement(index, data = {}) {
      const div = document.createElement("div");
      div.className = "line-item";
      div.setAttribute("data-index", index);

      const labelDesc = document.createElement("label");
      labelDesc.textContent = `Description *`;
      labelDesc.htmlFor = `item-desc-${index}`;
      const inputDesc = document.createElement("input");
      inputDesc.type = "text";
      inputDesc.id = `item-desc-${index}`;
      inputDesc.name = `itemDesc${index}`;
      inputDesc.required = true;
      inputDesc.autocomplete = "off";
      inputDesc.value = data.description || "";

      const labelQty = document.createElement("label");
      labelQty.textContent = `Quantity *`;
      labelQty.htmlFor = `item-qty-${index}`;
      const inputQty = document.createElement("input");
      inputQty.type = "number";
      inputQty.id = `item-qty-${index}`;
      inputQty.name = `itemQty${index}`;
      inputQty.min = "0.01";
      inputQty.step = "0.01";
      inputQty.required = true;
      inputQty.value = data.quantity !== undefined ? data.quantity : "";

      const labelPrice = document.createElement("label");
      labelPrice.textContent = `Price per unit ($) *`;
      labelPrice.htmlFor = `item-price-${index}`;
      const inputPrice = document.createElement("input");
      inputPrice.type = "number";
      inputPrice.id = `item-price-${index}`;
      inputPrice.name = `itemPrice${index}`;
      inputPrice.min = "0";
      inputPrice.step = "0.01";
      inputPrice.required = true;
      inputPrice.value = data.price !== undefined ? data.price : "";

      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.className = "remove-item";
      removeBtn.setAttribute("aria-label", `Remove line item ${index + 1}`);
      removeBtn.textContent = "Ã—";

      removeBtn.addEventListener("click", () => {
        div.remove();
        updateTotals();
      });

      div.appendChild(removeBtn);
      div.appendChild(labelDesc);
      div.appendChild(inputDesc);
      div.appendChild(labelQty);
      div.appendChild(inputQty);
      div.appendChild(labelPrice);
      div.appendChild(inputPrice);

      // Update totals on input change
      [inputQty, inputPrice].forEach(input => {
        input.addEventListener("input", updateTotals);
      });

      return div;
    }

    // Add a new empty line item
    function addLineItem(data) {
      const index = itemsContainer.children.length;
      const itemEl = createLineItemElement(index, data);
      itemsContainer.appendChild(itemEl);
      updateTotals();
    }

    // Get all line items data from form
    function getLineItemsData() {
      const items = [];
      const children = itemsContainer.children;
      for (let i = 0; i < children.length; i++) {
        const div = children[i];
        const desc = div.querySelector(`input[name=itemDesc${i}]`).value.trim();
        const qtyStr = div.querySelector(`input[name=itemQty${i}]`).value.trim();
        const priceStr = div.querySelector(`input[name=itemPrice${i}]`).value.trim();
        if (!desc) continue;
        const qty = parseFloat(qtyStr);
        const price = parseFloat(priceStr);
        if (isNaN(qty) || isNaN(price)) continue;
        items.push({ description: desc, quantity: qty, price: price });
      }
      return items;
    }

    // Calculate and update subtotal, tax, grand total
    function updateTotals() {
      const items = getLineItemsData();
      let subtotal = 0;
      items.forEach(item => {
        subtotal += item.quantity * item.price;
      });
      const taxRate = parseFloat(taxRateInput.value);
      const tax = isNaN(taxRate) ? 0 : (subtotal * taxRate) / 100;
      const grandTotal = subtotal + tax;

      subtotalSpan.textContent = formatCurrency(subtotal);
      taxAmountSpan.textContent = formatCurrency(tax);
      grandTotalSpan.textContent = formatCurrency(grandTotal);
    }

    // Clear create form
    function clearCreateForm() {
      clientNameInput.value = "";
      clientEmailInput.value = "";
      invoiceDateInput.value = "";
      taxRateInput.value = "0";
      itemsContainer.innerHTML = "";
      addLineItem();
      updateTotals();
      createError.textContent = "";
      createSuccess.textContent = "";
    }

    // Validate create form inputs
    function validateCreateForm() {
      createError.textContent = "";
      if (!clientNameInput.value.trim()) {
        createError.textContent = "Client name is required.";
        clientNameInput.focus();
        return false;
      }
      if (!invoiceDateInput.value) {
        createError.textContent = "Invoice date is required.";
        invoiceDateInput.focus();
        return false;
      }
      const taxVal = parseFloat(taxRateInput.value);
      if (isNaN(taxVal) || taxVal < 0) {
        createError.textContent = "Tax rate must be a non-negative number.";
        taxRateInput.focus();
        return false;
      }
      const items = getLineItemsData();
      if (items.length === 0) {
        createError.textContent = "At least one valid line item is required.";
        return false;
      }
      for (let i = 0; i < items.length; i++) {
        const item = items[i];
        if (!item.description) {
          createError.textContent = `Description is required for line item ${i + 1}.`;
          return false;
        }
        if (!(item.quantity > 0)) {
          createError.textContent = `Quantity must be positive for line item ${i + 1}.`;
          return false;
        }
        if (!(item.price >= 0)) {
          createError.textContent = `Price must be zero or positive for line item ${i + 1}.`;
          return false;
        }
      }
      return true;
    }

    // Save invoice data to localStorage
    function saveInvoice(invoice) {
      const invoices = loadInvoices();
      invoices[invoice.id] = invoice;
      saveInvoices(invoices);
    }

    // Format invoice details as plain text
    function formatInvoiceText(invoice) {
      const lines = [];
      lines.push(`Invoice ID: ${invoice.id}`);
      lines.push(`Date: ${formatDate(invoice.date)}`);
      lines.push(`Client: ${invoice.clientName}`);
      if (invoice.clientEmail) lines.push(`Client Email: ${invoice.clientEmail}`);
      lines.push("");
      lines.push("Items:");
      lines.push("------------------------------------------------------------");
      lines.push("Qty  Description                     Price       Line Total");
      lines.push("------------------------------------------------------------");
      invoice.items.forEach(item => {
        const qty = item.quantity.toFixed(2).padStart(4);
        const desc = item.description.padEnd(30).slice(0,30);
        const price = item.price.toFixed(2).padStart(10);
        const lineTotal = (item.quantity * item.price).toFixed(2).padStart(10);
        lines.push(`${qty}  ${desc}  ${price}  ${lineTotal}`);
      });
      lines.push("------------------------------------------------------------");
      lines.push(`Subtotal: $${invoice.subtotal.toFixed(2)}`);
      lines.push(`Tax (${invoice.taxRate.toFixed(2)}%): $${invoice.taxAmount.toFixed(2)}`);
      lines.push(`Grand Total: $${invoice.grandTotal.toFixed(2)}`);
      return lines.join("\n");
    }

    // Show only one section at a time
    function showSection(name) {
      Object.entries(sections).forEach(([key, sec]) => {
        const isActive = key === name;
        sec.classList.toggle("hidden", !isActive);
        navButtons[key].setAttribute("aria-expanded", isActive ? "true" : "false");
      });
      // Clear messages and outputs on section change
      createError.textContent = "";
      createSuccess.textContent = "";
      viewError.textContent = "";
      viewOutput.textContent = "";
      deleteError.textContent = "";
      deleteSuccess.textContent = "";
      exportError.textContent = "";
      exportSuccess.textContent = "";
      if (name === "create") {
        clearCreateForm();
        invoiceDateInput.valueAsDate = new Date();
      }
      if (name === "list") {
        renderInvoiceList();
      }
    }

    // Render invoice list table
    function renderInvoiceList() {
      const invoices = loadInvoices();
      const keys = Object.keys(invoices).sort();
      invoiceListTableBody.innerHTML = "";
      if (keys.length === 0) {
        listEmpty.classList.remove("hidden");
        return;
      }
      listEmpty.classList.add("hidden");
      keys.forEach(id => {
        const inv = invoices[id];
        const tr = document.createElement("tr");
        const tdId = document.createElement("td");
        tdId.textContent = inv.id;
        const tdClient = document.createElement("td");
        tdClient.textContent = inv.clientName;
        const tdDate = document.createElement("td");
        tdDate.textContent = formatDate(inv.date);
        const tdTotal = document.createElement("td");
        tdTotal.textContent = inv.grandTotal.toFixed(2);
        tr.appendChild(tdId);
        tr.appendChild(tdClient);
        tr.appendChild(tdDate);
        tr.appendChild(tdTotal);
        invoiceListTableBody.appendChild(tr);
      });
    }

    // Get invoice by ID or null
    function getInvoiceById(id) {
      const invoices = loadInvoices();
      return invoices[id] || null;
    }

    // Delete invoice by ID, return true if deleted
    function deleteInvoiceById(id) {
      const invoices = loadInvoices();
      if (!invoices[id]) return false;
      delete invoices[id];
      saveInvoices(invoices);
      return true;
    }

    // Export invoice text file download
    function exportInvoiceToFile(invoice) {
      const text = formatInvoiceText(invoice);
      const blob = new Blob([text], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `${invoice.id}.txt`;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    // Event handlers

    // Navigation buttons
    Object.entries(navButtons).forEach(([key, btn]) => {
      btn.addEventListener("click", () => {
        showSection(key);
        btn.focus();
      });
    });

    // Add initial line item on create form load
    btnAddItem.addEventListener("click", () => {
      addLineItem();
    });

    // Update totals on tax rate change
    taxRateInput.addEventListener("input", updateTotals);

    // Create invoice form submit
    formCreate.addEventListener("submit", e => {
      e.preventDefault();
      createError.textContent = "";
      createSuccess.textContent = "";
      if (!validateCreateForm()) return;

      const clientName = clientNameInput.value.trim();
      const clientEmail = clientEmailInput.value.trim();
      const date = invoiceDateInput.value;
      const taxRate = parseFloat(taxRateInput.value);
      const items = getLineItemsData();

      let subtotal = 0;
      items.forEach(item => {
        subtotal += item.quantity * item.price;
      });
      const taxAmount = (subtotal * taxRate) / 100;
      const grandTotal = subtotal + taxAmount;

      const id = generateInvoiceID();

      const invoice = {
        id,
        clientName,
        clientEmail,
        date,
        taxRate,
        items,
        subtotal,
        taxAmount,
        grandTotal,
      };

      saveInvoice(invoice);
      createSuccess.textContent = `Invoice ${id} saved successfully.`;
      clearCreateForm();
      invoiceDateInput.valueAsDate = new Date();
    });

    // View invoice form submit
    formView.addEventListener("submit", e => {
      e.preventDefault();
      viewError.textContent = "";
      viewOutput.textContent = "";
      const id = viewInvoiceIdInput.value.trim();
      if (!id) {
        viewError.textContent = "Invoice ID is required.";
        viewInvoiceIdInput.focus();
        return;
      }
      const invoice = getInvoiceById(id);
      if (!invoice) {
        viewError.textContent = `Invoice ID "${id}" not found.`;
        return;
      }
      viewOutput.textContent = formatInvoiceText(invoice);
    });

    // Delete invoice form submit
    formDelete.addEventListener("submit", e => {
      e.preventDefault();
      deleteError.textContent = "";
      deleteSuccess.textContent = "";
      const id = deleteInvoiceIdInput.value.trim();
      if (!id) {
        deleteError.textContent = "Invoice ID is required.";
        deleteInvoiceIdInput.focus();
        return;
      }
      if (!getInvoiceById(id)) {
        deleteError.textContent = `Invoice ID "${id}" not found.`;
        return;
      }
      if (deleteInvoiceById(id)) {
        deleteSuccess.textContent = `Invoice ${id} deleted successfully.`;
        deleteInvoiceIdInput.value = "";
      } else {
        deleteError.textContent = `Failed to delete invoice ${id}.`;
      }
    });

    // Export invoice form submit
    formExport.addEventListener("submit", e => {
      e.preventDefault();
      exportError.textContent = "";
      exportSuccess.textContent = "";
      const id = exportInvoiceIdInput.value.trim();
      if (!id) {
        exportError.textContent = "Invoice ID is required.";
        exportInvoiceIdInput.focus();
        return;
      }
      const invoice = getInvoiceById(id);
      if (!invoice) {
        exportError.textContent = `Invoice ID "${id}" not found.`;
        return;
      }
      try {
        exportInvoiceToFile(invoice);
        exportSuccess.textContent = `Invoice ${id} exported as text file.`;
        exportInvoiceIdInput.value = "";
      } catch (err) {
        exportError.textContent = `Failed to export invoice ${id}.`;
      }
    });

    // Initialize app: show create section and add one line item
    function init() {
      showSection("create");
      addLineItem();
      invoiceDateInput.valueAsDate = new Date();
    }

    init();
  })();
</script>
</body>
</html>