<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-12-07T04:32:18.188948Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Small Business Invoice Manager</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 1rem;
    background: #f9f9f9;
    color: #222;
  }
  h1 {
    text-align: center;
  }
  nav {
    margin-bottom: 1rem;
  }
  button {
    font-size: 1rem;
    padding: 0.5rem 1rem;
    margin: 0.25rem;
    cursor: pointer;
  }
  button:focus {
    outline: 2px solid #0078d4;
    outline-offset: 2px;
  }
  label {
    display: block;
    margin-top: 0.5rem;
  }
  input[type=text], input[type=number], input[type=date] {
    width: 100%;
    padding: 0.3rem;
    margin-top: 0.2rem;
    box-sizing: border-box;
  }
  fieldset {
    border: 1px solid #ccc;
    padding: 1rem;
    margin-top: 1rem;
  }
  legend {
    font-weight: bold;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.5rem;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 0.3rem 0.5rem;
    text-align: left;
  }
  th {
    background: #eee;
  }
  .hidden {
    display: none;
  }
  .error {
    color: red;
    font-size: 0.9rem;
  }
  .line-item-row {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.3rem;
  }
  .line-item-row > input {
    flex: 1;
  }
  .line-item-row > button {
    flex: 0 0 auto;
  }
  #invoice-list {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background: #fff;
  }
  pre {
    background: #eee;
    padding: 1rem;
    white-space: pre-wrap;
    word-wrap: break-word;
    max-height: 400px;
    overflow-y: auto;
  }
  footer {
    margin-top: 2rem;
    font-size: 0.8rem;
    color: #666;
    text-align: center;
  }
</style>
</head>
<body>
<h1>Small Business Invoice Manager</h1>
<nav role="navigation" aria-label="Main menu">
  <button id="menu-create" aria-controls="section-create" aria-expanded="false">1. Create New Invoice</button>
  <button id="menu-list" aria-controls="section-list" aria-expanded="false">2. List All Invoices</button>
  <button id="menu-view" aria-controls="section-view" aria-expanded="false">3. View Invoice by ID</button>
  <button id="menu-edit" aria-controls="section-edit" aria-expanded="false">4. Edit Invoice</button>
  <button id="menu-delete" aria-controls="section-delete" aria-expanded="false">5. Delete Invoice</button>
  <button id="menu-export" aria-controls="section-export" aria-expanded="false">6. Export Invoice as Text</button>
  <button id="menu-exit">7. Exit</button>
</nav>

<section id="section-create" class="hidden" tabindex="-1" aria-label="Create new invoice">
  <h2>Create New Invoice</h2>
  <form id="form-create" novalidate>
    <label for="create-customer">Customer Name *</label>
    <input type="text" id="create-customer" name="customer" required aria-required="true" autocomplete="off" />
    <label for="create-date">Invoice Date (YYYY-MM-DD) *</label>
    <input type="date" id="create-date" name="date" required aria-required="true" />
    <fieldset aria-label="Line items">
      <legend>Line Items *</legend>
      <div id="line-items-container"></div>
      <button type="button" id="add-line-item">Add Line Item</button>
    </fieldset>
    <label for="create-tax">Tax Rate (%) *</label>
    <input type="number" id="create-tax" name="tax" min="0" max="100" step="0.01" required aria-required="true" />
    <div class="error" id="create-error" role="alert" aria-live="assertive"></div>
    <button type="submit">Save Invoice</button>
    <button type="button" id="create-cancel">Cancel</button>
  </form>
</section>

<section id="section-list" class="hidden" tabindex="-1" aria-label="List all invoices">
  <h2>All Invoices</h2>
  <div id="invoice-list" role="list" aria-live="polite" aria-relevant="additions removals"></div>
  <button id="list-back">Back to Menu</button>
</section>

<section id="section-view" class="hidden" tabindex="-1" aria-label="View invoice details">
  <h2>View Invoice by ID</h2>
  <form id="form-view" novalidate>
    <label for="view-id">Invoice ID *</label>
    <input type="text" id="view-id" name="view-id" required aria-required="true" autocomplete="off" />
    <div class="error" id="view-error" role="alert" aria-live="assertive"></div>
    <button type="submit">View</button>
    <button type="button" id="view-cancel">Cancel</button>
  </form>
  <pre id="view-output" aria-live="polite"></pre>
</section>

<section id="section-edit" class="hidden" tabindex="-1" aria-label="Edit invoice">
  <h2>Edit Invoice</h2>
  <form id="form-edit-select" novalidate>
    <label for="edit-id">Invoice ID *</label>
    <input type="text" id="edit-id" name="edit-id" required aria-required="true" autocomplete="off" />
    <div class="error" id="edit-select-error" role="alert" aria-live="assertive"></div>
    <button type="submit">Load Invoice</button>
    <button type="button" id="edit-select-cancel">Cancel</button>
  </form>
  <form id="form-edit" class="hidden" novalidate>
    <label for="edit-customer">Customer Name *</label>
    <input type="text" id="edit-customer" name="customer" required aria-required="true" autocomplete="off" />
    <label for="edit-date">Invoice Date (YYYY-MM-DD) *</label>
    <input type="date" id="edit-date" name="date" required aria-required="true" />
    <fieldset aria-label="Line items">
      <legend>Line Items *</legend>
      <div id="edit-line-items-container"></div>
      <button type="button" id="edit-add-line-item">Add Line Item</button>
    </fieldset>
    <label for="edit-tax">Tax Rate (%) *</label>
    <input type="number" id="edit-tax" name="tax" min="0" max="100" step="0.01" required aria-required="true" />
    <div class="error" id="edit-error" role="alert" aria-live="assertive"></div>
    <button type="submit">Save Changes</button>
    <button type="button" id="edit-cancel">Cancel</button>
  </form>
</section>

<section id="section-delete" class="hidden" tabindex="-1" aria-label="Delete invoice">
  <h2>Delete Invoice</h2>
  <form id="form-delete" novalidate>
    <label for="delete-id">Invoice ID *</label>
    <input type="text" id="delete-id" name="delete-id" required aria-required="true" autocomplete="off" />
    <div class="error" id="delete-error" role="alert" aria-live="assertive"></div>
    <button type="submit">Delete</button>
    <button type="button" id="delete-cancel">Cancel</button>
  </form>
</section>

<section id="section-export" class="hidden" tabindex="-1" aria-label="Export invoice as text file">
  <h2>Export Invoice as Text File</h2>
  <form id="form-export" novalidate>
    <label for="export-id">Invoice ID *</label>
    <input type="text" id="export-id" name="export-id" required aria-required="true" autocomplete="off" />
    <div class="error" id="export-error" role="alert" aria-live="assertive"></div>
    <button type="submit">Export</button>
    <button type="button" id="export-cancel">Cancel</button>
  </form>
</section>

<footer>
  &copy; 2025 Small Business Invoice Manager - Offline CLI-style Web App
</footer>

<script>
(() => {
  "use strict";

  // Storage key
  const STORAGE_KEY = "small_business_invoices";

  // Utility: Generate unique ID (simple)
  function generateId() {
    return "inv-" + Date.now().toString(36) + "-" + Math.random().toString(36).slice(2,8);
  }

  // Load invoices from localStorage
  function loadInvoices() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (!data) return {};
    try {
      return JSON.parse(data);
    } catch {
      return {};
    }
  }

  // Save invoices to localStorage
  function saveInvoices(invoices) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(invoices));
  }

  // Validate date string (YYYY-MM-DD)
  function isValidDate(dateStr) {
    if (!dateStr) return false;
    const d = new Date(dateStr);
    if (Number.isNaN(d.getTime())) return false;
    // Check format strictness
    return /^\d{4}-\d{2}-\d{2}$/.test(dateStr);
  }

  // Validate positive number (quantity, price, tax)
  function isValidPositiveNumber(value) {
    if (value === "" || value === null || value === undefined) return false;
    const n = Number(value);
    return !Number.isNaN(n) && n >= 0;
  }

  // Format currency (USD style)
  function formatCurrency(num) {
    return "$" + num.toFixed(2);
  }

  // Calculate invoice totals
  function calculateTotals(invoice) {
    let subtotal = 0;
    for (const item of invoice.lineItems) {
      subtotal += item.quantity * item.unitPrice;
    }
    const taxAmount = subtotal * (invoice.taxRate / 100);
    const total = subtotal + taxAmount;
    return {subtotal, taxAmount, total};
  }

  // Clear all error messages in a form
  function clearErrors(form) {
    const errors = form.querySelectorAll(".error");
    errors.forEach(e => e.textContent = "");
  }

  // Show error message
  function showError(form, msg) {
    const err = form.querySelector(".error");
    if (err) err.textContent = msg;
  }

  // Create a line item input row for create/edit forms
  function createLineItemRow(container, values = {description:"", quantity:"", unitPrice:""}) {
    const div = document.createElement("div");
    div.className = "line-item-row";

    const descInput = document.createElement("input");
    descInput.type = "text";
    descInput.placeholder = "Description";
    descInput.value = values.description;
    descInput.required = true;
    descInput.setAttribute("aria-label", "Line item description");
    descInput.autocomplete = "off";

    const qtyInput = document.createElement("input");
    qtyInput.type = "number";
    qtyInput.min = "0";
    qtyInput.step = "1";
    qtyInput.placeholder = "Quantity";
    qtyInput.value = values.quantity;
    qtyInput.required = true;
    qtyInput.setAttribute("aria-label", "Line item quantity");

    const priceInput = document.createElement("input");
    priceInput.type = "number";
    priceInput.min = "0";
    priceInput.step = "0.01";
    priceInput.placeholder = "Unit Price";
    priceInput.value = values.unitPrice;
    priceInput.required = true;
    priceInput.setAttribute("aria-label", "Line item unit price");

    const removeBtn = document.createElement("button");
    removeBtn.type = "button";
    removeBtn.textContent = "Remove";
    removeBtn.setAttribute("aria-label", "Remove this line item");
    removeBtn.addEventListener("click", () => {
      container.removeChild(div);
    });

    div.appendChild(descInput);
    div.appendChild(qtyInput);
    div.appendChild(priceInput);
    div.appendChild(removeBtn);

    container.appendChild(div);
  }

  // Extract line items data from container
  function getLineItemsFromContainer(container) {
    const rows = container.querySelectorAll(".line-item-row");
    const items = [];
    for (const row of rows) {
      const inputs = row.querySelectorAll("input");
      const description = inputs.value.trim();
      const quantity = inputs[1].value.trim();
      const unitPrice = inputs[2].value.trim();
      if (!description) return {error: "Line item description cannot be empty."};
      if (!isValidPositiveNumber(quantity) || Number(quantity) === 0) return {error: "Line item quantity must be a positive number."};
      if (!isValidPositiveNumber(unitPrice)) return {error: "Line item unit price must be a positive number."};
      items.push({
        description,
        quantity: Number(quantity),
        unitPrice: Number(unitPrice)
      });
    }
    if (items.length === 0) return {error: "At least one line item is required."};
    return {items};
  }

  // Render invoice summary list
  function renderInvoiceList(invoices) {
    const container = document.getElementById("invoice-list");
    container.innerHTML = "";
    const keys = Object.keys(invoices);
    if (keys.length === 0) {
      container.textContent = "No invoices saved.";
      return;
    }
    const table = document.createElement("table");
    table.setAttribute("role", "list");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    ["ID", "Customer", "Date", "Total"].forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);
    const tbody = document.createElement("tbody");
    for (const id of keys) {
      const inv = invoices[id];
      const totals = calculateTotals(inv);
      const tr = document.createElement("tr");
      tr.setAttribute("role", "listitem");
      const tdId = document.createElement("td");
      tdId.textContent = id;
      const tdCustomer = document.createElement("td");
      tdCustomer.textContent = inv.customer;
      const tdDate = document.createElement("td");
      tdDate.textContent = inv.date;
      const tdTotal = document.createElement("td");
      tdTotal.textContent = formatCurrency(totals.total);
      tr.appendChild(tdId);
      tr.appendChild(tdCustomer);
      tr.appendChild(tdDate);
      tr.appendChild(tdTotal);
      tbody.appendChild(tr);
    }
    table.appendChild(tbody);
    container.appendChild(table);
  }

  // Format invoice details as text for viewing/export
  function formatInvoiceText(id, invoice) {
    const totals = calculateTotals(invoice);
    let text = `Invoice ID: ${id}\nCustomer: ${invoice.customer}\nDate: ${invoice.date}\nTax Rate: ${invoice.taxRate.toFixed(2)}%\n\nLine Items:\n`;
    text += "Description | Quantity | Unit Price | Total\n";
    text += "-------------------------------------------\n";
    for (const item of invoice.lineItems) {
      const lineTotal = item.quantity * item.unitPrice;
      text += `${item.description} | ${item.quantity} | ${formatCurrency(item.unitPrice)} | ${formatCurrency(lineTotal)}\n`;
    }
    text += "-------------------------------------------\n";
    text += `Subtotal: ${formatCurrency(totals.subtotal)}\n`;
    text += `Tax: ${formatCurrency(totals.taxAmount)}\n`;
    text += `Total: ${formatCurrency(totals.total)}\n`;
    return text;
  }

  // Show section and hide others
  function showSection(id) {
    const sections = document.querySelectorAll("section");
    sections.forEach(s => {
      if (s.id === id) {
        s.classList.remove("hidden");
        s.setAttribute("tabindex", "-1");
        s.focus();
      } else {
        s.classList.add("hidden");
      }
    });
    // Update aria-expanded on menu buttons
    const menuButtons = document.querySelectorAll("nav button[aria-controls]");
    menuButtons.forEach(btn => {
      btn.setAttribute("aria-expanded", btn.getAttribute("aria-controls") === id ? "true" : "false");
    });
  }

  // Reset create form
  function resetCreateForm() {
    const form = document.getElementById("form-create");
    form.reset();
    const container = document.getElementById("line-items-container");
    container.innerHTML = "";
    createLineItemRow(container);
    clearErrors(form);
  }

  // Reset edit form
  function resetEditForm() {
    const form = document.getElementById("form-edit");
    form.reset();
    const container = document.getElementById("edit-line-items-container");
    container.innerHTML = "";
    clearErrors(form);
  }

  // Initialize app
  function init() {
    const invoices = loadInvoices();

    // Menu buttons
    document.getElementById("menu-create").addEventListener("click", () => {
      resetCreateForm();
      showSection("section-create");
    });
    document.getElementById("menu-list").addEventListener("click", () => {
      renderInvoiceList(invoices);
      showSection("section-list");
    });
    document.getElementById("menu-view").addEventListener("click", () => {
      document.getElementById("form-view").reset();
      document.getElementById("view-output").textContent = "";
      clearErrors(document.getElementById("form-view"));
      showSection("section-view");
    });
    document.getElementById("menu-edit").addEventListener("click", () => {
      document.getElementById("form-edit-select").reset();
      clearErrors(document.getElementById("form-edit-select"));
      document.getElementById("form-edit").classList.add("hidden");
      showSection("section-edit");
    });
    document.getElementById("menu-delete").addEventListener("click", () => {
      document.getElementById("form-delete").reset();
      clearErrors(document.getElementById("form-delete"));
      showSection("section-delete");
    });
    document.getElementById("menu-export").addEventListener("click", () => {
      document.getElementById("form-export").reset();
      clearErrors(document.getElementById("form-export"));
      showSection("section-export");
    });
    document.getElementById("menu-exit").addEventListener("click", () => {
      if (confirm("Are you sure you want to exit? This will clear the screen.")) {
        document.body.innerHTML = "<h1>Thank you for using Small Business Invoice Manager.</h1>";
      }
    });

    // Create form line items add button
    document.getElementById("add-line-item").addEventListener("click", () => {
      createLineItemRow(document.getElementById("line-items-container"));
    });

    // Create form submit
    document.getElementById("form-create").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      clearErrors(form);
      const customer = form.customer.value.trim();
      const date = form.date.value;
      const tax = form.tax.value.trim();

      if (!customer) {
        showError(form, "Customer name is required.");
        return;
      }
      if (!isValidDate(date)) {
        showError(form, "Invalid date format.");
        return;
      }
      if (!isValidPositiveNumber(tax)) {
        showError(form, "Tax rate must be a non-negative number.");
        return;
      }
      const {items, error} = getLineItemsFromContainer(document.getElementById("line-items-container"));
      if (error) {
        showError(form, error);
        return;
      }

      const id = generateId();
      invoices[id] = {
        customer,
        date,
        taxRate: Number(tax),
        lineItems: items
      };
      saveInvoices(invoices);
      alert(`Invoice created with ID: ${id}`);
      resetCreateForm();
      showSection("section-list");
      renderInvoiceList(invoices);
    });

    // Create form cancel
    document.getElementById("create-cancel").addEventListener("click", () => {
      if (confirm("Cancel creating invoice? Unsaved data will be lost.")) {
        showSection("section-list");
        renderInvoiceList(invoices);
      }
    });

    // List back button
    document.getElementById("list-back").addEventListener("click", () => {
      showSection(null);
    });

    // View form submit
    document.getElementById("form-view").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      clearErrors(form);
      const id = form["view-id"].value.trim();
      if (!id) {
        showError(form, "Invoice ID is required.");
        return;
      }
      if (!(id in invoices)) {
        showError(form, "Invoice ID not found.");
        document.getElementById("view-output").textContent = "";
        return;
      }
      const text = formatInvoiceText(id, invoices[id]);
      document.getElementById("view-output").textContent = text;
    });

    // View cancel
    document.getElementById("view-cancel").addEventListener("click", () => {
      showSection(null);
    });

    // Edit select form submit (load invoice)
    document.getElementById("form-edit-select").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      clearErrors(form);
      const id = form["edit-id"].value.trim();
      if (!id) {
        showError(form, "Invoice ID is required.");
        return;
      }
      if (!(id in invoices)) {
        showError(form, "Invoice ID not found.");
        return;
      }
      // Load invoice data into edit form
      const invoice = invoices[id];
      const editForm = document.getElementById("form-edit");
      editForm.classList.remove("hidden");
      editForm.dataset.editingId = id;
      editForm.customer.value = invoice.customer;
      editForm.date.value = invoice.date;
      editForm.tax.value = invoice.taxRate.toFixed(2);
      const container = document.getElementById("edit-line-items-container");
      container.innerHTML = "";
      for (const item of invoice.lineItems) {
        createLineItemRow(container, {
          description: item.description,
          quantity: item.quantity,
          unitPrice: item.unitPrice
        });
      }
      clearErrors(editForm);
    });

    // Edit select cancel
    document.getElementById("edit-select-cancel").addEventListener("click", () => {
      showSection(null);
    });

    // Edit form add line item
    document.getElementById("edit-add-line-item").addEventListener("click", () => {
      createLineItemRow(document.getElementById("edit-line-items-container"));
    });

    // Edit form submit (save changes)
    document.getElementById("form-edit").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      clearErrors(form);
      const id = form.dataset.editingId;
      if (!id || !(id in invoices)) {
        showError(form, "Invalid invoice ID.");
        return;
      }
      const customer = form.customer.value.trim();
      const date = form.date.value;
      const tax = form.tax.value.trim();

      if (!customer) {
        showError(form, "Customer name is required.");
        return;
      }
      if (!isValidDate(date)) {
        showError(form, "Invalid date format.");
        return;
      }
      if (!isValidPositiveNumber(tax)) {
        showError(form, "Tax rate must be a non-negative number.");
        return;
      }
      const {items, error} = getLineItemsFromContainer(document.getElementById("edit-line-items-container"));
      if (error) {
        showError(form, error);
        return;
      }
      invoices[id] = {
        customer,
        date,
        taxRate: Number(tax),
        lineItems: items
      };
      saveInvoices(invoices);
      alert(`Invoice ${id} updated.`);
      form.classList.add("hidden");
      document.getElementById("form-edit-select").reset();
      showSection("section-list");
      renderInvoiceList(invoices);
    });

    // Edit form cancel
    document.getElementById("edit-cancel").addEventListener("click", () => {
      if (confirm("Cancel editing? Unsaved changes will be lost.")) {
        document.getElementById("form-edit").classList.add("hidden");
        document.getElementById("form-edit-select").reset();
        showSection("section-list");
        renderInvoiceList(invoices);
      }
    });

    // Delete form submit
    document.getElementById("form-delete").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      clearErrors(form);
      const id = form["delete-id"].value.trim();
      if (!id) {
        showError(form, "Invoice ID is required.");
        return;
      }
      if (!(id in invoices)) {
        showError(form, "Invoice ID not found.");
        return;
      }
      if (confirm(`Are you sure you want to delete invoice ${id}? This action cannot be undone.`)) {
        delete invoices[id];
        saveInvoices(invoices);
        alert(`Invoice ${id} deleted.`);
        form.reset();
        showSection("section-list");
        renderInvoiceList(invoices);
      }
    });

    // Delete cancel
    document.getElementById("delete-cancel").addEventListener("click", () => {
      showSection(null);
    });

    // Export form submit
    document.getElementById("form-export").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      clearErrors(form);
      const id = form["export-id"].value.trim();
      if (!id) {
        showError(form, "Invoice ID is required.");
        return;
      }
      if (!(id in invoices)) {
        showError(form, "Invoice ID not found.");
        return;
      }
      const text = formatInvoiceText(id, invoices[id]);
      // Create a downloadable text file
      const blob = new Blob([text], {type: "text/plain"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `invoice_${id}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert(`Invoice ${id} exported as text file.`);
      form.reset();
      showSection(null);
    });

    // Export cancel
    document.getElementById("export-cancel").addEventListener("click", () => {
      showSection(null);
    });

    // Initialize with list view hidden
    showSection(null);
  }

  window.addEventListener("load", init);
})();
</script>
</body>
</html>