<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2026-01-17T20:34:23.452197Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Tracker Pro</title>
  <style>
    :root {
      --bg: #ffffff;
      --bg-card: #f8f9fa;
      --text: #1a1a1a;
      --text-muted: #6c757d;
      --primary: #007bff;
      --primary-hover: #0056b3;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --border: #dee2e6;
      --shadow: 0 2px 10px rgba(0,0,0,0.1);
      --radius: 8px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    [data-theme="dark"] {
      --bg: #1a1a1a;
      --bg-card: #2d2d2d;
      --text: #e9ecef;
      --text-muted: #adb5bd;
      --border: #495057;
      --shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
      transition: var(--transition);
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 1rem; display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    @media (min-width: 768px) { .container { grid-template-columns: 1fr 350px; } }
    @media (min-width: 1200px) { .container { grid-template-columns: 1fr 400px; } }
    
    header { grid-column: 1 / -1; text-align: center; padding: 2rem 0; }
    h1 { font-size: clamp(1.8rem, 4vw, 2.5rem); margin-bottom: 0.5rem; }
    .subtitle { color: var(--text-muted); font-size: 1.1rem; }
    
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
    .stat-card {
      background: var(--bg-card);
      padding: 1.5rem;
      border-radius: var(--radius);
      text-align: center;
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
    .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 0.25rem; }
    .stat-label { color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }
    
    .controls { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; align-items: center; }
    .btn {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-secondary { background: var(--bg-card); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--primary); color: white; }
    .btn-sm { padding: 0.5rem 1rem; min-height: 40px; font-size: 0.85rem; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover { background: #c82333; }
    
    select.btn, input[type="search"].btn { background: var(--bg-card); color: var(--text); border: 1px solid var(--border); }
    
    .invoice-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
      max-height: 70vh;
      overflow-y: auto;
      padding: 1rem 0;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--bg-card);
    }
    .invoice-grid::-webkit-scrollbar { width: 8px; }
    .invoice-grid::-webkit-scrollbar-track { background: var(--bg-card); }
    .invoice-grid::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }
    
    .invoice-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      transition: var(--transition);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.5s ease-out;
    }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .invoice-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow);
      border-color: var(--primary);
    }
    .invoice-card.editing { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,123,255,0.1); }
    .invoice-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .client-name { font-size: 1.3rem; font-weight: 600; margin-bottom: 0.25rem; }
    .amount { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
    .due-date { color: var(--text-muted); margin-bottom: 0.5rem; }
    .due-soon { color: var(--warning); }
    .overdue { color: var(--danger); }
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-draft { background: #e9ecef; color: var(--text); }
    .status-paid { background: var(--success); color: white; }
    .status-overdue { background: var(--danger); color: white; }
    
    .invoice-actions { display: flex; gap: 0.5rem; opacity: 0; transition: var(--transition); }
    .invoice-card:hover .invoice-actions { opacity: 1; }
    
    .form-section { background: var(--bg-card); border-radius: var(--radius); padding: 2rem; border: 1px solid var(--border); }
    .form-group { margin-bottom: 1.5rem; }
    label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
    input, select, textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
      transition: var(--transition);
      background: var(--bg);
      color: var(--text);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
    }
    textarea { resize: vertical; min-height: 80px; }
    
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-muted);
    }
    .empty-state svg { width: 80px; height: 80px; margin: 0 auto 2rem; opacity: 0.5; }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      z-index: 1000;
    }
    .modal.active { opacity: 1; visibility: visible; }
    .modal-content {
      background: var(--bg);
      padding: 2rem;
      border-radius: var(--radius);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.8) translateY(20px);
      transition: var(--transition);
    }
    .modal.active .modal-content { transform: scale(1) translateY(0); }
    
    .offline-banner {
      grid-column: 1 / -1;
      background: #fff3cd;
      color: #856404;
      padding: 1rem;
      border-radius: var(--radius);
      text-align: center;
      border: 1px solid #ffeaa7;
      display: none;
    }
    .offline-banner.show { display: block; animation: slideDown 0.3s ease-out; }
    @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
    
    @media print {
      .container { grid-template-columns: 1fr !important; }
      .form-section, .controls, header { display: none !important; }
      .invoice-card { break-inside: avoid; margin-bottom: 1rem; box-shadow: none; border: 1px solid black; }
    }
    
    @media (max-width: 767px) {
      .invoice-grid { grid-template-columns: 1fr; }
      .container { grid-template-columns: 1fr !important; }
      .swipe-delete { position: absolute; right: -100%; top: 0; bottom: 0; width: 100%; background: var(--danger); display: flex; align-items: center; justify-content: center; transform: translateX(100%); transition: transform 0.3s ease; }
      .invoice-card.swiping .swipe-delete { transform: translateX(0); }
    }
    
    .pie-chart { width: 200px; height: 200px; margin: 1rem auto; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Invoice Tracker Pro</h1>
      <p class="subtitle">Track, manage, and get paid faster</p>
      <div class="offline-banner" id="offlineBanner" role="alert" aria-live="polite">
        üîå Offline mode - Your data is saved locally
      </div>
    </header>
    
    <div class="dashboard" id="dashboard">
      <div class="stat-card">
        <div class="stat-value" id="totalDue">$0</div>
        <div class="stat-label">Total Due</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalPaid">$0</div>
        <div class="stat-label">Total Paid</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalOverdue">$0</div>
        <div class="stat-label">Total Overdue</div>
      </div>
      <canvas class="pie-chart" id="pieChart" width="200" height="200" aria-label="Invoice status distribution"></canvas>
    </div>
    
    <div class="controls" id="controls">
      <button class="btn btn-primary" id="addBtn" aria-label="Add new invoice">‚ûï New Invoice</button>
      <select id="filterSelect" class="btn" aria-label="Filter invoices">
        <option value="all">All</option>
        <option value="draft">Draft</option>
        <option value="paid">Paid</option>
        <option value="overdue">Overdue</option>
      </select>
      <button class="btn btn-secondary btn-sm" id="sortDueBtn" aria-label="Sort by due date">üìÖ Due Date</button>
      <button class="btn btn-secondary btn-sm" id="sortAmountBtn" aria-label="Sort by amount">üí∞ Amount</button>
      <input type="search" id="searchInput" class="btn" placeholder="üîç Search clients or notes..." aria-label="Search invoices">
      <button class="btn btn-secondary btn-sm" id="printBtn" aria-label="Print invoices">üñ®Ô∏è Print</button>
      <button class="btn btn-secondary btn-sm" id="themeToggle" aria-label="Toggle dark/light mode">üåô</button>
    </div>
    
    <main id="mainContent">
      <div class="empty-state" id="emptyState" style="display: none;">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
        <h3>No invoices yet</h3>
        <p>Create your first invoice to get started!</p>
      </div>
      <div class="invoice-grid" id="invoiceGrid" role="list" tabindex="-1"></div>
    </main>
    
    <aside class="form-section" id="formSection" style="display: none;">
      <h2 id="formTitle">New Invoice</h2>
      <form id="invoiceForm">
        <div class="form-group">
          <label for="clientName">Client Name <span aria-label="required">*</span></label>
          <input type="text" id="clientName" required maxlength="100">
        </div>
        <div class="form-group">
          <label for="amount">Amount ($)<span aria-label="required">*</span></label>
          <input type="number" id="amount" min="0.01" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="dueDate">Due Date<span aria-label="required">*</span></label>
          <input type="date" id="dueDate" required>
        </div>
        <div class="form-group">
          <label for="status">Status<span aria-label="required">*</span></label>
          <select id="status" required>
            <option value="draft">Draft</option>
            <option value="paid">Paid</option>
            <option value="overdue">Overdue</option>
          </select>
        </div>
        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea id="notes" maxlength="500" placeholder="Additional details..."></textarea>
        </div>
        <div style="display: flex; gap: 1rem;">
          <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ Save</button>
          <button type="button" class="btn btn-secondary" id="cancelBtn">‚ùå Cancel</button>
        </div>
      </form>
    </aside>
  </div>
  
  <div class="modal" id="deleteModal" role="dialog" aria-labelledby="deleteModalTitle" aria-hidden="true">
    <div class="modal-content">
      <h3 id="deleteModalTitle">Confirm Delete</h3>
      <p>Are you sure you want to delete this invoice? This action cannot be undone.</p>
      <div style="display: flex; gap: 1rem; justify-content: flex-end;">
        <button class="btn btn-secondary" id="cancelDelete">Cancel</button>
        <button class="btn btn-danger" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>
  
  <script>
    class InvoiceTracker {
      constructor() {
        this.invoices = [];
        this.currentId = null;
        this.sortBy = 'due'; // 'due' or 'amount'
        this.sortDir = 1;
        this.filter = 'all';
        this.search = '';
        this.autoSaveTimer = null;
        this.init();
      }
      
      init() {
        this.loadData();
        this.setToday();
        this.parseHash();
        this.bindEvents();
        this.render();
        this.startAutoSave();
        this.updateOnlineStatus();
        window.addEventListener('online', () => this.updateOnlineStatus());
        window.addEventListener('offline', () => this.updateOnlineStatus());
        window.addEventListener('hashchange', () => this.parseHash());
        window.addEventListener('keydown', (e) => this.handleKeydown(e));
      }
      
      setToday() {
        this.today = new Date('2026-01-17T20:00:00Z'); // Fixed date from prompt
      }
      
      isOverdue(dueDate) {
        return new Date(dueDate) < this.today;
      }
      
      isDueSoon(dueDate) {
        const due = new Date(dueDate);
        const diff = due - this.today;
        return diff > 0 && diff <= 7 * 24 * 60 * 60 * 1000;
      }
      
      formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
      }
      
      formatDate(isoDate) {
        return new Date(isoDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
      }
      
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      }
      
      loadData() {
        const data = localStorage.getItem('invoices');
        const settings = localStorage.getItem('settings');
        this.invoices = data ? JSON.parse(data) : [];
        if (settings) {
          const s = JSON.parse(settings);
          this.sortBy = s.sortBy || 'due';
          this.sortDir = s.sortDir || 1;
          document.documentElement.dataset.theme = s.theme || 'light';
        }
      }
      
      saveData() {
        localStorage.setItem('invoices', JSON.stringify(this.invoices));
        localStorage.setItem('settings', JSON.stringify({
          sortBy: this.sortBy,
          sortDir: this.sortDir,
          theme: document.documentElement.dataset.theme
        }));
      }
      
      startAutoSave() {
        this.autoSaveTimer = setInterval(() => this.saveData(), 30000);
      }
      
      bindEvents() {
        // Form handling
        document.getElementById('invoiceForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveInvoice();
        });
        document.getElementById('cancelBtn').addEventListener('click', () => this.cancelEdit());
        
        // Controls
        document.getElementById('addBtn').addEventListener('click', () => this.showForm());
        document.getElementById('filterSelect').addEventListener('change', (e) => {
          this.filter = e.target.value;
          this.render();
          this.updateHash();
        });
        document.getElementById('searchInput').addEventListener('input', (e) => {
          this.search = e.target.value.toLowerCase();
          this.render();
        });
        document.getElementById('sortDueBtn').addEventListener('click', () => this.toggleSort('due'));
        document.getElementById('sortAmountBtn').addEventListener('click', () => this.toggleSort('amount'));
        document.getElementById('printBtn').addEventListener('click', () => window.print());
        document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
        
        // Delete modal
        document.getElementById('cancelDelete').addEventListener('click', () => this.hideDeleteModal());
        document.getElementById('confirmDelete').addEventListener('click', () => this.deleteInvoice());
      }
      
      toggleSort(field) {
        if (this.sortBy === field) {
          this.sortDir *= -1;
        } else {
          this.sortBy = field;
          this.sortDir = 1;
        }
        this.render();
        this.updateHash();
      }
      
      toggleTheme() {
        const isDark = document.documentElement.dataset.theme === 'dark';
        document.documentElement.dataset.theme = isDark ? 'light' : 'dark';
        document.getElementById('themeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        this.saveData();
      }
      
      showForm(invoice = null) {
        const formSection = document.getElementById('formSection');
        const formTitle = document.getElementById('formTitle');
        const form = document.getElementById('invoiceForm');
        
        if (invoice) {
          this.currentId = invoice.id;
          document.getElementById('clientName').value = invoice.client;
          document.getElementById('amount').value = invoice.amount;
          document.getElementById('dueDate').value = invoice.due.split('T')[0];
          document.getElementById('status').value = invoice.status;
          document.getElementById('notes').value = invoice.notes || '';
          formTitle.textContent = 'Edit Invoice';
        } else {
          this.currentId = null;
          form.reset();
          document.getElementById('dueDate').valueAsDate = new Date(this.today.getTime() + 30 * 24 * 60 * 60 * 1000);
          formTitle.textContent = 'New Invoice';
        }
        
        formSection.style.display = 'block';
        formSection.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('clientName').focus();
      }
      
      saveInvoice() {
        const formData = new FormData(document.getElementById('invoiceForm'));
        const invoice = {
          id: this.currentId || this.generateId(),
          client: formData.get('clientName').trim(),
          amount: parseFloat(formData.get('amount')),
          due: new Date(formData.get('dueDate') + 'T00:00:00Z').toISOString(),
          status: formData.get('status'),
          notes: formData.get('notes').trim()
        };
        
        if (!invoice.client || invoice.amount <= 0 || !invoice.due) {
          alert('Please fill all required fields with valid data.');
          return;
        }
        
        const index = this.invoices.findIndex(i => i.id === invoice.id);
        if (index > -1) {
          this.invoices[index] = invoice;
        } else {
          this.invoices.push(invoice);
        }
        
        this.saveData();
        this.render();
        this.cancelEdit();
        this.updateHash();
      }
      
      cancelEdit() {
        document.getElementById('formSection').style.display = 'none';
        this.currentId = null;
      }
      
      async deleteInvoice() {
        if (this.currentId) {
          this.invoices = this.invoices.filter(i => i.id !== this.currentId);
          this.saveData();
          this.render();
          this.hideDeleteModal();
          this.currentId = null;
          this.updateHash();
        }
      }
      
      showDeleteModal(id) {
        this.currentId = id;
        document.getElementById('deleteModal').classList.add('active');
        document.getElementById('deleteModal').setAttribute('aria-hidden', 'false');
        document.getElementById('confirmDelete').focus();
      }
      
      hideDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        document.getElementById('deleteModal').setAttribute('aria-hidden', 'true');
      }
      
      getFilteredInvoices() {
        return this.invoices
          .filter(invoice => {
            if (this.filter !== 'all' && invoice.status !== this.filter) return false;
            if (this.search && !invoice.client.toLowerCase().includes(this.search) && 
                !invoice.notes.toLowerCase().includes(this.search)) return false;
            return true;
          })
          .sort((a, b) => {
            let valA = this.sortBy === 'due' ? new Date(a.due) : a.amount;
            let valB = this.sortBy === 'due' ? new Date(b.due) : b.amount;
            return (valA - valB) * this.sortDir;
          });
      }
      
      render() {
        const filtered = this.getFilteredInvoices();
        const grid = document.getElementById('invoiceGrid');
        const emptyState = document.getElementById('emptyState');
        
        if (filtered.length === 0) {
          grid.innerHTML = '';
          emptyState.style.display = 'block';
        } else {
          emptyState.style.display = 'none';
          grid.innerHTML = filtered.map(invoice => this.renderInvoiceCard(invoice)).join('');
          
          // Add click handlers
          document.querySelectorAll('.invoice-card').forEach((card, index) => {
            card.addEventListener('click', (e) => {
              if (!e.target.closest('.invoice-actions')) {
                this.editInvoice(card.dataset.id);
              }
            });
            card.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                this.editInvoice(card.dataset.id);
              }
            });
            
            // Delete button
            const deleteBtn = card.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              this.showDeleteModal(card.dataset.id);
            });
          });
          
          // Keyboard navigation
          grid.tabIndex = 0;
          grid.focus();
        }
        
        this.renderDashboard(filtered);
      }
      
      renderInvoiceCard(invoice) {
        const dueDate = new Date(invoice.due);
        const isOverdue = this.isOverdue(invoice.due);
        const isDueSoon = this.isDueSoon(invoice.due);
        const dueClass = isOverdue ? 'overdue' : isDueSoon ? 'due-soon' : '';
        const statusClass = `status-${invoice.status}`;
        
        return `
          <article class="invoice-card" data-id="${invoice.id}" role="button" tabindex="0" 
                   aria-label="Invoice for ${invoice.client}, ${this.formatCurrency(invoice.amount)}, due ${this.formatDate(invoice.due)}">
            <div class="invoice-header">
              <div>
                <div class="client-name">${this.escapeHtml(invoice.client)}</div>
                <div class="due-date ${dueClass}">${this.formatDate(invoice.due)}</div>
              </div>
              <div class="amount">${this.formatCurrency(invoice.amount)}</div>
            </div>
            <div class="status-badge ${statusClass}">${invoice.status}</div>
            ${invoice.notes ? `<p style="margin: 1rem 0 1rem 0; color: var(--text-muted);">${this.escapeHtml(invoice.notes)}</p>` : ''}
            <div class="invoice-actions">
              <button class="btn btn-primary btn-sm" style="font-size: 0.8rem;">Edit</button>
              <button class="btn btn-danger btn-sm delete-btn" style="font-size: 0.8rem;">Delete</button>
            </div>
            <div class="swipe-delete" style="display: none;">üóëÔ∏è Delete</div>
          </article>
        `;
      }
      
      renderDashboard(invoices) {
        const totals = {
          due: 0,
          paid: 0,
          overdue: 0
        };
        
        invoices.forEach(inv => {
          if (inv.status === 'paid') {
            totals.paid += inv.amount;
          } else if (this.isOverdue(inv.due)) {
            totals.overdue += inv.amount;
          } else {
            totals.due += inv.amount;
          }
        });
        
        document.getElementById('totalDue').textContent = this.formatCurrency(totals.due);
        document.getElementById('totalPaid').textContent = this.formatCurrency(totals.paid);
        document.getElementById('totalOverdue').textContent = this.formatCurrency(totals.overdue);
        
        this.renderPieChart(totals);
      }
      
      renderPieChart(totals) {
        const canvas = document.getElementById('pieChart');
        const ctx = canvas.getContext('2d');
        const total = totals.due + totals.paid + totals.overdue;
        if (total === 0) return;
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 80;
        
        let startAngle = 0;
        
        // Due (blue)
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + (totals.due / total) * 2 * Math.PI);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = '#007bff';
        ctx.fill();
        startAngle += (totals.due / total) * 2 * Math.PI;
        
        // Paid (green)
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + (totals.paid / total) * 2 * Math.PI);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = '#28a745';
        ctx.fill();
        startAngle += (totals.paid / total) * 2 * Math.PI;
        
        // Overdue (red)
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + (totals.overdue / total) * 2 * Math.PI);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = '#dc3545';
        ctx.fill();
      }
      
      editInvoice(id) {
        const invoice = this.invoices.find(i => i.id === id);
        if (invoice) {
          this.showForm(invoice);
          this.updateHash(`invoice/${id}`);
        }
      }
      
      parseHash() {
        const hash = window.location.hash.slice(1);
        if (hash.startsWith('invoice/')) {
          const id = hash.split('/')[1];
          const invoice = this.invoices.find(i => i.id === id);
          if (invoice) {
            this.showForm(invoice);
          }
        } else if (hash.startsWith('filter/')) {
          const filter = hash.split('/')[1];
          if (['all', 'draft', 'paid', 'overdue'].includes(filter)) {
            this.filter = filter;
            document.getElementById('filterSelect').value = filter;
          }
        }
        this.render();
      }
      
      updateHash(state = null) {
        if (state === 'invoice' && this.currentId) {
          window.location.hash = `invoice/${this.currentId}`;
        } else if (state === 'filter') {
          window.location.hash = `filter/${this.filter}`;
        } else {
          window.location.hash = '';
        }
      }
      
      updateOnlineStatus() {
        const banner = document.getElementById('offlineBanner');
        if (!navigator.onLine) {
          banner.classList.add('show');
        } else {
          banner.classList.remove('show');
        }
      }
      
      handleKeydown(e) {
        const grid = document.getElementById('invoiceGrid');
        const cards = document.querySelectorAll('.invoice-card');
        const focusedIndex = Array.from(cards).findIndex(card => document.activeElement === card);
        
        if (e.key === 'Escape') {
          e.preventDefault();
          this.cancelEdit();
          this.hideDeleteModal();
          grid.focus();
        } else if (e.key === 'ArrowDown' && focusedIndex < cards.length - 1) {
          e.preventDefault();
          cards[focusedIndex + 1].focus();
        } else if (e.key === 'ArrowUp' && focusedIndex > 0) {
          e.preventDefault();
          cards[focusedIndex - 1].focus();
        }
      }
      
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    }
    
    // Touch/swipe support for mobile
    document.addEventListener('touchstart', handleTouch, { passive: true });
    document.addEventListener('touchmove', handleTouch, { passive: false });
    let touchStartX = 0;
    
    function handleTouch(e) {
      const card = e.target.closest('.invoice-card');
      if (!card) return;
      
      if (e.type === 'touchstart') {
        touchStartX = e.touches[0].clientX;
      } else if (e.type === 'touchmove') {
        const touchX = e.touches[0].clientX;
        const diff = touchStartX - touchX;
        if (diff > 100) {
          card.classList.add('swiping');
          e.preventDefault();
        }
      }
    }
    
    document.addEventListener('touchend', (e) => {
      const card = e.target.closest('.invoice-card');
      if (card && card.classList.contains('swiping')) {
        card.classList.remove('swiping');
        const tracker = window.tracker;
        tracker.showDeleteModal(card.dataset.id);
      }
    });
    
    // Initialize app
    window.tracker = new InvoiceTracker();
  </script>
</body>
</html>