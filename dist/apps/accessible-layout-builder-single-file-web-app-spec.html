<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-12-24T12:41:18.099355Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accessible Layout Builder</title>
<style>
:root{--bg:#fff;--bg-alt:#f8f9fa;--fg:#1a1a1a;--fg-alt:#6c757d;--accent:#007bff;--danger:#dc3545;--success:#28a745;--warning:#ffc107;--border:#dee2e6;--focus:#007bff;--radius:8px;--shadow:0 2px 10px rgba(0,0,0,0.1);--grid-gap:1rem;--transition:.2s ease}@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}*{box-sizing:border-box}body{font-family:system-ui,-apple-system,sans-serif;font-size:16px;line-height:1.5;color:var(--fg);background:var(--bg);margin:0;padding:20px;max-width:100vw;overflow-x:auto}@media(max-width:768px){body{padding:10px}}.app{display:grid;grid-template-columns:280px 1fr 300px;grid-template-rows:auto 1fr auto;gap:1rem;height:100vh;max-width:1400px;margin:0 auto}@media(max-width:1024px){.app{grid-template-columns:250px 1fr;grid-template-areas:"toolbox canvas""toolbox inspector";}.inspector{grid-area:inspector}}@media(max-width:768px){.app{grid-template-columns:1fr;grid-template-rows:auto 1fr auto;grid-template-areas:"toolbox""canvas""inspector"}}header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--bg-alt);border-bottom:2px solid var(--border);border-radius:var(--radius) var(--radius) 0 0}.toolbox{grid-area:toolbox;background:var(--bg-alt);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;overflow-y:auto}.toolbox h3{margin:0 0 1rem;font-size:1.1rem}.component-btn{display:block;width:100%;padding:.75rem;margin-bottom:.5rem;background:var(--bg);border:2px solid transparent;border-radius:var(--radius);cursor:grab;text-align:left;font-size:1rem;transition:all var(--transition)}@media(hover:hover){.component-btn:hover{background:var(--bg-alt)}}.component-btn:focus{outline:none;box-shadow:0 0 0 3px var(--focus),0 0 0 6px rgba(0,123,255,0.25)}.component-btn[aria-grabbed=true]{background:var(--accent);color:#fff;border-color:var(--accent)}.canvas{grid-area:canvas;background:var(--bg);border:2px solid var(--border);border-radius:var(--radius);padding:var(--grid-gap);position:relative;overflow:auto;display:grid;gap:var(--grid-gap);grid-template-columns:repeat(auto-fit,minmax(200px,1fr));transition:all var(--transition)}.canvas.mobile{grid-template-columns:1fr}.canvas.tablet{grid-template-columns:repeat(2,1fr)}.canvas.desktop{grid-template-columns:repeat(4,1fr)}.canvas::before{content:attr(data-breakpoint);position:absolute;top:10px;right:10px;padding:.5rem .75rem;background:rgba(0,0,0,0.75);color:#fff;border-radius:var(--radius);font-size:.875rem;z-index:10}.grid-cell{position:relative;min-height:100px;border:2px dashed transparent;margin:.25rem;transition:border-color var(--transition)}.grid-cell.focused{border-color:var(--focus)}.grid-cell.drag-over{border-color:var(--accent);background:rgba(0,123,255,0.1)}.canvas-item{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--bg-alt);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;display:flex;flex-direction:column;gap:.5rem;cursor:move;transition:all var(--transition);outline:none}.canvas-item:focus{box-shadow:0 0 0 3px var(--focus),0 0 0 6px rgba(0,123,255,0.25);z-index:5}.canvas-item.selected{box-shadow:var(--shadow),inset 0 0 0 3px var(--accent)}.canvas-item[aria-invalid=true]{border-color:var(--danger);box-shadow:0 0 0 3px rgba(220,53,69,0.25)}.canvas-item h1,.canvas-item h2,.canvas-item h3{margin:0;font-weight:600;line-height:1.2}.canvas-item button,.canvas-item input{padding:.5rem;border:1px solid var(--border);border-radius:4px;font:inherit}.inspector{grid-area:inspector;background:var(--bg-alt);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;overflow-y:auto}.inspector h3{margin:0 0 1rem;font-size:1.1rem}.inspector-field{display:flex;flex-direction:column;gap:.25rem;margin-bottom:1rem}.inspector-field label{font-weight:600;font-size:.875rem}.inspector-field input,.inspector-field select,.inspector-field textarea{padding:.5rem;border:1px solid var(--border);border-radius:4px;font:inherit;font-size:.875rem}.inspector-field input:focus,.inspector-field select:focus,.inspector-field textarea:focus{outline:none;box-shadow:0 0 0 3px var(--focus)}.warning{padding:.75rem;background:var(--warning);color:var(--fg);border-radius:var(--radius);border-left:4px solid #ffc107;margin:.5rem 0}.error{padding:.75rem;background:#f8d7da;color:#721c24;border-radius:var(--radius);border-left:4px solid var(--danger);margin:.5rem 0}.contrast-badge{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:600}.contrast-pass{background:var(--success);color:#fff}.contrast-fail{background:var(--danger);color:#fff}.btn{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:var(--accent);color:#fff;border:none;border-radius:var(--radius);cursor:pointer;font:inherit;font-weight:600;transition:all var(--transition)}@media(hover:hover){.btn:hover{opacity:.9;transform:translateY(-1px)}}.btn:focus{outline:none;box-shadow:0 0 0 3px var(--focus),0 0 0 6px rgba(0,123,255,0.25)}.btn-secondary{background:var(--bg-alt);color:var(--fg);border:1px solid var(--border)}.btn-danger{background:var(--danger)}.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;padding:2rem}.modal-content{width:90%;max-width:800px;max-height:90vh;background:var(--bg);border-radius:var(--radius);overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3)}.modal-header{padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-body{padding:1.5rem}.modal-tabs{display:flex;border-bottom:1px solid var(--border)}.modal-tab{padding:1rem .75rem;cursor:pointer;font-weight:600;border-bottom:3px solid transparent;transition:all var(--transition)}.modal-tab.active{border-bottom-color:var(--accent);background:var(--bg-alt)}.tab-content{display:none}.tab-content.active{display:block}.help-overlay{background:rgba(0,0,0,0.9);color:#fff;padding:2rem;max-width:600px;margin:0 auto}.hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;width:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;border:0}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.live-region{border:2px solid var(--border);padding:1rem;margin:1rem 0;background:var(--bg-alt);border-radius:var(--radius);min-height:2rem}.device-toggle{display:flex;gap:.25rem;margin-bottom:1rem}.device-btn{padding:.5rem .75rem;font-size:.875rem}.collapsible-panel{max-height:0;overflow:hidden;transition:max-height .3s ease}.collapsible-panel.open{max-height:1000px}@media(max-width:768px){.toolbox,.inspector{border-radius:0;border-left:none;border-right:none}}
</style>
</head>
<body>
<div class="app" role="main" aria-label="Accessible Layout Builder">
<header role="banner">
<h1>Accessible Layout Builder</h1>
<div>
<button class="btn" id="newBtn" aria-label="New layout">New</button>
<button class="btn btn-secondary" id="saveBtn" aria-label="Save layout">Save</button>
<button class="btn" id="exportBtn" aria-label="Export">Export</button>
<button class="btn btn-secondary" id="helpBtn" aria-label="Help">?</button>
</div>
</header>

<aside class="toolbox" role="navigation" aria-label="Component toolbox">
<h3>Components</h3>
<button class="component-btn" draggable="true" data-type="heading" data-level="h1" tabindex="0" role="button" aria-describedby="comp-desc">üìù Heading</button>
<button class="component-btn" draggable="true" data-type="heading" data-level="h2" tabindex="0" role="button" aria-describedby="comp-desc">üìù Heading</button>
<button class="component-btn" draggable="true" data-type="heading" data-level="h3" tabindex="0" role="button" aria-describedby="comp-desc">üìù Heading</button>
<button class="component-btn" draggable="true" data-type="paragraph" tabindex="0" role="button" aria-describedby="comp-desc">üìÑ Paragraph</button>
<button class="component-btn" draggable="true" data-type="button" tabindex="0" role="button" aria-describedby="comp-desc">üîò Button</button>
<button class="component-btn" draggable="true" data-type="image" tabindex="0" role="button" aria-describedby="comp-desc">üñºÔ∏è Image</button>
<button class="component-btn" draggable="true" data-type="form" tabindex="0" role="button" aria-describedby="comp-desc">üìù Form Field</button>
<button class="component-btn" draggable="true" data-type="card" tabindex="0" role="button" aria-describedby="comp-desc">üÉè Card</button>
<button class="component-btn" draggable="true" data-type="spacer" tabindex="0" role="button" aria-describedby="comp-desc">üìè Spacer</button>
<p id="comp-desc" class="sr-only">Drag to canvas or press Space to pick up</p>
</aside>

<main class="canvas" id="canvas" role="region" aria-label="Design canvas" data-breakpoint="Desktop" aria-live="polite">
<div class="grid-cell" data-cell="0"></div>
<div class="grid-cell" data-cell="1"></div>
<div class="grid-cell" data-cell="2"></div>
<div class="grid-cell" data-cell="3"></div>
</main>

<aside class="inspector" role="complementary" aria-label="Component inspector">
<h3 id="inspector-title">Select a component</h3>
<div id="inspector-content">
<p>No component selected</p>
</div>
<div id="warnings"></div>
</aside>
</div>

<div id="live-region" class="live-region sr-only" aria-live="polite" role="status"></div>

<div id="export-modal" class="modal hidden" role="dialog" aria-labelledby="modal-title" aria-modal="true">
<div class="modal-content">
<div class="modal-header">
<h2 id="modal-title">Export Layout</h2>
<button class="btn btn-secondary" id="close-modal">√ó</button>
</div>
<div class="modal-tabs">
<button class="modal-tab active" data-tab="html">HTML</button>
<button class="modal-tab" data-tab="checklist">Checklist</button>
</div>
<div class="modal-body">
<div id="tab-html" class="tab-content active">
<textarea id="html-output" rows="20" readonly style="width:100%;font-family:monospace;font-size:14px"></textarea>
<button class="btn" id="copy-html">Copy HTML</button>
</div>
<div id="tab-checklist" class="tab-content">
<pre id="checklist-output"></pre>
<button class="btn" id="copy-checklist">Copy JSON</button>
</div>
</div>
</div>
</div>

<div id="help-modal" class="modal hidden" role="dialog" aria-labelledby="help-title">
<div class="modal-content help-overlay">
<div class="modal-header">
<h2 id="help-title">Keyboard Shortcuts</h2>
<button class="btn btn-secondary" id="close-help">√ó</button>
</div>
<div class="modal-body">
<dl style="margin:0;display:grid;gap:1rem">
<dt>N</dt><dd>New layout</dd>
<dt>S</dt><dd>Save layout</dd>
<dt>E</dt><dd>Export</dd>
<dt>?</dt><dd>Toggle help</dd>
<dt>Ctrl+Arrow</dt><dd>Move selected item</dd>
<dt>Delete</dt><dd>Remove selected item</dd>
<dt>Space/Enter</dt><dd>Pick up/drop component (keyboard drag)</dd>
</dl>
</div>
</div>
</div>

<script>
class LayoutBuilder{constructor(){this.layout={items:[],history:[],currentHistoryIndex:0,breakpoint:'desktop'};this.selectedItem=null;this.draggedItem=null;this.pickedItem=null;this.cellMapping={};this.init()}init(){this.loadState();this.bindEvents();this.renderCanvas();this.announce('Layout Builder loaded');window.addEventListener('keydown',e=>this.handleKeydown(e));window.addEventListener('resize',()=>this.handleResize())}bindEvents(){document.querySelectorAll('.component-btn').forEach(btn=>btn.addEventListener('dragstart',e=>this.handleDragStart(e)));document.querySelectorAll('.component-btn').forEach(btn=>{btn.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' ')this.handleKeyboardPick(btn,e);});});document.getElementById('canvas').addEventListener('dragover',e=>this.handleDragOver(e));document.getElementById('canvas').addEventListener('drop',e=>this.handleDrop(e));document.getElementById('canvas').addEventListener('keydown',e=>this.handleCanvasKeydown(e));document.getElementById('newBtn').addEventListener('click',()=>this.newLayout());document.getElementById('saveBtn').addEventListener('click',()=>this.saveLayout());document.getElementById('exportBtn').addEventListener('click',()=>this.showExport());document.getElementById('helpBtn').addEventListener('click',()=>this.toggleHelp());document.getElementById('close-modal').addEventListener('click',()=>this.hideModal());document.getElementById('close-help').addEventListener('click',()=>this.hideHelp());document.querySelectorAll('.modal-tab').forEach(tab=>tab.addEventListener('click',e=>this.switchTab(e)));document.getElementById('copy-html').addEventListener('click',()=>this.copyHtml());document.getElementById('copy-checklist').addEventListener('click',()=>this.copyChecklist())}handleDragStart(e){e.dataTransfer.effectAllowed='move';this.draggedItem={type:e.target.dataset.type,level:e.target.dataset.level||'h1'};e.target.setAttribute('aria-grabbed','true');this.announce('Component picked up');}handleDragOver(e){e.preventDefault();e.dataTransfer.dropEffect='move';const rect=e.currentTarget.getBoundingClientRect();const x=(e.clientX-rect.left)/rect.width*4;const y=(e.clientY-rect.top)/rect.height;const cellIndex=Math.floor(x+y*4)%16;this.highlightCell(cellIndex);}handleDrop(e){e.preventDefault();if(!this.draggedItem)return;const rect=e.currentTarget.getBoundingClientRect();const x=(e.clientX-rect.left)/rect.width*4;const y=(e.clientY-rect.top)/rect.height;const cellIndex=Math.floor(x+y*4)%16;this.addItemToCell(this.draggedItem,cellIndex);document.querySelector(`[data-type="${this.draggedItem.type}"]`).setAttribute('aria-grabbed','false');this.draggedItem=null;this.announce('Component dropped');}handleKeyboardPick(btn,e){e.preventDefault();if(this.pickedItem===btn){this.placePickedItem();return;}this.pickedItem=btn;this.pickedItem.setAttribute('aria-grabbed','true');btn.blur();this.announce('Component picked up, use arrow keys to move');}placePickedItem(){if(!this.pickedItem)return;const cellIndex=0;this.addItemToCell({type:this.pickedItem.dataset.type,level:this.pickedItem.dataset.level},cellIndex);this.pickedItem.setAttribute('aria-grabbed','false');this.pickedItem=null;this.announce('Component placed');}addItemToCell(itemData,cellIndex){const id=`item-${Date.now()}`;const item={id,type:itemData.type,level:itemData.level||'h1',content:'',cell:cellIndex,colSpan:1,properties:{}};this.layout.items.push(item);this.renderCanvas();this.selectItem(id);this.saveState();}highlightCell(cellIndex){document.querySelectorAll('.grid-cell').forEach(cell=>cell.classList.remove('focused'));const cell=document.querySelector(`[data-cell="${cellIndex}"]`);if(cell)cell.classList.add('focused');}renderCanvas(){const canvas=document.getElementById('canvas');const breakpoint=this.layout.breakpoint;canvas.className=`canvas ${breakpoint}`;canvas.setAttribute('data-breakpoint',breakpoint.charAt(0).toUpperCase()+breakpoint.slice(1));canvas.innerHTML='';for(let i=0;i<16;i++){const cell=document.createElement('div');cell.className='grid-cell';cell.dataset.cell=i;cell.addEventListener('click',()=>this.highlightCell(i));cell.addEventListener('dragover',e=>this.handleCellDragOver(e,i));cell.addEventListener('drop',e=>this.handleCellDrop(e,i));canvas.appendChild(cell);}this.layout.items.forEach(item=>{const cell=document.querySelector(`[data-cell="${item.cell}"]`);if(cell){const itemEl=this.createCanvasItem(item);cell.appendChild(itemEl);}});this.updateFocusManagement();}createCanvasItem(item){const div=document.createElement('div');div.className='canvas-item';div.dataset.id=item.id;div.tabIndex=0;div.setAttribute('role','article');div.setAttribute('aria-label',item.type);if(item.properties['aria-invalid'])div.setAttribute('aria-invalid','true');div.addEventListener('click',()=>this.selectItem(item.id));div.addEventListener('keydown',e=>this.handleItemKeydown(e,item));div.draggable=true;div.addEventListener('dragstart',e=>this.handleItemDragStart(e,item));switch(item.type){case'heading':{const h=document.createElement(item.level);h.textContent=item.content||`Sample ${item.level.toUpperCase()}`;div.appendChild(h);break;}case'paragraph':{const p=document.createElement('p');p.textContent=item.content||'Sample paragraph text...';div.appendChild(p);break;}case'button':{const btn=document.createElement('button');btn.textContent=item.content||'Sample Button';div.appendChild(btn);break;}case'image':{const img=document.createElement('img');img.src=item.properties.src||'';img.alt=item.properties.alt||'';img.style.width='100%';img.style.height='auto';div.appendChild(img);break;}case'form':{const label=document.createElement('label');label.textContent=item.properties.label||'Label:';const input=document.createElement('input');input.type=item.properties.type||'text';input.required=item.properties.required||false;label.appendChild(input);div.appendChild(label);break;}case'card':{const title=document.createElement('h3');title.textContent=item.properties.title||'Card Title';const body=document.createElement('p');body.textContent=item.properties.body||'Card content...';div.appendChild(title);div.appendChild(body);break;}case'spacer':{div.style.minHeight='60px';div.textContent='¬†';break;}}return div;}handleCellDragOver(e,cellIndex){e.preventDefault();e.dataTransfer.dropEffect='move';this.highlightCell(cellIndex);}handleCellDrop(e,cellIndex){e.preventDefault();if(this.draggedItem){this.layout.items.push({...this.draggedItem,cell:cellIndex});this.renderCanvas();this.saveState();}}handleItemDragStart(e,item){this.draggedItem=item;}selectItem(id){this.selectedItem=id;document.querySelectorAll('.canvas-item').forEach(el=>el.classList.remove('selected'));const selectedEl=document.querySelector(`[data-id="${id}"]`);if(selectedEl)selectedEl.classList.add('selected');this.renderInspector();this.announce(`Selected ${this.layout.items.find(i=>i.id===id)?.type}`);}renderInspector(){const inspector=document.getElementById('inspector-content');const warningsEl=document.getElementById('warnings');if(!this.selectedItem){inspector.innerHTML='<p>No component selected</p>';warningsEl.innerHTML='';return;}const item=this.layout.items.find(i=>i.id===this.selectedItem);document.getElementById('inspector-title').textContent=`${item.type} properties`;let html='';switch(item.type){case'heading':case'paragraph':html=`
<div class="inspector-field">
<label for="content-${item.id}">Content</label>
<textarea id="content-${item.id}">${item.content}</textarea>
</div>
`;break;case'image':html=`
<div class="inspector-field">
<label for="alt-${item.id}">Alt text <span class="error" id="alt-warning" style="display:none">(Required)</span></label>
<input id="alt-${item.id}" value="${item.properties.alt||''}">
</div>
<div class="inspector-field">
<label for="src-${item.id}">Image URL</label>
<input id="src-${item.id}" value="${item.properties.src||''}">
</div>
`;break;case'form':html=`
<div class="inspector-field">
<label for="label-${item.id}">Label text</label>
<input id="label-${item.id}" value="${item.properties.label||''}">
</div>
<div class="inspector-field">
<label for="type-${item.id}">Input type</label>
<select id="type-${item.id}">
<option value="text" ${item.properties.type==='text'?'selected':''}>Text</option>
<option value="email" ${item.properties.type==='email'?'selected':''}>Email</option>
<option value="tel" ${item.properties.type==='tel'?'selected':''}>Phone</option>
</select>
</div>
<div class="inspector-field">
<label>
<input type="checkbox" id="required-${item.id}" ${item.properties.required?'checked':''}> Required
</label>
</div>
`;break;case'card':html=`
<div class="inspector-field">
<label for="title-${item.id}">Title</label>
<input id="title-${item.id}" value="${item.properties.title||''}">
</div>
<div class="inspector-field">
<label for="body-${item.id}">Body</label>
<textarea id="body-${item.id}">${item.properties.body||''}</textarea>
</div>
`;break;default:html='<p>Basic properties</p>';}html+=`
<div class="inspector-field">
<label for="colspan-${item.id}">Column span</label>
<select id="colspan-${item.id}">
<option value="1" ${item.colSpan===1?'selected':''}>1 column</option>
<option value="2" ${item.colSpan===2?'selected':''}>2 columns</option>
</select>
</div>
<div class="inspector-field">
<label for="aria-live-${item.id}">ARIA live</label>
<select id="aria-live-${item.id}">
<option value="off" ${item.properties['aria-live']==='off'?'selected':''}>Off</option>
<option value="polite" ${item.properties['aria-live']==='polite'?'selected':''}>Polite</option>
<option value="assertive" ${item.properties['aria-live']==='assertive'?'selected':''}>Assertive</option>
</select>
</div>
`;inspector.innerHTML=html;this.bindInspectorFields(item);this.renderWarnings(item);}bindInspectorFields(item){const fields=['content','alt','src','label','type','title','body','colspan','aria-live'];fields.forEach(field=>{const el=document.getElementById(`${field}-${item.id}`);if(el){if(el.tagName==='TEXTAREA'||el.tagName==='INPUT'||el.tagName==='SELECT'){el.addEventListener('input',()=>this.updateItemProperty(item,field,el.value));el.addEventListener('change',()=>this.saveState());}}});const requiredEl=document.getElementById(`required-${item.id}`);if(requiredEl){requiredEl.addEventListener('change',()=>this.updateItemProperty(item,'required',requiredEl.checked));}}updateItemProperty(item,prop,value){item.content=item.type==='heading'||item.type==='paragraph'?value:item.content;item.properties[prop]=value;if(item.type==='image'&&prop==='alt'){item.properties['aria-invalid']=!value.trim();}if(item.type==='form'&&prop==='label'){item.properties['has-label']=!!value.trim();}this.renderCanvas();this.renderInspector();this.saveState();}renderWarnings(item){const warningsEl=document.getElementById('warnings');let warnings=[];if(item.type==='image'&&!item.properties.alt?.trim()){warnings.push({type:'error',message:'Missing alt text',fix:'Add descriptive alt text'});}if(item.type==='form'&&!item.properties.label?.trim()){warnings.push({type:'warning',message:'Missing form label',fix:'Add label text'});}warningsEl.innerHTML=warnings.map(w=>`<div class="${w.type}">${w.message}<br><small>${w.fix}</small></div>`).join('');}handleKeydown(e){if(e.target.closest('.modal'))return;switch(e.key){case'N':case'n':e.preventDefault();this.newLayout();break;case'S':case's':e.preventDefault();this.saveLayout();break;case'E':case'e':e.preventDefault();this.showExport();break;case'Delete':case'Del':if(this.selectedItem){this.deleteItem();}break;case'?':e.preventDefault();this.toggleHelp();break;default:if(e.ctrlKey&&(e.key==='ArrowUp'||e.key==='ArrowDown'||e.key==='ArrowLeft'||e.key==='ArrowRight')){e.preventDefault();this.moveSelectedItem(e.key);}}}handleCanvasKeydown(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();const focused=document.activeElement.closest('.grid-cell');if(focused){const cellIndex=parseInt(focused.dataset.cell);this.highlightCell(cellIndex);}}}handleItemKeydown(e,item){}moveSelectedItem(direction){if(!this.selectedItem)return;const item=this.layout.items.find(i=>i.id===this.selectedItem);const cols={mobile:1,tablet:2,desktop:4}[this.layout.breakpoint];let newCell=item.cell;switch(direction){case'ArrowUp':newCell=Math.max(0,item.cell-cols);break;case'ArrowDown':newCell=Math.min(15,item.cell+cols);break;case'ArrowLeft':newCell=Math.max(0,item.cell-1);break;case'ArrowRight':newCell=Math.min(15,item.cell+1);break;}item.cell=newCell;this.renderCanvas();this.selectItem(item.id);this.saveState();this.announce(`Moved ${direction}`);}newLayout(){if(confirm('Discard current layout?')){this.layout.items=[];this.selectedItem=null;this.renderCanvas();this.renderInspector();this.saveState();this.announce('New layout created');}}deleteItem(){if(this.selectedItem&&confirm('Delete selected item?')){this.layout.items=this.layout.items.filter(i=>i.id!==this.selectedItem);this.selectedItem=null;this.renderCanvas();this.renderInspector();this.saveState();this.announce('Item deleted');}}saveLayout(){this.saveState();this.announce('Layout saved');}showExport(){const html=this.generateHtml();const checklist=this.generateChecklist();document.getElementById('html-output').value=html;document.getElementById('checklist-output').textContent=JSON.stringify(checklist,null,2);document.getElementById('export-modal').classList.remove('hidden');this.trapFocus(document.getElementById('export-modal'));this.announce('Export modal opened');}generateHtml(){let html=`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Exported Layout</title>
<style>
body{font-family:system-ui,sans-serif;max-width:1200px;margin:0 auto;padding:2rem;display:grid;gap:2rem;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
@media(max-width:768px){body{grid-template-columns:1fr;padding:1rem}}
</style>
</head>
<body>`;html+='<main>';this.layout.items.forEach(item=>{html+=this.itemToHtml(item);});html+='</main></body></html>';return html;}itemToHtml(item){let el='';switch(item.type){case'heading':el=`<${item.level}>${item.content||''}</${item.level}>`;break;case'paragraph':el=`<p>${item.content||''}</p>`;break;case'image':el=`<img src="${item.properties.src||''}" alt="${item.properties.alt||''}">`;break;case'form':el=`<label>${item.properties.label||''}<input type="${item.properties.type||'text'}" ${item.properties.required?'required':''}></label>`;break;case'card':el=`<article><h3>${item.properties.title||''}</h3><p>${item.properties.body||''}</p></article>`;break;default:el='<div>¬†</div>';}return el;}generateChecklist(){const issues=[];this.layout.items.forEach(item=>{if(item.type==='image'&&!item.properties.alt?.trim()){issues.push({id:item.id,type:'error',severity:'error',message:'Missing alt text',suggestedFix:'Add descriptive alt text'});}if(item.type==='form'&&!item.properties.label?.trim()){issues.push({id:item.id,type:'warning',severity:'warning',message:'Missing form label',suggestedFix:'Add label text'});}});return issues;}copyHtml(){navigator.clipboard.writeText(document.getElementById('html-output').value);this.announce('HTML copied');}copyChecklist(){navigator.clipboard.writeText(document.getElementById('checklist-output').textContent);this.announce('Checklist copied');}toggleHelp(){const modal=document.getElementById('help-modal');modal.classList.toggle('hidden');if(!modal.classList.contains('hidden')){this.trapFocus(modal);}}hideModal(){document.getElementById('export-modal').classList.add('hidden');document.activeElement.blur();}hideHelp(){document.getElementById('help-modal').classList.add('hidden');}switchTab(e){document.querySelectorAll('.modal-tab').forEach(tab=>tab.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(content=>content.classList.remove('active'));e.target.classList.add('active');document.getElementById(`tab-${e.target.dataset.tab}`).classList.add('active');}announce(message){const live=document.getElementById('live-region');live.textContent=message;setTimeout(()=>live.textContent='',3000);}saveState(){try{localStorage.setItem('layout-builder',JSON.stringify(this.layout));}catch(e){console.warn('Storage save failed');}}loadState(){try{const saved=localStorage.getItem('layout-builder');if(saved){this.layout=JSON.parse(saved);this.renderCanvas();}}catch(e){console.warn('Storage load failed');}}updateFocusManagement(){document.querySelectorAll('.canvas-item').forEach((el,i)=>el.setAttribute('tabindex',i===0?0:-1));}trapFocus(modal){const focusable=modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');const first=focusable[0];const last=focusable[focusable.length-1];modal.addEventListener('keydown',e=>{if(e.key==='Tab'){if(e.shiftKey){if(document.activeElement===first){e.preventDefault();last.focus();}}else{if(document.activeElement===last){e.preventDefault();first.focus();}}}});}handleResize(){}}
new LayoutBuilder();
</script>
</body>
</html>