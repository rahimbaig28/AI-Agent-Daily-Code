<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2026-01-27T11:35:02.070850Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Forge</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.2s ease;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #0f172a;
                --bg-secondary: #1e293b;
                --text-primary: #f8fafc;
                --text-secondary: #cbd5e1;
                --border: #334155;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        select, button {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        select:focus, button:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        button:hover {
            background: var(--bg-secondary);
            transform: translateY(-1px);
        }

        button.primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        button.primary:hover {
            background: var(--accent-hover);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card.flipped .front { display: none; }
        .card.flipped .back { display: block; }

        .card .front, .card .back {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .card .back { display: none; }

        .card-content {
            font-size: clamp(1rem, 4vw, 1.25rem);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .card-rating {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .study-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal[open] {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
        }

        textarea:focus {
            outline: 2px solid var(--accent);
            outline-offset: -2px;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        .stats {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .study-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .study-mode[open] {
            display: flex;
        }

        .study-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .study-card {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            perspective: 1000px;
        }

        .study-flip-card {
            width: 100%;
            max-width: 500px;
            height: 300px;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .study-flip-card.flipped {
            transform: rotateY(180deg);
        }

        .study-flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .study-flip-card.flipped .study-flip-card-inner {
            transform: rotateY(180deg);
        }

        .study-card-side {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: var(--shadow-lg);
        }

        .study-card-side.back {
            transform: rotateY(180deg);
        }

        .rating {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .star {
            width: 2rem;
            height: 2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .star.filled {
            color: #fbbf24;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1rem;
            }
        }

        @media (min-width: 320px) and (max-width: 480px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media print {
            header, footer, .controls, .study-btn, .modal {
                display: none !important;
            }
            .grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .card {
                border: 2px solid #000;
                page-break-inside: avoid;
                height: auto;
                break-inside: avoid;
            }
            .card.flipped .back,
            .card .back {
                display: block;
                position: relative;
            }
            .card.flipped .front {
                display: block;
                margin-bottom: 1rem;
                font-weight: bold;
            }
        }

        .drag-over {
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üó°Ô∏è Flashcard Forge</h1>
            <div class="controls">
                <button id="theme-toggle" aria-label="Toggle theme">üåô</button>
                <select id="deck-selector">
                    <option value="">Select deck...</option>
                </select>
                <button id="add-deck" class="primary">+ New Deck</button>
                <button id="add-card" class="primary">+ New Card</button>
            </div>
        </header>

        <main id="main-content">
            <div id="empty-state" class="empty-state">
                <h2>Welcome to Flashcard Forge</h2>
                <p>Create your first deck to get started!</p>
                <button id="create-first-deck" class="primary" style="margin-top: 1rem; padding: 1rem 2rem; font-size: 1.125rem;">Create First Deck</button>
            </div>

            <div id="cards-grid" class="grid hidden"></div>
        </main>

        <footer>
            <div class="stats">
                <span id="total-cards">0 cards total</span>
                <span id="current-deck-stats"></span>
            </div>
            <button id="clear-all" style="background: #ef4444; color: white;">‚ö†Ô∏è Clear All Data</button>
        </footer>
    </div>

    <!-- Add Card Modal -->
    <div id="add-card-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-content">
            <h2 id="modal-title">Add New Card</h2>
            <form id="card-form">
                <div class="form-group">
                    <label for="card-front">Front (Question)</label>
                    <textarea id="card-front" required placeholder="What is the capital of France?"></textarea>
                </div>
                <div class="form-group">
                    <label for="card-back">Back (Answer)</label>
                    <textarea id="card-back" required placeholder="Paris"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" id="cancel-card">Cancel</button>
                    <button type="submit" class="primary">Save Card</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Deck Modal -->
    <div id="add-deck-modal" class="modal" role="dialog" aria-labelledby="deck-modal-title" aria-hidden="true">
        <div class="modal-content">
            <h2 id="deck-modal-title">New Deck</h2>
            <form id="deck-form">
                <div class="form-group">
                    <label for="deck-name">Deck Name</label>
                    <input type="text" id="deck-name" required placeholder="Mathematics" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); font-size: 1rem;">
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" id="cancel-deck">Cancel</button>
                    <button type="submit" class="primary">Create Deck</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Study Mode -->
    <div id="study-mode" class="study-mode" role="dialog" aria-hidden="true">
        <div class="study-header">
            <div>
                <button id="study-prev" aria-label="Previous card">‚Üê</button>
                <span id="study-counter" aria-live="polite"></span>
                <button id="study-next" aria-label="Next card">‚Üí</button>
            </div>
            <div>
                <button id="study-exit" aria-label="Exit study mode">‚úï</button>
            </div>
        </div>
        <div class="study-card">
            <div id="study-flip-card" class="study-flip-card" tabindex="0">
                <div class="study-flip-card-inner">
                    <div class="study-card-side front" id="study-front"></div>
                    <div class="study-card-side back" id="study-back"></div>
                </div>
            </div>
        </div>
        <div class="rating" id="study-rating" style="display: none;">
            <span>Rate your recall:</span>
            <div style="display: flex; gap: 0.25rem;">
                <span class="star" data-rating="1" aria-label="1 star" tabindex="0">‚òÜ</span>
                <span class="star" data-rating="2" aria-label="2 stars" tabindex="0">‚òÜ</span>
                <span class="star" data-rating="3" aria-label="3 stars" tabindex="0">‚òÜ</span>
                <span class="star" data-rating="4" aria-label="4 stars" tabindex="0">‚òÜ</span>
                <span class="star" data-rating="5" aria-label="5 stars" tabindex="0">‚òÜ</span>
            </div>
        </div>
        <div class="nav-buttons">
            <button id="study-prev-mobile" style="font-size: 1.5rem; padding: 1rem 2rem;">‚Üê Prev</button>
            <button id="study-next-mobile" style="font-size: 1.5rem; padding: 1rem 2rem;">Next ‚Üí</button>
        </div>
    </div>

    <script>
        class FlashcardForge {
            constructor() {
                this.decks = [];
                this.currentDeckId = null;
                this.currentStudyIndex = 0;
                this.studyDeck = [];
                this.draggedCard = null;
                this.init();
            }

            init() {
                this.loadData();
                this.bindEvents();
                this.updateDeckSelector();
                this.render();
                this.updateStats();
                this.updateTheme();
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => this.updateTheme());
            }

            bindEvents() {
                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => this.toggleTheme());

                // Deck management
                document.getElementById('deck-selector').addEventListener('change', (e) => {
                    this.currentDeckId = e.target.value || null;
                    this.render();
                    this.updateStats();
                });

                document.getElementById('add-deck').addEventListener('click', () => this.showDeckModal());
                document.getElementById('create-first-deck').addEventListener('click', () => this.showDeckModal());

                document.getElementById('deck-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createDeck();
                });
                document.getElementById('cancel-deck').addEventListener('click', () => this.hideDeckModal());

                // Card management
                document.getElementById('add-card').addEventListener('click', () => this.showCardModal());
                document.getElementById('card-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveCard();
                });
                document.getElementById('cancel-card').addEventListener('click', () => this.hideCardModal());

                // Clear all
                document.getElementById('clear-all').addEventListener('click', () => {
                    if (confirm('Delete ALL decks and cards? This cannot be undone.')) {
                        this.clearAllData();
                    }
                });

                // Study mode
                document.getElementById('study-exit').addEventListener('click', () => this.exitStudyMode());
                document.getElementById('study-prev').addEventListener('click', () => this.studyPrev());
                document.getElementById('study-next').addEventListener('click', () => this.studyNext());
                document.getElementById('study-prev-mobile').addEventListener('click', () => this.studyPrev());
                document.getElementById('study-next-mobile').addEventListener('click', () => this.studyNext());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.handleKeydown(e));

                // Drag & drop
                document.getElementById('cards-grid').addEventListener('dragover', (e) => this.handleDragOver(e));
                document.getElementById('cards-grid').addEventListener('drop', (e) => this.handleDrop(e));
            }

            loadData() {
                try {
                    const data = localStorage.getItem('flashcard-forge');
                    if (data) {
                        this.decks = JSON.parse(data);
                    }
                } catch (e) {
                    console.error('Failed to load data:', e);
                    this.decks = [];
                }
            }

            saveData() {
                try {
                    localStorage.setItem('flashcard-forge', JSON.stringify(this.decks));
                } catch (e) {
                    console.error('Failed to save data:', e);
                }
            }

            updateDeckSelector() {
                const select = document.getElementById('deck-selector');
                select.innerHTML = '<option value="">All decks</option>';
                this.decks.forEach(deck => {
                    const option = document.createElement('option');
                    option.value = deck.id;
                    option.textContent = `${deck.name} (${deck.cards.length})`;
                    select.appendChild(option);
                });
            }

            render() {
                const grid = document.getElementById('cards-grid');
                const emptyState = document.getElementById('empty-state');

                if (this.decks.length === 0) {
                    grid.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                grid.classList.remove('hidden');

                let cards = [];
                if (this.currentDeckId) {
                    const deck = this.decks.find(d => d.id === this.currentDeckId);
                    if (deck) cards = deck.cards;
                } else {
                    this.decks.forEach(deck => {
                        deck.cards.forEach(card => cards.push({ ...card, deckId: deck.id, deckName: deck.name }));
                    });
                }

                // Virtualize for large decks
                if (cards.length > 50) {
                    cards = cards.slice(0, 50);
                }

                grid.innerHTML = cards.map(card => `
                    <div class="card" 
                         data-card-id="${card.id}" 
                         data-deck-id="${card.deckId}"
                         draggable="true"
                         tabindex="0"
                         role="button"
                         aria-label="Flashcard: ${card.front}"
                         aria-pressed="false">
                        <div class="front">
                            <div class="card-content">${this.truncate(card.front, 100)}</div>
                            <div class="card-rating">‚≠ê ${card.rating}/5</div>
                        </div>
                        <div class="back">
                            <div class="card-content">${this.truncate(card.back, 100)}</div>
                            <div class="card-rating">‚≠ê ${card.rating}/5</div>
                        </div>
                        ${card.deckId === this.currentDeckId ? 
                            `<button class="study-btn primary" onclick="forge.studyDeck('${card.deckId}')" aria-label="Study ${card.deckName} deck">Study</button>` : 
                            `<div style="position: absolute; top: 0.5rem; left: 0.5rem; font-size: 0.75rem; color: var(--text-secondary);">${card.deckName}</div>`
                        }
                    </div>
                `).join('');

                // Bind card events after render
                grid.querySelectorAll('.card').forEach(cardEl => {
                    cardEl.addEventListener('click', (e) => {
                        if (e.target.closest('.study-btn')) return;
                        cardEl.classList.toggle('flipped');
                        cardEl.setAttribute('aria-pressed', cardEl.classList.contains('flipped'));
                    });

                    cardEl.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            cardEl.classList.toggle('flipped');
                            cardEl.setAttribute('aria-pressed', cardEl.classList.contains('flipped'));
                        }
                    });

                    cardEl.addEventListener('dblclick', (e) => {
                        if (e.target.closest('.study-btn')) return;
                        this.editCard(card.dataset.cardId, card.dataset.deckId);
                    });

                    cardEl.addEventListener('dragstart', (e) => {
                        this.draggedCard = cardEl;
                        e.dataTransfer.effectAllowed = 'move';
                    });
                });
            }

            truncate(text, maxLength) {
                return text.length > maxLength ? text.slice(0, maxLength) + '...' : text;
            }

            async handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                e.currentTarget.closest('.card')?.classList.add('drag-over');
            }

            async handleDrop(e) {
                e.preventDefault();
                document.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
                
                if (this.draggedCard && this.draggedCard !== e.target.closest('.card')) {
                    const draggedRect = this.draggedCard.getBoundingClientRect();
                    const targetRect = e.target.closest('.card').getBoundingClientRect();
                    
                    const deckId = this.draggedCard.dataset.deckId;
                    const deck = this.decks.find(d => d.id === deckId);
                    if (deck) {
                        const draggedIndex = deck.cards.findIndex(c => c.id === this.draggedCard.dataset.cardId);
                        const targetIndex = deck.cards.findIndex(c => c.id === e.target.closest('.card').dataset.cardId);
                        
                        const [movedCard] = deck.cards.splice(draggedIndex, 1);
                        deck.cards.splice(targetIndex, 0, movedCard);
                        
                        this.saveData();
                        this.render();
                    }
                }
            }

            showCardModal(deckId = null, card = null) {
                document.getElementById('card-front').value = card?.front || '';
                document.getElementById('card-back').value = card?.back || '';
                document.getElementById('add-card-modal').setAttribute('data-editing', card ? card.id : '');
                document.getElementById('add-card-modal').setAttribute('data-deck-id', deckId || this.currentDeckId || '');
                document.getElementById('add-card-modal').toggleAttribute('open');
                document.getElementById('card-front').focus();
            }

            hideCardModal() {
                document.getElementById('add-card-modal').removeAttribute('open');
                document.getElementById('card-form').reset();
            }

            showDeckModal() {
                document.getElementById('deck-name').value = '';
                document.getElementById('add-deck-modal').toggleAttribute('open');
                document.getElementById('deck-name').focus();
            }

            hideDeckModal() {
                document.getElementById('add-deck-modal').removeAttribute('open');
            }

            createDeck() {
                const name = document.getElementById('deck-name').value.trim();
                if (!name) return;

                const deck = {
                    id: 'deck_' + Date.now(),
                    name,
                    cards: []
                };
                this.decks.push(deck);
                this.saveData();
                this.updateDeckSelector();
                this.hideDeckModal();
                this.currentDeckId = deck.id;
                document.getElementById('deck-selector').value = deck.id;
                this.render();
                this.updateStats();
            }

            saveCard() {
                const front = document.getElementById('card-front').value.trim();
                const back = document.getElementById('card-back').value.trim();
                const editingId = document.getElementById('add-card-modal').getAttribute('data-editing');
                const deckId = document.getElementById('add-card-modal').getAttribute('data-deck-id');

                if (!front || !back || !deckId) return;

                const deck = this.decks.find(d => d.id === deckId);
                if (!deck) return;

                if (editingId) {
                    // Edit existing
                    const card = deck.cards.find(c => c.id === editingId);
                    if (card) {
                        card.front = front;
                        card.back = back;
                    }
                } else {
                    // Create new
                    deck.cards.push({
                        id: 'card_' + Date.now(),
                        front,
                        back,
                        rating: 0
                    });
                }

                this.saveData();
                this.hideCardModal();
                this.render();
                this.updateStats();
            }

            editCard(cardId, deckId) {
                const deck = this.decks.find(d => d.id === deckId);
                const card = deck?.cards.find(c => c.id === cardId);
                if (card) {
                    this.showCardModal(deckId, card);
                }
            }

            deleteCard(cardId, deckId) {
                if (!confirm('Delete this card?')) return;
                const deck = this.decks.find(d => d.id === deckId);
                if (deck) {
                    deck.cards = deck.cards.filter(c => c.id !== cardId);
                    if (deck.cards.length === 0) {
                        this.decks = this.decks.filter(d => d.id !== deckId);
                        this.currentDeckId = null;
                    }
                    this.saveData();
                    this.updateDeckSelector();
                    this.render();
                    this.updateStats();
                }
            }

            studyDeck(deckId) {
                const deck = this.decks.find(d => d.id === deckId);
                if (!deck || deck.cards.length === 0) return;

                this.studyDeck = [...deck.cards];
                this.currentStudyIndex = 0;
                this.enterStudyMode();
            }

            enterStudyMode() {
                document.getElementById('study-mode').toggleAttribute('open');
                this.renderStudyCard();
                document.getElementById('study-flip-card').focus();
            }

            exitStudyMode() {
                document.getElementById('study-mode').removeAttribute('open');
                document.getElementById('study-rating').style.display = 'none';
            }

            renderStudyCard() {
                if (this.studyDeck.length === 0) return;

                const card = this.studyDeck[this.currentStudyIndex];
                document.getElementById('study-front').textContent = card.front;
                document.getElementById('study-back').textContent = card.back;
                document.getElementById('study-counter').textContent = 
                    `Card ${this.currentStudyIndex + 1} of ${this.studyDeck.length}`;
                
                document.getElementById('study-flip-card').classList.remove('flipped');
                document.getElementById('study-rating').style.display = 'none';
                
                // Reset stars
                document.querySelectorAll('#study-rating .star').forEach(star => {
                    star.classList.remove('filled');
                    star.setAttribute('aria-label', `${star.dataset.rating} star`);
                });
            }

            studyNext() {
                if (document.getElementById('study-rating').style.display === 'flex') {
                    this.nextCard();
                } else {
                    document.getElementById('study-flip-card').classList.add('flipped');
                    document.getElementById('study-rating').style.display = 'flex';
                }
            }

            studyPrev() {
                this.currentStudyIndex = Math.max(0, this.currentStudyIndex - 1);
                this.renderStudyCard();
            }

            nextCard() {
                const rating = document.querySelector('#study-rating .star.filled')?.dataset.rating || 0;
                const card = this.studyDeck[this.currentStudyIndex];
                if (card) {
                    card.rating = parseInt(rating);
                }
                
                this.currentStudyIndex = (this.currentStudyIndex + 1) % this.studyDeck.length;
                this.saveData();
                
                if (this.currentStudyIndex === 0) {
                    this.updateStats();
                }
                
                this.renderStudyCard();
            }

            updateStats() {
                const total = this.decks.reduce((sum, deck) => sum + deck.cards.length, 0);
                document.getElementById('total-cards').textContent = `${total} cards total`;

                if (this.currentDeckId) {
                    const deck = this.decks.find(d => d.id === this.currentDeckId);
                    if (deck) {
                        const avgRating = deck.cards.reduce((sum, c) => sum + c.rating, 0) / Math.max(1, deck.cards.length);
                        document.getElementById('current-deck-stats').textContent = 
                            `${deck.cards.length} cards ‚Ä¢ ${avgRating.toFixed(1)}/5 avg`;
                    }
                } else {
                    document.getElementById('current-deck-stats').textContent = '';
                }
            }

            handleKeydown(e) {
                // Global shortcuts
                if (e.target.closest('.modal')) return;

                if (e.key === 'Escape') {
                    this.hideCardModal();
                    this.hideDeckModal();
                    this.exitStudyMode();
                }

                if (e.key === '+' || e.key === '=') {
                    e.preventDefault();
                    this.showCardModal();
                }

                // Study mode shortcuts
                if (document.getElementById('study-mode').hasAttribute('open')) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.studyNext();
                    }
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        this.studyPrev();
                    }
                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        this.studyNext();
                    }
                    if (e.key >= '1' && e.key <= '5') {
                        e.preventDefault();
                        const rating = parseInt(e.key);
                        this.setStudyRating(rating);
                        this.nextCard();
                    }
                    return;
                }

                // Grid navigation
                const grid = document.getElementById('cards-grid');
                if (grid.classList.contains('hidden')) return;

                const cards = Array.from(grid.querySelectorAll('.card'));
                const focused = document.activeElement.closest('.card');
                let currentIndex = focused ? cards.indexOf(focused) : -1;

                if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                    e.preventDefault();
                    const target = cards[Math.max(0, currentIndex - 1)] || cards[0];
                    target.focus();
                } else if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                    e.preventDefault();
                    const target = cards[Math.min(cards.length - 1, currentIndex + 1)] || cards[cards.length - 1];
                    target.focus();
                }
            }

            setStudyRating(rating) {
                document.querySelectorAll('#study-rating .star').forEach((star, i) => {
                    if (i < rating) {
                        star.classList.add('filled');
                        star.textContent = '‚òÖ';
                        star.setAttribute('aria-label', `${i + 1} stars selected`);
                    } else {
                        star.classList.remove('filled');
                        star.textContent = '‚òÜ';
                    }
                });
            }

            toggleTheme() {
                document.body.classList.toggle('dark');
                localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
                document.getElementById('theme-toggle').textContent = 
                    document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
            }

            updateTheme() {
                const saved = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (saved === 'dark' || (!saved && prefersDark)) {
                    document.body.classList.add('dark');
                    document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
                } else {
                    document.body.classList.remove('dark');
                    document.getElementById('theme-toggle').textContent = 'üåô';
                }
            }

            clearAllData() {
                localStorage.removeItem('flashcard-forge');
                localStorage.removeItem('theme');
                this.decks = [];
                this.currentDeckId = null;
                this.updateDeckSelector();
                this.render();
                this.updateStats();
            }
        }

        // Touch/swipe support for mobile
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;

            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    // Swipe left - next
                    if (document.getElementById('study-mode').hasAttribute('open')) {
                        forge.studyNext();
                    }
                } else {
                    // Swipe right - prev
                    if (document.getElementById('study-mode').hasAttribute('open')) {
                        forge.studyPrev();
                    }
                }
            }
        });

        // Study rating stars
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('star')) {
                const rating = parseInt(e.target.dataset.rating);
                forge.setStudyRating(rating);
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.target.classList && e.target.classList.contains('star')) {
                const rating = parseInt(e.target.dataset.rating);
                forge.setStudyRating(rating);
            }
        });

        // Global study mode stars
        document.querySelectorAll('#study-rating .star').forEach(star => {
            star.addEventListener('click', () => {
                const rating = parseInt(star.dataset.rating);
                forge.setStudyRating(rating);
            });
            star.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const rating = parseInt(star.dataset.rating);
                    forge.setStudyRating(rating);
                    forge.nextCard();
                }
            });
        });

        // Initialize app
        const forge = new FlashcardForge();
    </script>
</body>
</html>