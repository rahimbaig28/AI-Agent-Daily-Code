<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-12-19T08:31:42.622934Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Eco Footprint Tracker</title>
<style>
:root {
  --bg:#0b0b0b; --fg:#e6eef3; --card:#111316; --muted:#99a3a8; --accent:#3ecf8e; --danger:#ff6b6b;
}
@media (prefers-color-scheme: light) {
  :root{ --bg:#f6f8fa; --fg:#0b1112; --card:#ffffff; --muted:#556; --accent:#0a8f58; --danger:#c14444; }
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
.container{max-width:1000px;margin:20px auto;padding:16px;}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
h1{
  margin:0;font-size:1.2rem;
}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px;}
label{display:block;font-size:0.8rem;color:var(--muted);margin-bottom:6px}
input[type="number"],select,input[type="date"]{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--fg)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;background:var(--accent);color:black;border:none;cursor:pointer}
.btn:focus{outline:3px solid rgba(62,207,142,0.2)}
.small{font-size:0.9rem;color:var(--muted)}
.row{display:flex;gap:12px;flex-wrap:wrap}
.metrics{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.metric{flex:1;min-width:140px;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
canvas{width:100%;height:240px;border-radius:8px;background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent);display:block}
.footer{margin-top:12px;color:var(--muted);font-size:0.85rem}
.tips{margin-top:8px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)}
.share{margin-left:auto;display:flex;gap:8px;align-items:center}
@media (max-width:560px){.metrics{flex-direction:column}}
.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
code{background:rgba(255,255,255,0.03);padding:2px 6px;border-radius:4px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <h1>Eco Footprint Tracker</h1>
      <div class="small">Track daily carbon for food, transport, and energy.</div>
    </div>
    <div class="share">
      <button id="exportBtn" class="btn" aria-label="Generate share link">Share Week</button>
      <button id="refreshBtn" class="btn" aria-label="Refresh data">Refresh</button>
    </div>
  </div>

  <div class="card" style="margin-top:12px" role="region" aria-labelledby="entryFormHeading">
    <h2 id="entryFormHeading" style="margin:0;font-size:1rem">Today's / Selected Date Entry</h2>
    <form id="entryForm" class="form-grid" aria-describedby="formDesc">
      <div>
        <label for="date">Date</label>
        <input type="date" id="date" name="date" aria-label="Date" required>
      </div>
      <div>
        <label for="km">Distance driven (km)</label>
        <input type="number" id="km" name="km" min="0" step="0.1" aria-label="Kilometers driven" inputmode="decimal">
      </div>
      <div>
        <label for="transport">Transport type</label>
        <select id="transport" name="transport" aria-label="Transport type">
          <option value="car">Car</option>
          <option value="bus">Bus</option>
          <option value="train">Train</option>
          <option value="flight">Flight</option>
        </select>
      </div>
      <div>
        <label for="kwh">Electricity (kWh)</label>
        <input type="number" id="kwh" name="kwh" min="0" step="0.1" aria-label="Kilowatt hours used">
      </div>

      <div>
        <label for="meat_beef">Beef meals (count)</label>
        <input type="number" id="meat_beef" name="meat_beef" min="0" step="1" aria-label="Beef meals count">
      </div>
      <div>
        <label for="meat_chicken">Chicken meals (count)</label>
        <input type="number" id="meat_chicken" name="meat_chicken" min="0" step="1" aria-label="Chicken meals count">
      </div>
      <div>
        <label for="veg">Vegetarian meals (count)</label>
        <input type="number" id="veg" name="veg" min="0" step="1" aria-label="Vegetarian meals count">
      </div>
      <div>
        <label for="vegan">Vegan meals (count)</label>
        <input type="number" id="vegan" name="vegan" min="0" step="1" aria-label="Vegan meals count">
      </div>

      <div style="grid-column:1/-1;display:flex;gap:8px;align-items:center;margin-top:8px">
        <button type="submit" id="addBtn" class="btn" aria-label="Add entry (Enter)">Add / Save</button>
        <div class="small" id="formDesc">Use Tab to navigate. Press Enter to submit.</div>
      </div>
    </form>
  </div>

  <div class="row" style="margin-top:12px">
    <div class="card" style="flex:2;min-width:280px">
      <h3 style="margin:0;font-size:0.95rem">Last 30 days</h3>
      <canvas id="lineChart" role="img" aria-label="Line chart of daily totals (last 30 days)"></canvas>
    </div>
    <div class="card" style="flex:1;min-width:220px">
      <h3 style="margin:0;font-size:0.95rem">Summary</h3>
      <div class="metrics" id="metrics">
        <div class="metric">
          <div class="small">Weekly avg (kg/day)</div>
          <div id="weeklyAvg" style="font-weight:600;font-size:1.2rem">—</div>
        </div>
        <div class="metric">
          <div class="small">Monthly total (kg)</div>
          <div id="monthlyTotal" style="font-weight:600;font-size:1.2rem">—</div>
        </div>
        <div class="metric">
          <div class="small">Footprint (tons CO2)</div>
          <div id="scoreTons" style="font-weight:600;font-size:1.2rem">—</div>
        </div>
      </div>
      <div class="tips" id="tips" aria-live="polite">Loading tips…</div>
    </div>
  </div>

  <div class="footer small">Data stored locally in <code>footprint.json</code>. The app auto-backups to <code>footprint_backup.json</code>.</div>
</div>

<script>
(() => {
  const API_DATA = '/data';
  const API_SAVE = '/save';
  const dateInput = document.getElementById('date');
  const form = document.getElementById('entryForm');
  const lineCanvas = document.getElementById('lineChart');
  const weeklyAvgEl = document.getElementById('weeklyAvg');
  const monthlyTotalEl = document.getElementById('monthlyTotal');
  const scoreTonsEl = document.getElementById('scoreTons');
  const tipsEl = document.getElementById('tips');
  const exportBtn = document.getElementById('exportBtn');
  const refreshBtn = document.getElementById('refreshBtn');

  // Set date default to today (browser local)
  const today = new Date();
  dateInput.value = today.toISOString().slice(0,10);

  // keyboard: Enter to submit from any input
  form.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
      e.preventDefault();
      form.requestSubmit();
    }
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    // Validate numeric non-negative
    for (const key of ['km','kwh','meat_beef','meat_chicken','veg','vegan']) {
      const val = fd.get(key);
      if (val === null || val === '') continue;
      const num = Number(val);
      if (!isFinite(num) || num < 0) {
        alert('Please provide non-negative numbers.');
        return;
      }
    }
    const body = new URLSearchParams();
    for (const [k,v] of fd.entries()) body.append(k,v);
    try {
      const resp = await fetch(API_SAVE, {
        method:'POST',
        body: body.toString(),
        headers: {'Content-Type':'application/x-www-form-urlencoded'}
      });
      if (!resp.ok) throw new Error('Save failed');
      await refresh();
    } catch (err) {
      alert('Save failed: '+err.message);
    }
  });

  refreshBtn.addEventListener('click', (e)=>{ refresh(); });

  exportBtn.addEventListener('click', ()=>{ generateShare(); });

  // Fetch data and render
  async function refresh() {
    try {
      const r = await fetch(API_DATA);
      if (!r.ok) throw new Error('Network response not ok');
      const entries = await r.json();
      window.__entries = entries;
      renderAll(entries);
    } catch (err) {
      console.error('Failed to load data', err);
      window.__entries = [];
      renderAll([]);
    }
  }

  function computeTotal(e) {
    // Mirrors server-side factors
    const F = {
      car:0.2, bus:0.1, train:0.04, flight:0.25,
      kwh:0.4, beef:15, chicken:6, veg:1, vegan:0.5
    };
    let total = 0;
    const km = Number(e.km||0);
    const t = e.transport||'car';
    total += km * (F[t] || F.car);
    total += Number(e.kwh||0) * F.kwh;
    total += Number(e.meat_beef||0) * F.beef;
    total += Number(e.meat_chicken||0) * F.chicken;
    total += Number(e.veg||0) * F.veg;
    total += Number(e.vegan||0) * F.vegan;
    return Math.round(total*1000)/1000;
  }

  function lastNDates(n, endDate) {
    const res = [];
    const d = endDate ? new Date(endDate) : new Date();
    d.setHours(0,0,0,0);
    for (let i=n-1;i>=0;i--) {
      const dd = new Date(d);
      dd.setDate(d.getDate()-i);
      res.push(dd.toISOString().slice(0,10));
    }
    return res;
  }

  function renderAll(entries) {
    // Build map date->total
    const map = Object.create(null);
    for (const e of entries) {
      if (!e.date) continue;
      map[e.date] = computeTotal(e);
    }
    const dates = lastNDates(30);
    const values = dates.map(d => map[d]||0);
    drawChart(dates, values);
    // Weekly avg (last 7 days)
    const last7 = dates.slice(-7);
    const sum7 = last7.reduce((s,d)=>s+(map[d]||0),0);
    const avg7 = Math.round((sum7/7)*1000)/1000;
    weeklyAvgEl.textContent = avg7 + ' kg';
    // monthly total for this month (based on selected date)
    const selDate = dateInput.value || new Date().toISOString().slice(0,10);
    const y = selDate.slice(0,7);
    const monthSum = entries.reduce((s,e)=> e.date && e.date.slice(0,7)===y ? s+computeTotal(e):s,0);
    monthlyTotalEl.textContent = Math.round(monthSum*1000)/1000 + ' kg';
    // score tons
    const tons = Math.round((monthSum/1000)*1000)/1000;
    scoreTonsEl.textContent = tons + ' t';
    // tips
    const perDay = avg7;
    let tip = '';
    if (perDay < 3) {
      tip = 'Great! Your average is low — try biking or walking where possible.';
    } else if (perDay < 10) {
      tip = 'Good — consider reducing beef meals or car trips to lower it further.';
    } else if (perDay < 20) {
      tip = 'Moderate footprint — swap some meat meals for vegan options and use public transport.';
    } else {
      tip = 'High footprint — review long flights, frequent beef consumption, and household energy use.';
    }
    tipsEl.textContent = tip;

    // Pre-fill form with existing entry for selected date
    const existing = (entries.find(e=>e.date===selDate) || {});
    for (const k of ['km','transport','kwh','meat_beef','meat_chicken','veg','vegan']) {
      const el = document.getElementById(k);
      if (!el) continue;
      if (el.tagName === 'SELECT') el.value = existing[k] || el.value;
      else el.value = existing[k] !== undefined ? existing[k] : '';
    }
  }

  // Simple canvas line/bar chart with color-coding
  function drawChart(labels, values) {
    const c = lineCanvas;
    const dpr = window.devicePixelRatio || 1;
    const w = c.clientWidth;
    const h = c.clientHeight;
    c.width = Math.max(300, Math.floor(w * dpr));
    c.height = Math.max(120, Math.floor(h * dpr));
    const ctx = c.getContext('2d');
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr,dpr);
    ctx.clearRect(0,0,w,h);
    // compute scales
    const max = Math.max(5, ...values);
    const min = 0;
    const pad = 30;
    const plotW = w - pad*2;
    const plotH = h - pad*2;
    // draw grid
    ctx.strokeStyle = 'rgba(255,255,255,0.04)';
    ctx.lineWidth = 1;
    for (let i=0;i<=4;i++) {
      const y = pad + (plotH/4)*i;
      ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(pad+plotW,y); ctx.stroke();
    }
    // draw line
    const stepX = plotW / (labels.length - 1 || 1);
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    for (let i=0;i<labels.length;i++) {
      const x = pad + stepX * i;
      const v = values[i];
      const y = pad + plotH - (v - min) / (max - min || 1) * plotH;
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    const grad = ctx.createLinearGradient(0,0,w,0);
    grad.addColorStop(0,'#3ecf8e'); grad.addColorStop(1,'#ff6b6b');
    ctx.strokeStyle = grad;
    ctx.stroke();

    // draw points and bars
    for (let i=0;i<labels.length;i++) {
      const x = pad + stepX * i;
      const v = values[i];
      const y = pad + plotH - (v - min) / (max - min || 1) * plotH;
      const t = Math.min(1, v / Math.max(5, max));
      const r = Math.round(62 + (255-62)*t);
      const g = Math.round(207 - (207-100)*t);
      const b = Math.round(142 - (142-100)*t);
      ctx.fillStyle = 'rgb('+r+','+g+','+b+')';
      ctx.fillRect(x-6, y, 12, Math.max(2, pad+plotH - y));
      ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI*2); ctx.fill();
    }
  }

  // Generate shareable hash for current week starting date (Monday)
  function weekStartForDate(d) {
    const date = new Date(d);
    const day = date.getDay(); // 0 Sun..6
    const diff = (day + 6) % 7; // days since Monday
    date.setDate(date.getDate() - diff);
    return date.toISOString().slice(0,10);
  }

  function generateShare() {
    const entries = window.__entries || [];
    const sel = dateInput.value || new Date().toISOString().slice(0,10);
    const ws = weekStartForDate(sel);
    const dates = lastNDates(7, new Date(ws));
    const map = Object.create(null);
    for (const e of entries) if (e.date) map[e.date]=computeTotal(e);
    const totals = dates.map(d=>map[d]||0);
    const avg = Math.round((totals.reduce((a,b)=>a+b,0)/7)*1000)/1000;
    const tons = Math.round((totals.reduce((a,b)=>a+b,0)/1000)*1000)/1000;
    const hash = '#week=' + ws + ':' + tons + 'tons';
    const url = location.origin + location.pathname + hash;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(url).then(()=>{ alert('Share link copied to clipboard'); }).catch(()=>{ prompt('Share link (copy):', url); });
    } else {
      prompt('Share link (copy):', url);
    }
    history.replaceState(null,'',hash);
  }

  // On load, parse share hash if present like #week=2025-12-16:2.3tons
  function parseHash() {
    const h = location.hash || '';
    if (!h) return;
    const m = h.match(/week=([0-9\-]+):([0-9\.]+)tons/);
    if (m) {
      const ws = m[1];
      const tons = m[2];
      // non-intrusive notification
      setTimeout(()=>{ alert('Shared week starting ' + ws + '\nTotal: ' + tons + ' tons CO2'); }, 200);
    }
  }

  // On startup
  refresh().then(()=>parseHash());

  // Periodically refresh in background
  setInterval(()=>refresh(), 1000*60*2);
})();
</script>
</body>
</html>