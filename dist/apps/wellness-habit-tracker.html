<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-11-25T20:28:38.809688Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wellness Habit Tracker+</title>
<style>
  :root {
    --color-bg: #f0f5f3;
    --color-primary: #4a7c59;
    --color-secondary: #7ca982;
    --color-accent: #a3c4bc;
    --color-text: #2f3e46;
    --color-text-light: #555;
    --color-completed: #4a7c59;
    --color-incomplete: #c7d3ca;
    --color-calendar-bg: #e6f0ea;
    --color-calendar-complete: #4a7c59;
    --color-calendar-partial: #7ca982;
    --color-calendar-none: #c7d3ca;
    --color-focus: #a3c4bc;
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: var(--font-family);
    background: var(--color-bg);
    color: var(--color-text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    background: var(--color-primary);
    color: white;
    padding: 1rem 1.5rem;
    text-align: center;
    font-weight: 600;
    font-size: 1.5rem;
  }
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem 1.5rem;
    max-width: 900px;
    margin: 0 auto;
    width: 100%;
  }
  h2 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--color-primary);
  }
  /* Habit List */
  #habit-form {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  #habit-input {
    flex: 1;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    border: 2px solid var(--color-secondary);
    border-radius: 4px;
    outline-offset: 2px;
  }
  #habit-input:focus {
    border-color: var(--color-focus);
  }
  #add-habit-btn {
    background: var(--color-primary);
    border: none;
    color: white;
    padding: 0 1rem;
    font-size: 1rem;
    border-radius: 4px;
    cursor: pointer;
    outline-offset: 2px;
  }
  #add-habit-btn:focus {
    outline: 3px solid var(--color-focus);
  }
  #habits-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .habit-item {
    background: white;
    border: 1px solid var(--color-secondary);
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .habit-label {
    flex: 1;
    font-size: 1rem;
    color: var(--color-text);
    cursor: pointer;
  }
  .habit-label[contenteditable="true"] {
    border-bottom: 1px dashed var(--color-primary);
    outline-offset: 2px;
  }
  .habit-label:focus {
    outline: 3px solid var(--color-focus);
  }
  .habit-actions {
    display: flex;
    gap: 0.5rem;
  }
  button.habit-edit-btn,
  button.habit-delete-btn {
    background: var(--color-accent);
    border: none;
    border-radius: 4px;
    color: var(--color-primary);
    cursor: pointer;
    font-size: 0.9rem;
    padding: 0.25rem 0.5rem;
    user-select: none;
  }
  button.habit-edit-btn:focus,
  button.habit-delete-btn:focus {
    outline: 3px solid var(--color-focus);
  }
  button.habit-delete-btn {
    background: #d66a6a;
    color: white;
  }
  /* Checklist */
  #checklist {
    margin-top: 1rem;
    background: white;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid var(--color-secondary);
  }
  #checklist h2 {
    margin-top: 0;
  }
  #checklist-date {
    font-weight: 600;
    color: var(--color-secondary);
    margin-bottom: 1rem;
  }
  #habit-checklist {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .checklist-item {
    display: flex;
    align-items: center;
  }
  .checklist-item input[type="checkbox"] {
    width: 1.25rem;
    height: 1.25rem;
    margin-right: 0.75rem;
    cursor: pointer;
  }
  .checklist-item label {
    font-size: 1rem;
    cursor: pointer;
    user-select: none;
  }
  /* Calendar */
  #calendar-section {
    margin-top: 2rem;
  }
  #calendar-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  #calendar-controls button {
    background: var(--color-primary);
    border: none;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
  }
  #calendar-controls button:focus {
    outline: 3px solid var(--color-focus);
  }
  #calendar-month-year {
    font-weight: 600;
    color: var(--color-primary);
    user-select: none;
  }
  #calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.25rem;
    background: var(--color-calendar-bg);
    border-radius: 6px;
    padding: 0.5rem;
  }
  .calendar-day-name {
    font-weight: 600;
    text-align: center;
    font-size: 0.85rem;
    color: var(--color-text-light);
    user-select: none;
  }
  .calendar-day {
    aspect-ratio: 1 / 1;
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    font-size: 0.85rem;
    cursor: default;
    user-select: none;
    padding: 0.25rem 0.15rem;
  }
  .calendar-day.empty {
    background: transparent;
    cursor: default;
  }
  .calendar-day.complete {
    background-color: var(--color-calendar-complete);
    color: white;
  }
  .calendar-day.partial {
    background-color: var(--color-calendar-partial);
    color: white;
  }
  .calendar-day.none {
    background-color: var(--color-calendar-none);
    color: var(--color-text-light);
  }
  .calendar-day:focus {
    outline: 3px solid var(--color-focus);
    outline-offset: 2px;
  }
  .calendar-day .day-number {
    font-weight: 600;
  }
  /* Legend */
  #calendar-legend {
    margin-top: 0.5rem;
    display: flex;
    gap: 1rem;
    font-size: 0.85rem;
    color: var(--color-text-light);
    user-select: none;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  .legend-color {
    width: 1rem;
    height: 1rem;
    border-radius: 3px;
  }
  .legend-complete {
    background-color: var(--color-calendar-complete);
  }
  .legend-partial {
    background-color: var(--color-calendar-partial);
  }
  .legend-none {
    background-color: var(--color-calendar-none);
  }
  /* Summary Report */
  #summary-section {
    margin-top: 2rem;
    background: white;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid var(--color-secondary);
  }
  #summary-section h2 {
    margin-top: 0;
  }
  #summary-form {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
    margin-bottom: 1rem;
  }
  #summary-form label {
    font-weight: 600;
    color: var(--color-primary);
  }
  #summary-form input[type="date"] {
    padding: 0.25rem 0.5rem;
    border: 2px solid var(--color-secondary);
    border-radius: 4px;
    font-size: 1rem;
    outline-offset: 2px;
  }
  #summary-form input[type="date"]:focus {
    border-color: var(--color-focus);
  }
  #generate-summary-btn {
    background: var(--color-primary);
    border: none;
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
  }
  #generate-summary-btn:focus {
    outline: 3px solid var(--color-focus);
  }
  #summary-output {
    max-height: 300px;
    overflow-y: auto;
    font-size: 0.9rem;
    color: var(--color-text);
  }
  #summary-output table {
    width: 100%;
    border-collapse: collapse;
  }
  #summary-output th,
  #summary-output td {
    border: 1px solid var(--color-secondary);
    padding: 0.25rem 0.5rem;
    text-align: center;
  }
  #summary-output th {
    background: var(--color-accent);
    color: var(--color-primary);
  }
  /* Undo/Redo */
  #undo-redo-controls {
    margin-top: 1rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
  }
  #undo-btn,
  #redo-btn {
    background: var(--color-primary);
    border: none;
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
  }
  #undo-btn:disabled,
  #redo-btn:disabled {
    background: var(--color-incomplete);
    cursor: default;
  }
  #undo-btn:focus,
  #redo-btn:focus {
    outline: 3px solid var(--color-focus);
  }
  /* Responsive */
  @media (max-width: 600px) {
    #habit-form {
      flex-direction: column;
    }
    #add-habit-btn {
      width: 100%;
    }
    #summary-form {
      flex-direction: column;
      align-items: flex-start;
    }
    #undo-redo-controls {
      flex-direction: column;
      gap: 0.5rem;
    }
  }
  /* Print styles */
  @media print {
    body {
      background: white;
      color: black;
      font-size: 12pt;
    }
    header,
    #habit-form,
    #undo-redo-controls,
    #calendar-controls,
    #summary-form,
    #add-habit-btn,
    #undo-btn,
    #redo-btn,
    #generate-summary-btn {
      display: none;
    }
    main {
      padding: 0;
      max-width: none;
      margin: 0;
    }
    #summary-output table {
      font-size: 10pt;
      border: 1pt solid black;
    }
    #summary-output th,
    #summary-output td {
      border: 1pt solid black;
      padding: 0.15rem 0.3rem;
    }
  }
</style>
</head>
<body>
<header role="banner">Wellness Habit Tracker+</header>
<main role="main" aria-label="Wellness Habit Tracker Application">
  <section aria-labelledby="habit-list-title">
    <h2 id="habit-list-title">Manage Your Habits</h2>
    <form id="habit-form" aria-describedby="habit-form-desc" aria-label="Add a new habit">
      <label for="habit-input" id="habit-form-desc" class="sr-only">Enter a new habit name</label>
      <input type="text" id="habit-input" name="habit" autocomplete="off" aria-required="true" aria-describedby="habit-error" placeholder="Add new habit (e.g., Hydration)" />
      <button type="submit" id="add-habit-btn" aria-label="Add habit">Add</button>
    </form>
    <ul id="habits-list" role="list" aria-live="polite" aria-relevant="additions removals"></ul>
    <div id="habit-error" role="alert" style="color:#d66a6a; font-size:0.9rem; min-height:1.2em;"></div>
  </section>

  <section id="checklist" aria-labelledby="checklist-title" tabindex="0">
    <h2 id="checklist-title">Today's Habits</h2>
    <div id="checklist-date" aria-live="polite" aria-atomic="true"></div>
    <ul id="habit-checklist" role="list" aria-label="Checklist of habits for today"></ul>
  </section>

  <section id="undo-redo-controls" aria-label="Undo and redo habit completion actions">
    <button id="undo-btn" disabled aria-disabled="true" aria-label="Undo last action (Ctrl+Z)">Undo</button>
    <button id="redo-btn" disabled aria-disabled="true" aria-label="Redo last undone action (Ctrl+Y)">Redo</button>
  </section>

  <section id="calendar-section" aria-labelledby="calendar-title">
    <h2 id="calendar-title">Monthly Habit Completion Calendar</h2>
    <div id="calendar-controls">
      <button id="prev-month-btn" aria-label="Previous month">&lt;</button>
      <div id="calendar-month-year" tabindex="0" aria-live="polite" aria-atomic="true"></div>
      <button id="next-month-btn" aria-label="Next month">&gt;</button>
    </div>
    <div id="calendar" role="grid" aria-label="Habit completion calendar"></div>
    <div id="calendar-legend" aria-label="Calendar legend">
      <div class="legend-item"><div class="legend-color legend-complete" aria-hidden="true"></div>All habits completed</div>
      <div class="legend-item"><div class="legend-color legend-partial" aria-hidden="true"></div>Some habits completed</div>
      <div class="legend-item"><div class="legend-color legend-none" aria-hidden="true"></div>No habits completed</div>
    </div>
  </section>

  <section id="summary-section" aria-labelledby="summary-title">
    <h2 id="summary-title">Printable Summary Report</h2>
    <form id="summary-form" aria-label="Generate summary report by date range">
      <label for="summary-start">Start Date:</label>
      <input type="date" id="summary-start" name="summary-start" aria-required="true" />
      <label for="summary-end">End Date:</label>
      <input type="date" id="summary-end" name="summary-end" aria-required="true" />
      <button type="submit" id="generate-summary-btn">Generate</button>
    </form>
    <div id="summary-output" tabindex="0" aria-live="polite" aria-atomic="true"></div>
  </section>
</main>
<script>
(() => {
  "use strict";

  // Constants and selectors
  const habitInput = document.getElementById("habit-input");
  const habitForm = document.getElementById("habit-form");
  const habitsList = document.getElementById("habits-list");
  const habitError = document.getElementById("habit-error");

  const checklistDate = document.getElementById("checklist-date");
  const habitChecklist = document.getElementById("habit-checklist");

  const undoBtn = document.getElementById("undo-btn");
  const redoBtn = document.getElementById("redo-btn");

  const calendarMonthYear = document.getElementById("calendar-month-year");
  const calendarGrid = document.getElementById("calendar");
  const prevMonthBtn = document.getElementById("prev-month-btn");
  const nextMonthBtn = document.getElementById("next-month-btn");

  const summaryForm = document.getElementById("summary-form");
  const summaryStart = document.getElementById("summary-start");
  const summaryEnd = document.getElementById("summary-end");
  const summaryOutput = document.getElementById("summary-output");

  // Data keys for localStorage
  const STORAGE_HABITS = "wellness-habits";
  const STORAGE_COMPLETION = "wellness-completion";

  // Undo/Redo stacks
  let undoStack = [];
  let redoStack = [];

  // State variables
  let habits = [];
  let completion = {}; // { "YYYY-MM-DD": { habitId: true/false } }
  let currentDate = new Date();
  let calendarYear = currentDate.getFullYear();
  let calendarMonth = currentDate.getMonth();

  // Utility functions
  function saveHabits() {
    localStorage.setItem(STORAGE_HABITS, JSON.stringify(habits));
  }
  function saveCompletion() {
    localStorage.setItem(STORAGE_COMPLETION, JSON.stringify(completion));
  }
  function loadHabits() {
    const data = localStorage.getItem(STORAGE_HABITS);
    if (data) {
      try {
        habits = JSON.parse(data);
      } catch {
        habits = [];
      }
    }
  }
  function loadCompletion() {
    const data = localStorage.getItem(STORAGE_COMPLETION);
    if (data) {
      try {
        completion = JSON.parse(data);
      } catch {
        completion = {};
      }
    }
  }
  function formatDate(date) {
    return date.toISOString().slice(0, 10);
  }
  function formatDateDisplay(date) {
    return date.toLocaleDateString(undefined, { weekday: "long", year: "numeric", month: "long", day: "numeric" });
  }
  function daysInMonth(year, month) {
    return new Date(year, month + 1, 0).getDate();
  }
  function dayOfWeek(year, month, day) {
    return new Date(year, month, day).getDay();
  }
  function createHabitId() {
    // Simple unique id based on timestamp + random
    return "h" + Date.now().toString(36) + Math.random().toString(36).slice(2, 6);
  }
  // Accessibility helper: visually hidden class
  const style = document.createElement("style");
  style.textContent = ".sr-only { position: absolute !important; width: 1px !important; height: 1px !important; padding: 0 !important; margin: -1px !important; overflow: hidden !important; clip: rect(0,0,0,0) !important; white-space: nowrap !important; border: 0 !important; }";
  document.head.appendChild(style);

  // Habit management
  function renderHabits() {
    habitsList.innerHTML = "";
    if (habits.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No habits added yet.";
      li.style.color = "var(--color-text-light)";
      habitsList.appendChild(li);
      return;
    }
    habits.forEach((habit) => {
      const li = document.createElement("li");
      li.className = "habit-item";
      li.setAttribute("data-habit-id", habit.id);

      // Editable label
      const label = document.createElement("span");
      label.className = "habit-label";
      label.tabIndex = 0;
      label.setAttribute("role", "textbox");
      label.setAttribute("aria-label", `Habit name: ${habit.name}. Press Enter to edit.`);
      label.textContent = habit.name;
      label.contentEditable = false;
      label.spellcheck = false;

      // On Enter key, toggle editing
      label.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          if (!label.isContentEditable) {
            startEditingHabit(label, habit.id);
          } else {
            finishEditingHabit(label, habit.id);
          }
        } else if (e.key === "Escape" && label.isContentEditable) {
          cancelEditingHabit(label, habit.id);
        }
      });
      label.addEventListener("blur", () => {
        if (label.isContentEditable) {
          finishEditingHabit(label, habit.id);
        }
      });

      // Edit button
      const editBtn = document.createElement("button");
      editBtn.type = "button";
      editBtn.className = "habit-edit-btn";
      editBtn.textContent = "Edit";
      editBtn.setAttribute("aria-label", `Edit habit ${habit.name}`);
      editBtn.addEventListener("click", () => {
        startEditingHabit(label, habit.id);
        label.focus();
      });

      // Delete button
      const deleteBtn = document.createElement("button");
      deleteBtn.type = "button";
      deleteBtn.className = "habit-delete-btn";
      deleteBtn.textContent = "Delete";
      deleteBtn.setAttribute("aria-label", `Delete habit ${habit.name}`);
      deleteBtn.addEventListener("click", () => {
        if (confirm(`Delete habit "${habit.name}"? This will remove all its completion data.`)) {
          deleteHabit(habit.id);
        }
      });

      const actions = document.createElement("div");
      actions.className = "habit-actions";
      actions.appendChild(editBtn);
      actions.appendChild(deleteBtn);

      li.appendChild(label);
      li.appendChild(actions);
      habitsList.appendChild(li);
    });
  }
  function startEditingHabit(label, habitId) {
    label.contentEditable = "true";
    label.focus();
    // Move caret to end
    document.execCommand("selectAll", false, null);
    document.getSelection().collapseToEnd();
  }
  function finishEditingHabit(label, habitId) {
    const newName = label.textContent.trim();
    if (!newName) {
      alert("Habit name cannot be empty.");
      label.textContent = habits.find((h) => h.id === habitId).name;
      label.contentEditable = "false";
      return;
    }
    const duplicate = habits.find((h) => h.name.toLowerCase() === newName.toLowerCase() && h.id !== habitId);
    if (duplicate) {
      alert("Habit name must be unique.");
      label.textContent = habits.find((h) => h.id === habitId).name;
      label.contentEditable = "false";
      return;
    }
    const habit = habits.find((h) => h.id === habitId);
    if (habit.name !== newName) {
      habit.name = newName;
      saveHabits();
      renderChecklist();
      renderCalendar();
    }
    label.contentEditable = "false";
  }
  function cancelEditingHabit(label, habitId) {
    label.textContent = habits.find((h) => h.id === habitId).name;
    label.contentEditable = "false";
  }
  function deleteHabit(habitId) {
    habits = habits.filter((h) => h.id !== habitId);
    // Remove completion data for this habit
    for (const date in completion) {
      if (completion[date][habitId] !== undefined) {
        delete completion[date][habitId];
      }
    }
    saveHabits();
    saveCompletion();
    renderHabits();
    renderChecklist();
    renderCalendar();
    clearUndoRedo();
  }

  // Checklist rendering and interaction
  function renderChecklist() {
    habitChecklist.innerHTML = "";
    checklistDate.textContent = formatDateDisplay(currentDate);
    if (habits.length === 0) {
      const li = document.createElement("li");
      li.textContent = "Add habits above to start tracking.";
      li.style.color = "var(--color-text-light)";
      habitChecklist.appendChild(li);
      return;
    }
    const dateKey = formatDate(currentDate);
    if (!completion[dateKey]) completion[dateKey] = {};
    habits.forEach((habit) => {
      const li = document.createElement("li");
      li.className = "checklist-item";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = `chk-${habit.id}`;
      checkbox.checked = !!completion[dateKey][habit.id];
      checkbox.setAttribute("aria-checked", checkbox.checked);
      checkbox.setAttribute("role", "checkbox");
      checkbox.tabIndex = 0;
      checkbox.setAttribute("aria-label", `Mark habit "${habit.name}" as completed for ${formatDateDisplay(currentDate)}`);

      checkbox.addEventListener("change", () => {
        toggleHabitCompletion(habit.id, checkbox.checked);
      });
      checkbox.addEventListener("keydown", (e) => {
        if (e.key === " " || e.key === "Enter") {
          e.preventDefault();
          checkbox.checked = !checkbox.checked;
          toggleHabitCompletion(habit.id, checkbox.checked);
        }
      });

      const label = document.createElement("label");
      label.htmlFor = checkbox.id;
      label.textContent = habit.name;

      li.appendChild(checkbox);
      li.appendChild(label);
      habitChecklist.appendChild(li);
    });
  }
  function toggleHabitCompletion(habitId, completed) {
    const dateKey = formatDate(currentDate);
    if (!completion[dateKey]) completion[dateKey] = {};
    const prev = !!completion[dateKey][habitId];
    if (prev === completed) return; // no change
    completion[dateKey][habitId] = completed;
    saveCompletion();
    pushUndo({ date: dateKey, habitId, prev, next: completed });
    renderCalendar();
    updateUndoRedoButtons();
  }

  // Undo/Redo functionality
  function pushUndo(action) {
    undoStack.push(action);
    redoStack = [];
  }
  function undo() {
    if (undoStack.length === 0) return;
    const action = undoStack.pop();
    const { date, habitId, prev, next } = action;
    if (!completion[date]) completion[date] = {};
    completion[date][habitId] = prev;
    saveCompletion();
    redoStack.push(action);
    if (date === formatDate(currentDate)) {
      renderChecklist();
    }
    renderCalendar();
    updateUndoRedoButtons();
  }
  function redo() {
    if (redoStack.length === 0) return;
    const action = redoStack.pop();
    const { date, habitId, prev, next } = action;
    if (!completion[date]) completion[date] = {};
    completion[date][habitId] = next;
    saveCompletion();
    undoStack.push(action);
    if (date === formatDate(currentDate)) {
      renderChecklist();
    }
    renderCalendar();
    updateUndoRedoButtons();
  }
  function updateUndoRedoButtons() {
    undoBtn.disabled = undoStack.length === 0;
    redoBtn.disabled = redoStack.length === 0;
    undoBtn.setAttribute("aria-disabled", undoBtn.disabled.toString());
    redoBtn.setAttribute("aria-disabled", redoBtn.disabled.toString());
  }
  function clearUndoRedo() {
    undoStack = [];
    redoStack = [];
    updateUndoRedoButtons();
  }

  // Calendar rendering
  function renderCalendar() {
    calendarGrid.innerHTML = "";
    const year = calendarYear;
    const month = calendarMonth;
    const firstDay = new Date(year, month, 1);
    const firstWeekday = firstDay.getDay(); // Sunday=0
    const totalDays = daysInMonth(year, month);

    // Weekday headers
    const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    weekdays.forEach((wd) => {
      const div = document.createElement("div");
      div.className = "calendar-day-name";
      div.textContent = wd;
      div.setAttribute("role", "columnheader");
      calendarGrid.appendChild(div);
    });

    // Empty cells before first day
    for (let i = 0; i < firstWeekday; i++) {
      const emptyDiv = document.createElement("div");
      emptyDiv.className = "calendar-day empty";
      emptyDiv.setAttribute("aria-hidden", "true");
      calendarGrid.appendChild(emptyDiv);
    }

    // Days
    for (let day = 1; day <= totalDays; day++) {
      const dateKey = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
      const dayDiv = document.createElement("div");
      dayDiv.className = "calendar-day";
      dayDiv.tabIndex = 0;
      dayDiv.setAttribute("role", "gridcell");
      dayDiv.setAttribute("aria-label", `Date ${year}-${month + 1}-${day}`);

      // Determine completion status for this day
      let status = "none"; // none, partial, complete
      if (completion[dateKey]) {
        const completedCount = habits.reduce((acc, h) => acc + (completion[dateKey][h.id] ? 1 : 0), 0);
        if (completedCount === habits.length && habits.length > 0) status = "complete";
        else if (completedCount > 0) status = "partial";
      }
      dayDiv.classList.add(status);

      const dayNumber = document.createElement("div");
      dayNumber.className = "day-number";
      dayNumber.textContent = day;
      dayDiv.appendChild(dayNumber);

      calendarGrid.appendChild(dayDiv);
    }

    // Update month-year display
    const monthName = firstDay.toLocaleString(undefined, { month: "long" });
    calendarMonthYear.textContent = `${monthName} ${year}`;
  }

  // Summary report generation
  function generateSummaryReport(startDate, endDate) {
    if (!startDate || !endDate) {
      summaryOutput.textContent = "Please select both start and end dates.";
      return;
    }
    if (startDate > endDate) {
      summaryOutput.textContent = "Start date must be before or equal to end date.";
      return;
    }
    if (habits.length === 0) {
      summaryOutput.textContent = "No habits to report.";
      return;
    }
    // Collect dates in range
    const start = new Date(startDate);
    const end = new Date(endDate);
    const dates = [];
    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
      dates.push(formatDate(new Date(d)));
    }
    // Build table
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const trHead = document.createElement("tr");
    trHead.appendChild(document.createElement("th")); // empty corner cell
    dates.forEach((dateStr) => {
      const th = document.createElement("th");
      th.textContent = dateStr;
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    habits.forEach((habit) => {
      const tr = document.createElement("tr");
      const th = document.createElement("th");
      th.textContent = habit.name;
      tr.appendChild(th);
      dates.forEach((dateStr) => {
        const td = document.createElement("td");
        const done = completion[dateStr] && completion[dateStr][habit.id];
        td.textContent = done ? "âœ“" : "";
        td.style.color = done ? "var(--color-completed)" : "var(--color-incomplete)";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    summaryOutput.innerHTML = "";
    summaryOutput.appendChild(table);
  }

  // Event handlers
  habitForm.addEventListener("submit", (e) => {
    e.preventDefault();
    habitError.textContent = "";
    const name = habitInput.value.trim();
    if (!name) {
      habitError.textContent = "Habit name cannot be empty.";
      habitInput.focus();
      return;
    }
    if (habits.find((h) => h.name.toLowerCase() === name.toLowerCase())) {
      habitError.textContent = "Habit name must be unique.";
      habitInput.focus();
      return;
    }
    const newHabit = { id: createHabitId(), name };
    habits.push(newHabit);
    saveHabits();
    habitInput.value = "";
    renderHabits();
    renderChecklist();
    renderCalendar();
    clearUndoRedo();
  });

  undoBtn.addEventListener("click", () => {
    undo();
  });
  redoBtn.addEventListener("click", () => {
    redo();
  });

  prevMonthBtn.addEventListener("click", () => {
    calendarMonth--;
    if (calendarMonth < 0) {
      calendarMonth = 11;
      calendarYear--;
    }
    renderCalendar();
  });
  nextMonthBtn.addEventListener("click", () => {
    calendarMonth++;
    if (calendarMonth > 11) {
      calendarMonth = 0;
      calendarYear++;
    }
    renderCalendar();
  });

  summaryForm.addEventListener("submit", (e) => {
    e.preventDefault();
    generateSummaryReport(summaryStart.value, summaryEnd.value);
  });

  // Keyboard shortcuts
  window.addEventListener("keydown", (e) => {
    if (e.target.matches("input, textarea, [contenteditable=true], select")) return;
    if (e.key === "Enter") {
      // Add habit if habit input focused or no focus
      if (document.activeElement === habitInput) {
        e.preventDefault();
        habitForm.requestSubmit();
      }
    }
    if ((e.key === " " || e.key === "Enter") && document.activeElement.classList.contains("checklist-item")) {
      // Space/Enter on checklist item toggles checkbox
      e.preventDefault();
      const checkbox = document.activeElement.querySelector("input[type=checkbox]");
      if (checkbox) {
        checkbox.checked = !checkbox.checked;
        checkbox.dispatchEvent(new Event("change"));
      }
    }
    if (e.ctrlKey && e.key.toLowerCase() === "z") {
      e.preventDefault();
      undo();
    }
    if (e.ctrlKey && e.key.toLowerCase() === "y") {
      e.preventDefault();
      redo();
    }
  });

  // Initialize app
  function init() {
    loadHabits();
    loadCompletion();
    renderHabits();
    renderChecklist();
    renderCalendar();
    updateUndoRedoButtons();

    // Set summary date inputs default to last 7 days
    const todayStr = formatDate(new Date());
    summaryEnd.value = todayStr;
    const lastWeek = new Date();
    lastWeek.setDate(lastWeek.getDate() - 6);
    summaryStart.value = formatDate(lastWeek);
  }
  init();
})();  
</script>
</body>
</html>