<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2026-02-17T16:07:11.410232Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Ledger Pro</title>
    <link rel="manifest" href="data:application/manifest+json,{
        \"name\": \"Expense Ledger Pro\",
        \"short_name\": \"Ledger Pro\",
        \"description\": \"Personal expense tracker with balance summaries and transaction management\",
        \"start_url\": \".\",
        \"display\": \"standalone\",
        \"background_color\": \"#f8f9fa\",
        \"theme_color\": \"#10b981\",
        \"icons\": [{
            \"src\": \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxMGI5ODEiLz4KPHRleHQgeD0iOTYiIHk9IjExMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9IjAuM2VtIiBmb250LWZhbWlseT0ic3lzdGVtLXVpLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgZm9udC13ZWlnaHQ9IjYwMCI+JAo8L3RleHQ+Cjwvc3ZnPgo=\",
            \"sizes\": \"192x192\",
            \"type\": \"image/svg+xml\"
        }]
    }">
    <style>
        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #e9ecef;
            --bg-card: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --shadow: 8px 8px 24px rgba(0,0,0,0.1), -8px -8px 24px rgba(255,255,255,0.8);
            --shadow-inset: inset 8px 8px 24px rgba(0,0,0,0.1), inset -8px -8px 24px rgba(255,255,255,0.8);
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --radius: 20px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1a1a1a;
                --bg-secondary: #2d2d2d;
                --bg-card: #242424;
                --text-primary: #ffffff;
                --text-secondary: #b8b8b8;
                --border-color: #404040;
                --shadow: 8px 8px 24px rgba(0,0,0,0.4), -8px -8px 24px rgba(0,0,0,0.1);
                --shadow-inset: inset 8px 8px 24px rgba(0,0,0,0.4), inset -8px -8px 24px rgba(0,0,0,0.1);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1rem;
            transition: background 0.3s ease, color 0.3s ease;
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 12px 12px 32px rgba(0,0,0,0.15), -12px -12px 32px rgba(255,255,255,0.2);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-inset);
        }

        .btn-theme {
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-width: 48px;
            justify-content: center;
        }

        .btn-reset {
            background: var(--danger);
            color: white;
        }

        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .balance-card {
            background: var(--bg-card);
            padding: 1.75rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .balance-card:hover {
            transform: translateY(-4px);
        }

        .balance-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .balance-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .balance-income { color: var(--success); }
        .balance-expenses { color: var(--danger); }
        .balance-positive { color: var(--success); }
        .balance-negative { color: var(--danger); }

        .form-section {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: end;
        }

        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        input, select {
            padding: 0.875rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .btn-add {
            background: var(--success);
            color: white;
            font-weight: 600;
            padding: 0.875rem 2rem;
        }

        .controls-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        @media (max-width: 500px) {
            .controls-row {
                flex-direction: column;
            }
        }

        .table-container {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1.25rem 1rem;
            text-align: left;
        }

        th {
            background: var(--bg-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s ease;
            position: sticky;
            top: 0;
        }

        th:hover {
            background: var(--border-color);
        }

        th[aria-sort="ascending"]::after {
            content: " â–²";
            color: var(--success);
        }

        th[aria-sort="descending"]::after {
            content: " â–¼";
            color: var(--success);
        }

        tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: var(--bg-secondary);
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .btn-delete:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-out {
            animation: slideOut 0.3s ease-out forwards;
        }

        @keyframes slideOut {
            to { opacity: 0; transform: translateX(-100px); }
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .modal[open] {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 2.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 400px;
            width: 90%;
            margin: 2rem;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        [role="status"] {
            border: 0;
            clip: rect(0, 0, 0, 0);
            height: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
            width: 1px;
        }

        @media (max-width: 768px) {
            .balance-grid {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 1rem 0.75rem;
            }
            
            .form-section {
                padding: 1.5rem;
            }
        }

        .category-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .cat-income { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .cat-food { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
        .cat-transport { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .cat-entertainment { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .cat-utilities { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
        .cat-other { background: rgba(107, 114, 128, 0.1); color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="container" role="main">
        <header class="header" role="banner">
            <h1>Expense Ledger Pro</h1>
            <div class="header-controls">
                <button class="btn btn-theme" id="themeToggle" role="switch" aria-checked="false" aria-label="Toggle dark mode">
                    ðŸŒ™
                </button>
                <button class="btn btn-reset" id="resetBtn" aria-label="Reset all data (irreversible)">
                    Reset Data
                </button>
            </div>
        </header>

        <div class="balance-grid" role="region" aria-live="polite">
            <div class="balance-card">
                <div class="balance-label">Total Income</div>
                <div class="balance-amount balance-income" id="totalIncome">$0.00</div>
            </div>
            <div class="balance-card">
                <div class="balance-label">Total Expenses</div>
                <div class="balance-amount balance-expenses" id="totalExpenses">$0.00</div>
            </div>
            <div class="balance-card">
                <div class="balance-label">Net Balance</div>
                <div class="balance-amount balance-positive" id="netBalance">$0.00</div>
            </div>
        </div>

        <section class="form-section" role="form" aria-labelledby="form-heading">
            <h2 id="form-heading" class="sr-only">Add New Transaction</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="descInput">Description <span aria-label="required">*</span></label>
                    <input id="descInput" type="text" required aria-describedby="desc-error" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="amountInput">Amount</label>
                    <input id="amountInput" type="number" min="0" step="0.01" required aria-describedby="amount-error">
                </div>
                <div class="form-group">
                    <label for="categorySelect">Category</label>
                    <select id="categorySelect" required>
                        <option value="">Select category</option>
                        <option value="Income">Income</option>
                        <option value="Food">Food</option>
                        <option value="Transport">Transport</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-add" id="addBtn" type="submit">Add Transaction</button>
                </div>
            </div>
        </section>

        <div class="controls-row">
            <div class="form-group">
                <label for="filterSelect">Filter:</label>
                <select id="filterSelect" aria-label="Filter transactions">
                    <option value="all">All</option>
                    <option value="income">Income</option>
                    <option value="expenses">Expenses</option>
                    <option value="Food">Food</option>
                    <option value="Transport">Transport</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>

        <div class="table-container" role="region" aria-labelledby="table-heading">
            <h2 id="table-heading" class="sr-only">Transactions</h2>
            <table id="transactionsTable">
                <thead>
                    <tr>
                        <th scope="col" data-sort="date" tabindex="0" aria-sort="none" role="button" aria-label="Sort by Date">Date</th>
                        <th scope="col" data-sort="desc" tabindex="0" aria-sort="none" role="button" aria-label="Sort by Description">Description</th>
                        <th scope="col" data-sort="amt" tabindex="0" aria-sort="none" role="button" aria-label="Sort by Amount">Amount</th>
                        <th scope="col" data-sort="cat" tabindex="0" aria-sort="none" role="button" aria-label="Sort by Category">Category</th>
                        <th scope="col" aria-label="Actions">Actions</th>
                    </tr>
                </thead>
                <tbody id="transactionsBody"></tbody>
            </table>
            <div id="emptyState" class="empty-state" role="status" aria-live="polite">
                No transactions - add one above!
            </div>
        </div>
    </div>

    <dialog id="confirmModal" class="modal" role="dialog" aria-labelledby="modal-title" aria-modal="true">
        <div class="modal-content">
            <h3 id="modal-title">Confirm Action</h3>
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button id="modalCancel" class="btn">Cancel</button>
                <button id="modalConfirm" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </dialog>

    <script>
        class ExpenseLedger {
            constructor() {
                this.transactions = [];
                this.sortConfig = { key: null, direction: 'desc' };
                this.filterValue = 'all';
                this.init();
            }

            init() {
                this.loadData();
                this.attachEventListeners();
                this.updateDisplay();
                this.loadSampleDataIfEmpty();
            }

            loadData() {
                const data = localStorage.getItem('ledger');
                if (data) {
                    this.transactions = JSON.parse(data);
                }
            }

            saveData() {
                localStorage.setItem('ledger', JSON.stringify(this.transactions));
            }

            loadSampleDataIfEmpty() {
                if (this.transactions.length === 0) {
                    if (confirm('No data found. Load sample transactions?')) {
                        this.transactions = [
                            { id: Date.now() - 1000, desc: 'Salary', amt: 3000, cat: 'Income', date: new Date(Date.now() - 86400000).toISOString() },
                            { id: Date.now() - 2000, desc: 'Grocery shopping', amt: 85.50, cat: 'Food', date: new Date(Date.now() - 2 * 86400000).toISOString() },
                            { id: Date.now() - 3000, desc: 'Gas station', amt: 45.25, cat: 'Transport', date: new Date(Date.now() - 3 * 86400000).toISOString() }
                        ];
                        this.saveData();
                        this.updateDisplay();
                    }
                }
            }

            attachEventListeners() {
                // Form submission
                document.getElementById('addBtn').addEventListener('click', (e) => this.handleAdd(e));
                document.getElementById('descInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleAdd(e);
                });

                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());

                // Reset button
                document.getElementById('resetBtn').addEventListener('click', () => this.confirmReset());

                // Filter
                document.getElementById('filterSelect').addEventListener('change', (e) => {
                    this.filterValue = e.target.value;
                    this.updateTable();
                });

                // Table headers for sorting
                document.querySelectorAll('th[data-sort]').forEach(th => {
                    th.addEventListener('click', () => this.handleSort(th.dataset.sort));
                    th.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.handleSort(th.dataset.sort);
                        }
                    });
                });

                // Modal handlers
                document.getElementById('modalCancel').addEventListener('click', () => this.closeModal());
                document.getElementById('modalConfirm').addEventListener('click', () => this.handleModalConfirm());

                // Keyboard navigation for table rows
                document.addEventListener('keydown', (e) => this.handleTableNavigation(e));
            }

            handleAdd(e) {
                e.preventDefault();
                const desc = document.getElementById('descInput').value.trim();
                const amount = parseFloat(document.getElementById('amountInput').value);
                const category = document.getElementById('categorySelect').value;

                if (!desc || !amount || amount < 0 || !category) {
                    this.shakeForm();
                    return;
                }

                const transaction = {
                    id: Date.now(),
                    desc,
                    amt: amount,
                    cat: category,
                    date: new Date().toISOString()
                };

                this.transactions.unshift(transaction);
                this.saveData();
                this.clearForm();
                this.updateDisplay();
            }

            shakeForm() {
                const formSection = document.querySelector('.form-section');
                formSection.classList.add('shake');
                setTimeout(() => formSection.classList.remove('shake'), 500);
            }

            clearForm() {
                document.getElementById('descInput').value = '';
                document.getElementById('amountInput').value = '';
                document.getElementById('categorySelect').value = '';
                document.getElementById('descInput').focus();
            }

            handleSort(key) {
                if (this.sortConfig.key === key) {
                    this.sortConfig.direction = this.sortConfig.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortConfig.key = key;
                    this.sortConfig.direction = 'desc';
                }
                localStorage.setItem('ledgerSort', JSON.stringify(this.sortConfig));
                this.updateTable();
            }

            handleTableNavigation(e) {
                const focused = document.activeElement;
                if (focused.closest('#transactionsTable') && (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'Enter')) {
                    e.preventDefault();
                    const rows = Array.from(document.querySelectorAll('#transactionsBody tr'));
                    const currentIndex = rows.indexOf(focused.closest('tr'));
                    
                    if (e.key === 'Enter' && focused.querySelector('.btn-delete')) {
                        focused.querySelector('.btn-delete').click();
                        return;
                    }
                    
                    if (e.key === 'ArrowUp' && currentIndex > 0) {
                        rows[currentIndex - 1].focus();
                    } else if (e.key === 'ArrowDown' && currentIndex < rows.length - 1) {
                        rows[currentIndex + 1].focus();
                    }
                }
            }

            deleteTransaction(id) {
                this.transactions = this.transactions.filter(t => t.id !== id);
                this.saveData();
                this.updateDisplay();
            }

            confirmReset() {
                document.getElementById('modal-title').textContent = 'Reset All Data';
                document.getElementById('modal-message').textContent = 'This will permanently delete all transactions. This action cannot be undone.';
                document.getElementById('confirmModal').showModal();
                this.pendingAction = () => {
                    localStorage.clear();
                    this.transactions = [];
                    this.sortConfig = { key: null, direction: 'desc' };
                    this.updateDisplay();
                };
            }

            confirmDelete(id) {
                document.getElementById('modal-title').textContent = 'Delete Transaction';
                document.getElementById('modal-message').textContent = 'Are you sure you want to delete this transaction?';
                document.getElementById('confirmModal').showModal();
                this.pendingAction = () => this.deleteTransaction(id);
            }

            handleModalConfirm() {
                if (this.pendingAction) {
                    this.pendingAction();
                    this.pendingAction = null;
                }
                this.closeModal();
            }

            closeModal() {
                document.getElementById('confirmModal').close();
            }

            toggleTheme() {
                const isDark = document.documentElement.classList.toggle('dark');
                const btn = document.getElementById('themeToggle');
                btn.setAttribute('aria-checked', isDark);
                btn.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
                localStorage.setItem('ledgerTheme', isDark ? 'dark' : 'light');
            }

            updateDisplay() {
                this.updateSummaries();
                this.updateTable();
            }

            updateSummaries() {
                const income = this.transactions
                    .filter(t => t.cat === 'Income')
                    .reduce((sum, t) => sum + t.amt, 0);
                
                const expenses = this.transactions
                    .filter(t => t.cat !== 'Income')
                    .reduce((sum, t) => sum + t.amt, 0);
                
                const balance = income - expenses;

                document.getElementById('totalIncome').textContent = this.formatCurrency(income);
                document.getElementById('totalExpenses').textContent = this.formatCurrency(expenses);
                
                const balanceEl = document.getElementById('netBalance');
                balanceEl.textContent = this.formatCurrency(balance);
                balanceEl.className = `balance-amount ${balance >= 0 ? 'balance-positive' : 'balance-negative'}`;
            }

            updateTable() {
                const tbody = document.getElementById('transactionsBody');
                const filtered = this.getFilteredTransactions();
                const sorted = this.sortTransactions(filtered);
                
                tbody.innerHTML = sorted.map(t => this.renderTransactionRow(t)).join('');
                document.getElementById('emptyState').style.display = sorted.length ? 'none' : 'block';

                // Update sort indicators
                document.querySelectorAll('th').forEach(th => {
                    th.setAttribute('aria-sort', 'none');
                });
                if (this.sortConfig.key) {
                    const sortTh = document.querySelector(`th[data-sort="${this.sortConfig.key}"]`);
                    if (sortTh) {
                        sortTh.setAttribute('aria-sort', this.sortConfig.direction);
                    }
                }

                // Add delete listeners
                document.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = parseInt(e.currentTarget.dataset.id);
                        this.confirmDelete(id);
                    });
                });
            }

            getFilteredTransactions() {
                return this.transactions.filter(t => {
                    if (this.filterValue === 'all') return true;
                    if (this.filterValue === 'income') return t.cat === 'Income';
                    if (this.filterValue === 'expenses') return t.cat !== 'Income';
                    return t.cat === this.filterValue;
                });
            }

            sortTransactions(transactions) {
                if (!this.sortConfig.key) return transactions;

                return [...transactions].sort((a, b) => {
                    let aVal, bVal;

                    switch (this.sortConfig.key) {
                        case 'date':
                            aVal = new Date(a.date);
                            bVal = new Date(b.date);
                            break;
                        case 'desc':
                            aVal = a.desc.toLowerCase();
                            bVal = b.desc.toLowerCase();
                            break;
                        case 'amt':
                            aVal = a.amt;
                            bVal = b.amt;
                            break;
                        case 'cat':
                            aVal = a.cat;
                            bVal = b.cat;
                            break;
                    }

                    if (aVal < bVal) return this.sortConfig.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return this.sortConfig.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            renderTransactionRow(t) {
                return `
                    <tr class="fade-in" tabindex="0" role="row">
                        <td>${new Date(t.date).toLocaleDateString()}</td>
                        <td>${this.escapeHtml(t.desc)}</td>
                        <td>$${t.amt.toFixed(2)}</td>
                        <td><span class="category-badge cat-${t.cat.toLowerCase().replace(/ /g, '-')}">${t.cat}</span></td>
                        <td><button class="btn-delete" data-id="${t.id}" aria-label="Delete ${t.desc} transaction" title="Delete"></button></td>
                    </tr>
                `;
            }

            formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize app
        const ledger = new ExpenseLedger();

        // Load persisted theme and sort state
        const savedTheme = localStorage.getItem('ledgerTheme');
        const savedSort = localStorage.getItem('ledgerSort');
        
        if (savedTheme === 'dark') {
            document.documentElement.classList.add('dark');
            const btn = document.getElementById('themeToggle');
            btn.textContent = 'â˜€ï¸';
            btn.setAttribute('aria-checked', 'true');
        }

        if (savedSort) {
            ledger.sortConfig = JSON.parse(savedSort);
        }

        // Focus management for modals
        document.getElementById('confirmModal').addEventListener('close', () => {
            document.getElementById('descInput').focus();
        });

        // Prevent form submission on Enter in selects
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>