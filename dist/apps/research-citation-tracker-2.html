<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2026-02-16T03:18:31.799086Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Research Citation Tracker</title>
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --card-bg: #ffffff;
      --text-primary: #1a1a1a;
      --text-secondary: #6c757d;
      --border-color: #e9ecef;
      --primary-color: #007bff;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --shadow: 0 2px 10px rgba(0,0,0,0.1);
      --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
      --radius: 12px;
      --transition: all 0.2s ease;
    }

    [data-theme="dark"] {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --card-bg: #1e1e1e;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --border-color: #333333;
      --primary-color: #4dabf7;
      --shadow: 0 2px 10px rgba(0,0,0,0.3);
      --shadow-hover: 0 4px 20px rgba(0,0,0,0.4);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      transition: var(--transition);
    }

    .header {
      position: sticky;
      top: 0;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 1.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      flex: 1;
      min-width: 200px;
    }

    .theme-toggle {
      background: none;
      border: 1px solid var(--border-color);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      color: var(--text-secondary);
    }

    .theme-toggle:hover {
      background: var(--bg-secondary);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .theme-toggle:focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: #0056b3;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--border-color);
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      min-height: 36px;
    }

    .search-container {
      position: relative;
      flex: 1;
      min-width: 200px;
      max-width: 400px;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      background: var(--bg-secondary) url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="%236c757d"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>') no-repeat 0.75rem center;
      background-size: 20px;
      font-size: 1rem;
      transition: var(--transition);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
    }

    .sort-select {
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.95rem;
      min-width: 160px;
    }

    .main-content {
      padding: 2rem 1.5rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 1.5rem;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-color: var(--primary-color);
    }

    .card:focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .card-author {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary-color);
    }

    .card-year {
      background: var(--primary-color);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .card-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      line-height: 1.4;
    }

    .card-snippet {
      color: var(--text-secondary);
      font-size: 0.95rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-secondary);
    }

    .empty-state svg {
      width: 80px;
      height: 80px;
      opacity: 0.5;
      margin-bottom: 1rem;
      display: block;
      margin: 0 auto 1rem;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .modal-backdrop.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 2rem;
      max-width: 500px;
      width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.8) translateY(20px);
      transition: var(--transition);
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-hover);
    }

    .modal-backdrop.active .modal {
      transform: scale(1) translateY(0);
    }

    .modal h2 {
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: var(--transition);
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-row {
      display: flex;
      gap: 1rem;
    }

    .form-row .form-group {
      flex: 1;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    /* Full details view */
    .details-view {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--card-bg);
      z-index: 999;
      padding: 2rem;
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .details-view.active {
      opacity: 1;
      visibility: visible;
    }

    .details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .details-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .details-close:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .details-content h3 {
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    .details-field {
      margin-bottom: 1.5rem;
    }

    .details-field strong {
      display: inline-block;
      width: 100px;
      color: var(--text-secondary);
    }

    .details-field a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .details-field a:hover {
      text-decoration: underline;
    }

    /* Export/Import */
    .export-import {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .file-input {
      display: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        padding: 1rem;
        flex-direction: column;
        align-items: stretch;
      }

      .header h1 {
        order: 3;
        text-align: center;
      }

      .form-row {
        flex-direction: column;
      }

      .details-view {
        padding: 1rem;
      }

      .grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    @media (min-width: 769px) and (max-width: 1200px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Focus styles */
    *:focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    /* High contrast cards */
    @media (prefers-contrast: high) {
      .card {
        border-width: 2px;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
        animation: none !important;
      }
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 2;
      fill: none;
    }
  </style>
</head>
<body>
  <header class="header" role="banner">
    <h1>ðŸ“š Research Citation Tracker</h1>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" role="switch" aria-checked="false">
      <svg class="icon" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
    </button>
    <div class="export-import">
      <input type="file" id="importFile" class="file-input" accept=".json" aria-label="Import citations JSON file">
      <button class="btn btn-secondary btn-small" id="importBtn">ðŸ“¥ Import</button>
      <button class="btn btn-secondary btn-small" id="exportBtn">ðŸ“¤ Export</button>
    </div>
    <div class="search-container">
      <input type="search" class="search-input" id="searchInput" placeholder="Search citations..." aria-label="Search citations">
    </div>
    <select class="sort-select" id="sortSelect" aria-label="Sort citations">
      <option value="newest">Newest First</option>
      <option value="author">Author A-Z</option>
      <option value="year-desc">Year Desc</option>
    </select>
    <button class="btn btn-primary" id="newCitationBtn">+ New Citation</button>
  </header>

  <main class="main-content" role="main">
    <div id="citationsGrid" class="grid" role="grid" aria-live="polite"></div>
  </main>

  <!-- Add/Edit Modal -->
  <div id="citationModal" class="modal-backdrop" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal">
      <h2 id="modalTitle">Add Citation</h2>
      <form id="citationForm">
        <div class="form-row">
          <div class="form-group">
            <label for="author">Author</label>
            <input type="text" id="author" required aria-describedby="author-error">
            <div id="author-error" class="sr-only"></div>
          </div>
          <div class="form-group">
            <label for="year">Year</label>
            <input type="number" id="year" min="1900" max="2100" required aria-describedby="year-error">
            <div id="year-error" class="sr-only"></div>
          </div>
        </div>
        <div class="form-group">
          <label for="title">Title</label>
          <input type="text" id="title" required aria-describedby="title-error">
          <div id="title-error" class="sr-only"></div>
        </div>
        <div class="form-group">
          <label for="url">URL (optional)</label>
          <input type="url" id="url">
        </div>
        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea id="notes" rows="4"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Citation</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Details View -->
  <div id="detailsView" class="details-view" role="dialog" aria-hidden="true">
    <div class="details-header">
      <h2>Citation Details</h2>
      <button class="details-close" id="closeDetails" aria-label="Close details view">Ã—</button>
    </div>
    <div id="detailsContent" class="details-content"></div>
  </div>

  <script>
    class CitationTracker {
      constructor() {
        this.citations = [];
        this.currentEditId = null;
        this.filteredCitations = [];
        this.sortOption = 'newest';
        this.theme = 'system';
        this.init();
      }

      init() {
        this.loadData();
        this.loadSettings();
        this.bindEvents();
        this.render();
        this.updateURLHash();
        window.addEventListener('hashchange', () => this.loadFromHash());
      }

      loadData() {
        try {
          const data = localStorage.getItem('citations');
          this.citations = data ? JSON.parse(data) : [];
        } catch (e) {
          console.error('Failed to load citations:', e);
          this.citations = [];
        }
      }

      saveData() {
        try {
          localStorage.setItem('citations', JSON.stringify(this.citations));
        } catch (e) {
          console.error('Failed to save citations:', e);
        }
      }

      loadSettings() {
        const theme = localStorage.getItem('theme') || 'system';
        const sort = localStorage.getItem('sort') || 'newest';
        this.theme = theme;
        this.sortOption = sort;
        document.documentElement.setAttribute('data-theme', theme);
        document.getElementById('sortSelect').value = sort;
        this.applyTheme(theme);
      }

      saveSettings() {
        localStorage.setItem('theme', this.theme);
        localStorage.setItem('sort', this.sortOption);
      }

      bindEvents() {
        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
        
        // New citation
        document.getElementById('newCitationBtn').addEventListener('click', () => this.openModal());
        
        // Modal
        document.getElementById('citationForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveCitation();
        });
        document.getElementById('cancelBtn').addEventListener('click', () => this.closeModal());
        
        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => this.search(e.target.value));
        
        // Sort
        document.getElementById('sortSelect').addEventListener('change', (e) => {
          this.sortOption = e.target.value;
          this.saveSettings();
          this.render();
        });
        
        // Export/Import
        document.getElementById('exportBtn').addEventListener('click', () => this.exportData());
        document.getElementById('importBtn').addEventListener('click', () => this.importData());
        document.getElementById('importFile').addEventListener('change', (e) => this.handleImport(e));
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => this.handleKeyNavigation(e));
        
        // Close modals with Escape
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.closeModal();
            this.closeDetails();
          }
        });
      }

      toggleTheme() {
        const themes = ['system', 'light', 'dark'];
        const currentIndex = themes.indexOf(this.theme);
        this.theme = themes[(currentIndex + 1) % themes.length];
        this.applyTheme(this.theme);
        this.saveSettings();
      }

      applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        const isDark = theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
        document.getElementById('themeToggle').setAttribute('aria-checked', isDark);
        const sunIcon = document.querySelector('#themeToggle svg');
        sunIcon.innerHTML = isDark ? 
          '<path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>' :
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
      }

      openModal(citation = null) {
        this.currentEditId = citation ? citation.id : null;
        document.getElementById('modalTitle').textContent = citation ? 'Edit Citation' : 'Add Citation';
        this.populateForm(citation);
        document.getElementById('citationModal').classList.add('active');
        document.getElementById('author').focus();
      }

      populateForm(citation) {
        if (citation) {
          document.getElementById('author').value = citation.author;
          document.getElementById('year').value = citation.year;
          document.getElementById('title').value = citation.title;
          document.getElementById('url').value = citation.url || '';
          document.getElementById('notes').value = citation.notes || '';
        } else {
          document.querySelectorAll('#citationForm input, #citationForm textarea').forEach(field => field.value = '');
        }
      }

      saveCitation() {
        const formData = {
          author: document.getElementById('author').value.trim(),
          year: parseInt(document.getElementById('year').value),
          title: document.getElementById('title').value.trim(),
          url: document.getElementById('url').value.trim(),
          notes: document.getElementById('notes').value.trim()
        };

        if (!this.validateForm(formData)) return;

        if (this.currentEditId) {
          const index = this.citations.findIndex(c => c.id === this.currentEditId);
          this.citations[index] = { ...this.citations[index], ...formData };
        } else {
          formData.id = Date.now().toString();
          formData.createdAt = Date.now();
          this.citations.unshift(formData);
        }

        this.saveData();
        this.render();
        this.updateURLHash();
        this.closeModal();
      }

      validateForm(data) {
        const errors = [];
        if (!data.author) errors.push('Author is required');
        if (!data.year || data.year < 1900 || data.year > 2100) errors.push('Valid year (1900-2100) is required');
        if (!data.title) errors.push('Title is required');

        if (errors.length) {
          errors.forEach(error => console.error(error));
          return false;
        }
        return true;
      }

      closeModal() {
        document.getElementById('citationModal').classList.remove('active');
        this.currentEditId = null;
      }

      search(query) {
        if (!query.trim()) {
          this.filteredCitations = [...this.citations];
        } else {
          const q = query.toLowerCase();
          this.filteredCitations = this.citations.filter(citation => 
            citation.author.toLowerCase().includes(q) ||
            citation.title.toLowerCase().includes(q) ||
            citation.notes.toLowerCase().includes(q) ||
            citation.url.toLowerCase().includes(q)
          );
        }
        this.render();
      }

      sortCitations(citations) {
        const sorted = [...citations];
        switch (this.sortOption) {
          case 'newest':
            return sorted.sort((a, b) => b.createdAt - a.createdAt);
          case 'author':
            return sorted.sort((a, b) => a.author.localeCompare(b.author));
          case 'year-desc':
            return sorted.sort((a, b) => b.year - a.year);
          default:
            return sorted;
        }
      }

      render() {
        const container = document.getElementById('citationsGrid');
        const displayCitations = this.sortCitations(this.filteredCitations.length ? this.filteredCitations : this.citations);
        
        if (displayCitations.length === 0) {
          container.innerHTML = `
            <div class="empty-state" role="status">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <h2>No citations yet</h2>
              <p>Add your first citation using the button above!</p>
            </div>
          `;
          return;
        }

        container.innerHTML = displayCitations.map(citation => `
          <article class="card" tabindex="0" role="button" data-citation-id="${citation.id}" aria-label="Citation by ${citation.author}">
            <div class="card-header">
              <div class="card-author">${this.escapeHtml(citation.author)}</div>
              <div class="card-year">${citation.year}</div>
            </div>
            <div class="card-title">${this.escapeHtml(citation.title)}</div>
            <div class="card-snippet">${this.escapeHtml((citation.notes || '').substring(0, 100))}${citation.notes && citation.notes.length > 100 ? '...' : ''}</div>
            <div class="card-actions" style="margin-top: 1rem; opacity: 0; transition: var(--transition);">
              <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); tracker.editCitation('${citation.id}')">Edit</button>
              <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); tracker.deleteCitation('${citation.id}')">Delete</button>
            </div>
          </article>
        `).join('');

        // Add click handlers
        document.querySelectorAll('.card').forEach(card => {
          card.addEventListener('click', () => this.showDetails(card.dataset.citationId));
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.showDetails(card.dataset.citationId);
            }
          });
        });
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      showDetails(id) {
        const citation = this.citations.find(c => c.id === id);
        if (!citation) return;

        document.getElementById('detailsContent').innerHTML = `
          <div class="details-field">
            <strong>Author:</strong> ${this.escapeHtml(citation.author)}
          </div>
          <div class="details-field">
            <strong>Year:</strong> ${citation.year}
          </div>
          <div class="details-field">
            <strong>Title:</strong> ${this.escapeHtml(citation.title)}
          </div>
          ${citation.url ? `
            <div class="details-field">
              <strong>URL:</strong> <a href="${this.escapeHtml(citation.url)}" target="_blank" rel="noopener">${this.escapeHtml(citation.url)}</a>
            </div>
          ` : ''}
          ${citation.notes ? `
            <div class="details-field">
              <strong>Notes:</strong>
              <div style="margin-top: 0.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; white-space: pre-wrap;">${this.escapeHtml(citation.notes)}</div>
            </div>
          ` : ''}
        `;

        document.getElementById('detailsView').classList.add('active');
        document.getElementById('closeDetails').focus();
      }

      closeDetails() {
        document.getElementById('detailsView').classList.remove('active');
      }

      editCitation(id) {
        const citation = this.citations.find(c => c.id === id);
        this.openModal(citation);
      }

      deleteCitation(id) {
        if (confirm('Are you sure you want to delete this citation?')) {
          this.citations = this.citations.filter(c => c.id !== id);
          this.saveData();
          this.render();
          this.updateURLHash();
        }
      }

      exportData() {
        const dataStr = JSON.stringify(this.citations, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'citations.json';
        link.click();
        URL.revokeObjectURL(url);
      }

      importData() {
        document.getElementById('importFile').click();
      }

      handleImport(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const imported = JSON.parse(e.target.result);
            if (Array.isArray(imported)) {
              this.citations = [...this.citations, ...imported.map(c => ({...c, id: c.id || Date.now().toString() + Math.random()}))];
              this.saveData();
              this.render();
              this.updateURLHash();
              e.target.value = '';
            }
          } catch (err) {
            alert('Invalid JSON file');
          }
        };
        reader.readAsText(file);
      }

      updateURLHash() {
        const data = btoa(JSON.stringify(this.citations));
        const cleanHash = data.replace(/[^A-Za-z0-9+/=]/g, '');
        window.location.hash = cleanHash;
      }

      loadFromHash() {
        try {
          const hash = window.location.hash.slice(1);
          if (hash) {
            const data = JSON.parse(atob(hash));
            if (Array.isArray(data)) {
              this.citations = data;
              this.saveData();
              this.render();
            }
          }
        } catch (e) {
          console.error('Invalid hash data');
        }
      }

      handleKeyNavigation(e) {
        const cards = document.querySelectorAll('.card');
        const focused = document.activeElement;
        if (!focused.classList.contains('card')) return;

        const currentIndex = Array.from(cards).indexOf(focused);
        let nextIndex = currentIndex;

        switch (e.key) {
          case 'ArrowDown':
            nextIndex = Math.min(currentIndex + 1, cards.length - 1);
            break;
          case 'ArrowUp':
            nextIndex = Math.max(currentIndex - 1, 0);
            break;
          case 'ArrowRight':
            nextIndex = Math.min(currentIndex + 1, cards.length - 1);
            break;
          case 'ArrowLeft':
            nextIndex = Math.max(currentIndex - 1, 0);
            break;
        }

        if (nextIndex !== currentIndex) {
          cards[nextIndex].focus();
          e.preventDefault();
        }
      }
    }

    // Initialize theme based on system preference
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.setAttribute('data-theme', 'dark');
    }

    // Global tracker instance
    const tracker = new CitationTracker();

    // Expose for inline onclick handlers
    window.tracker = tracker;
  </script>
</body>
</html>