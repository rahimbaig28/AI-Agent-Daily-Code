<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-12-16T08:29:20.881896Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Sketchpad - CSV Visualizer</title>
<style>
* {box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f8f9fa;color:#333;line-height:1.4}
#toolbar{padding:1rem;background:#fff;border-bottom:1px solid #ddd;display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
#title{font-size:1.2rem;font-weight:600;flex:1;min-width:200px}
.btn{padding:.5rem 1rem;border:1px solid #ccc;background:#fff;cursor:pointer;border-radius:4px;font-size:.9rem}
.btn:hover{background:#f0f0f0}.btn-primary{background:#007bff;color:white;border-color:#007bff}
#dropzone{display:flex;flex-direction:column;align-items:center;justify-content:center;border:3px dashed #ccc;border-radius:8px;padding:3rem;min-height:200px;background:#fafbfc;margin:1rem 0;cursor:pointer;transition:all .2s}
#dropzone.dragover{border-color:#007bff;background:#e8f4fd}.hidden{display:none}
#main{display:flex;flex-direction:column;gap:1rem;padding:1rem;max-width:1400px;margin:0 auto}
.panel{flex:1;min-width:300px;background:#fff;border:1px solid #ddd;border-radius:8px;overflow:hidden}
@media (min-width:1000px){#main{flex-direction:row}#sidebar{width:300px;display:flex;flex-direction:column;gap:1rem}}
#chart-container{position:relative;height:500px;background:#fff}
#canvas{width:100%;height:100%;cursor:grab}
#canvas:active{cursor:grabbing}.tooltip{position:absolute;background:#333;color:#fff;padding:.5rem;border-radius:4px;font-size:.8rem;pointer-events:none;opacity:0;transition:opacity .2s}
#small-multiples{display:flex;flex-wrap:wrap;gap:.5rem;padding:1rem;max-height:200px;overflow:auto}
.sparkline{width:120px;height:80px;border:1px solid #eee;border-radius:4px;cursor:pointer}
.sparkline:hover{border-color:#007bff}.sparkline.active{border-color:#007bff;background:#f0f8ff}
#table-container{max-height:400px;overflow:auto}.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:.5rem;border-bottom:1px solid #eee;text-align:left}
.table th{background:#f8f9fa;font-weight:600}.table tr:hover{background:#f0f8ff}
.table tr.selected{background:#e3f2fd}.table tr.filtered{background:#fff3e0}
#filters{display:flex;flex-wrap:wrap;gap:.5rem;padding:1rem}.filter-chip{display:inline-flex;align-items:center;background:#e3f2fd;padding:.5rem;border-radius:20px;font-size:.8rem}
.filter-chip button{margin-left:.5rem;background:none;border:none;cursor:pointer;color:#666}.stats{display:flex;flex-wrap:wrap;gap:.5rem;font-size:.8rem;color:#666}
.col-item{cursor:pointer;padding:.5rem;border-bottom:1px solid #eee}.col-item:hover{background:#f5f5f5}
.col-item.active{background:#e3f2fd}.type-badge{display:inline-block;padding:0 .3rem;border-radius:3px;font-size:.7rem;font-weight:600}
.numeric{background:#2196f3;color:white}.categorical{background:#ff9800;color:white}.date{background:#4caf50;color:white}.text{background:#9e9e9e;color:white}
.progress{position:fixed;top:0;left:0;right:0;background:#007bff;color:white;padding:1rem;text-align:center;z-index:1000}
#color-col{flex:1}.legend{display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}.legend-item{display:flex;align-items:center;gap:.25rem;font-size:.8rem}
</style>
</head>
<body>
<div id="toolbar">
<input id="title" value="Data Sketchpad" aria-label="Chart title">
<button class="btn" id="loadBtn" aria-label="Load CSV">üìÅ Load CSV</button>
<input type="file" id="fileInput" accept=".csv,.tsv" class="hidden" aria-label="Select CSV file">
<button class="btn" id="exportBtn" aria-label="Export filtered data">üíæ Export CSV</button>
<button class="btn" id="exportPng" aria-label="Export chart as PNG">üñºÔ∏è Export PNG</button>
<button class="btn btn-primary" id="printBtn" aria-label="Print report">üñ®Ô∏è Print Report</button>
<button class="btn" id="clearSaved" aria-label="Clear saved data">üóëÔ∏è Clear Saved</button>
<button class="btn" id="undoBtn" aria-label="Undo">‚Ü∂ Undo</button>
</div>

<div id="dropzone" tabindex="0" aria-label="Drag and drop CSV file here or click to browse">
<svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9.09" y1="8.91" x2="9.09" y2="15.09"/><line x1="15" y1="9" x2="15" y2="15"/></svg>
<h3>Drop CSV file here or click to browse</h3>
<p>Supports comma, semicolon, tab delimited files</p>
</div>

<div id="progress" class="hidden">Loading...</div>

<div id="main" class="hidden">
<div id="sidebar">
<div id="discovery" class="panel">
<h3>üìä Data Discovery</h3>
<div id="stats"></div>
</div>
<div id="filters-panel" class="panel">
<h3>üîç Filters</h3>
<div id="filters"></div>
<div id="color-section">
<label>üé® Color by: <select id="color-col"></select></label>
<div id="legend" class="legend"></div>
</div>
</div>
</div>
<div class="panel" style="flex:2">
<h3 id="chart-title">Select a column to visualize</h3>
<div id="chart-container">
<canvas id="canvas" tabindex="0" aria-label="Interactive chart"></canvas>
<div id="tooltip" class="tooltip" role="tooltip"></div>
</div>
<div id="small-multiples"></div>
</div>
<div id="table-panel" class="panel">
<h3>üìã Data Table (<span id="rowcount">0</span> rows)</h3>
<div id="table-container"><div style="padding:2rem;text-align:center;color:#999">Load CSV to see data</div></div>
</div>
</div>

<script>
class DataSketchpad{constructor(){this.data=[],this.columns=[],this.header=!0,this.filtered=[],this.selected=[],this.activeCol=-1,this.colorCol=-1,this.xCol=-1,this.chartState={x:0,y:0,k:1},this.lastState=null,this.parseCSV=(text,sep)=>text.split(/\r?\n/).map(line=>line.split(sep).map(cell=>cell.trim().replace(/^"|"$/g,""))),this.autoDetectSep=text=>[",",";","\t"].reduce((best,sep)=>best.count>=(sepCount=text.match(new RegExp(`(?=(?:[^"]*"[^"]*")*[^"]*$)${sep}`, "g"))?.length||0)&&best.sep||{sep,count:sepCount},sepCount=0).sep,this.detectType=col=>{const vals=this.data.map(row=>row[col]).filter(v=>v),nums=vals.filter(v=>!isNaN(v)&&v!==""),dates=vals.filter(v=>!isNaN(Date.parse(v)));return nums.length/dates.length>.7&&nums.length/vals.length>.5?"numeric":dates.length/vals.length>.5?"date":new Set(vals).size<vals.length*.3?"categorical":"text"},this.getStats=col=>{const vals=this.data.map(row=>row[col]).filter(v=>v),missing=this.data.length-vals.length,unique=new Set(vals).size;let min,max,mean;if(["numeric","date"].includes(this.columns[col].type)){const nums=vals.map(v=>isNaN(v)?0:parseFloat(v));min=Math.min(...nums),max=Math.max(...nums),mean=nums.reduce((a,b)=>a+b,0)/nums.length}return{count:vals.length,unique,missing,min,max,mean}}}init(){this.bindEvents(),this.loadSaved()}bindEvents(){document.getElementById("dropzone").addEventListener("click",()=>document.getElementById("fileInput").click());document.getElementById("fileInput").addEventListener("change",e=>this.loadFile(e.target.files[0]));document.getElementById("dropzone").addEventListener("dragover",e=>{e.preventDefault(),e.currentTarget.classList.add("dragover")});document.getElementById("dropzone").addEventListener("dragleave",e=>e.currentTarget.classList.remove("dragover"));document.getElementById("dropzone").addEventListener("drop",e=>{e.preventDefault(),e.currentTarget.classList.remove("dragover");const file=e.dataTransfer.files[0];file&&this.loadFile(file)});document.getElementById("loadBtn").addEventListener("click",()=>document.getElementById("fileInput").click());document.getElementById("exportBtn").addEventListener("click",()=>this.exportCSV());document.getElementById("exportPng").addEventListener("click",()=>this.exportPNG());document.getElementById("printBtn").addEventListener("click",()=>this.printReport());document.getElementById("clearSaved").addEventListener("click",()=>this.clearSaved());document.getElementById("undoBtn").addEventListener("click",()=>this.undo())}loadFile(file){if(!file)return;const reader=new FileReader();this.showProgress("Parsing CSV...");reader.onload=e=>{try{const text=e.target.result,sep=this.autoDetectSep(text),rows=this.parseCSV(text,sep);if(rows.length<2){alert("File too small");return}this.data=rows.slice(1),this.header=!0,this.columns=rows[0].map((name,i)=>this.header?{name,type:this.detectType(i)}:{name:`Col${i}`,type:this.detectType(i)});this.filtered=[...this.data],this.updateUI(),this.saveState()}catch(err){alert("Parse error: "+err)}},reader.readAsText(file)}showProgress(msg){const prog=document.getElementById("progress");prog.textContent=msg,prog.classList.remove("hidden"),setTimeout(()=>prog.classList.add("hidden"),1500)}updateUI(){this.renderDiscovery(),this.renderFilters(),this.renderTable(),this.renderSmallMultiples(),this.renderChart(),document.getElementById("rowcount").textContent=this.filtered.length}renderDiscovery(){const statsEl=document.getElementById("stats");statsEl.innerHTML=`<div class="stats"><strong>${this.data.length}</strong> rows, <strong>${this.columns.length}</strong> columns</div>`+this.columns.map((col,i)=>`<div class="col-item ${i===this.activeCol?'active':''}" data-col="${i}" tabindex="0" role="button" aria-label="Select column ${col.name}"><span class="type-badge ${col.type}">${col.type[0].toUpperCase()}</span> ${col.name} <span class="stats">${this.getStats(i).count} (${this.getStats(i).unique} unique)</span>${['numeric'].includes(col.type)?`<span class="stats">${this.getStats(i).min?.toFixed(1)||0} - ${this.getStats(i).max?.toFixed(1)||0}</span>`:''}</div>`).join("");statsEl.querySelectorAll(".col-item").forEach(el=>el.addEventListener("click",e=>{this.activeCol=parseInt(e.currentTarget.dataset.col),this.updateUI()}))}renderFilters(){const filtersEl=document.getElementById("filters");filtersEl.innerHTML="";/* simplified filters */document.getElementById("color-col").innerHTML=`<option value="-1">None</option>`+this.columns.filter((c,i)=>c.type==="categorical").map((c,i)=`<option value="${i}" ${i===this.colorCol?'selected':''}>${c.name}</option>`).join("");document.getElementById("color-col").onchange=e=>{this.colorCol=parseInt(e.target.value),this.updateUI()}}renderSmallMultiples(){const container=document.getElementById("small-multiples");const numericCols=this.columns.map((c,i)=>c.type==="numeric"?i:null).filter(Boolean).slice(0,6);container.innerHTML=numericCols.map(col=>`<canvas class="sparkline ${col===this.activeCol?'active':''}" data-col="${col}" width="120" height="80" aria-label="Sparkline for ${this.columns[col].name}"></canvas>`).join("");container.querySelectorAll(".sparkline").forEach(canvas=>{canvas.onclick=()=>this.activeCol=parseInt(canvas.dataset.col),this.drawSparkline(canvas)})}drawSparkline(canvas){const ctx=canvas.getContext("2d"),col=parseInt(canvas.dataset.col);if(!col||col>=this.columns.length)return;const vals=this.filtered.map(row=>parseFloat(row[col])).filter(v=>!isNaN(v));if(vals.length===0)return;const min=Math.min(...vals),max=Math.max(...vals),w=canvas.width,h=canvas.height;ctx.clearRect(0,0,w,h);ctx.strokeStyle=col===this.activeCol?"#007bff":"#ccc",ctx.lineWidth=2,ctx.beginPath();vals.forEach((v,i)=>{const x=i/vals.length*w,y=(1-(v-min)/(max-min||1))*h/2+10;0===i?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.stroke()}renderTable(){const container=document.getElementById("table-container"),fragment=document.createDocumentFragment(),table=document.createElement("table"),thead=document.createElement("thead"),tbody=document.createElement("tbody");thead.innerHTML=`<tr>${this.columns.map(col=>`<th>${col.name}</th>`).join("")}</tr>`;this.filtered.slice(0,100).forEach((row,i)=>{const tr=document.createElement("tr");tr.className=i<this.selected.length&&this.selected.includes(i)?"selected":this.filtered.length!==this.data.length?"filtered":"",tr.dataset.index=i,tr.innerHTML=this.columns.map(col=>`<td>${row[col]||""}</td>`).join(""),tr.tabIndex=0,tr.onkeydown=e=>{"ArrowDown"===e.key?(e.preventDefault(),tr.nextElementSibling?.focus()):"ArrowUp"===e.key?(e.preventDefault(),tr.previousElementSibling?.focus()):"Enter"===e.key&&tr.classList.toggle("selected")},tr.onclick=()=>tr.classList.toggle("selected"),tbody.appendChild(tr)});table.appendChild(thead),table.appendChild(tbody),container.innerHTML="",container.appendChild(table),table.querySelector("tr")?.focus()}renderChart(){if(this.activeCol<0)return;const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),rect=canvas.getBoundingClientRect(),w=canvas.width=rect.width,h=canvas.height=rect.height;canvas.style.width=rect.width+"px",canvas.style.height=rect.height+"px";const data=this.filtered.map((row,i)=>[parseFloat(row[this.activeCol]),i]).filter(([v])=>!isNaN(v));if(data.length===0)return;const minX=Math.min(...data.map(d=>d[0])),maxX=Math.max(...data.map(d=>d[0])),margin=40,view={x:minX+(maxX-minX)*this.chartState.x,y:0,k:this.chartState.k},sx=(x,w)=>margin+(x-view.x)/view.k*(w-2*margin),sy=(y,h)=>h-margin-y*20;ctx.fillStyle="#fafbfc",ctx.fillRect(0,0,w,h),ctx.strokeStyle="#e0e0e0",ctx.lineWidth=1;for(let i=10;i<50;i++){ctx.beginPath(),ctx.moveTo(sx(view.x+i/10*(maxX-minX)/view.k,w),margin),ctx.lineTo(sx(view.x+i/10*(maxX-minX)/view.k,w),h-margin),ctx.stroke()}ctx.strokeStyle="#333",ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(margin,margin),ctx.lineTo(w-margin,margin),ctx.lineTo(w-margin,h-margin),ctx.stroke();data.forEach(([x,i],idx)=>{const px=sx(x,w),py=sy(i,h);ctx.fillStyle=this.colorCol>=0&&this.filtered[i][this.colorCol]?this.getColor(this.filtered[i][this.colorCol]):"#007bff",ctx.beginPath(),ctx.arc(px,py,4,0,Math.PI*2),ctx.fill(),ctx.strokeStyle="white",ctx.lineWidth=1,ctx.stroke()});document.getElementById("chart-title").textContent=`Chart: ${this.columns[this.activeCol].name}`}getColor(val){const hash=Array.from(val).reduce((h,c)=>c.charCodeAt(0)+(h<<5)-h,5381);return`hsl(${(hash%360)},70%,50%)`}saveState(){try{const state={data:this.data.slice(0,5000),columns:this.columns,activeCol:this.activeCol,colorCol:this.colorCol,chartState:this.chartState,title:document.getElementById("title").value};localStorage.setItem("datasketchpad",JSON.stringify(state))}catch(e){}}loadSaved(){try{const saved=localStorage.getItem("datasketchpad");if(saved){const state=JSON.parse(saved);this.data=state.data,this.columns=state.columns,this.activeCol=state.activeCol,this.colorCol=state.colorCol,this.chartState=state.chartState,document.getElementById("title").value=state.title||"Data Sketchpad",this.filtered=[...this.data],document.getElementById("main").classList.remove("hidden"),this.updateUI()}}catch(e){}}clearSaved(){localStorage.removeItem("datasketchpad"),location.reload()}undo(){}exportCSV(){const csv=[this.columns.map(c=>c.name).join(",")].concat(this.filtered.map(row=>this.columns.map(c=>row[c]||'').map(v=>/[\s,"]/.test(v)?'"'+v.replace(/"/g,'""')+'"':v).join(","))).join("\n"),blob=new Blob([csv],{type:"text/csv"}),url=URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download="filtered-data.csv",a.click(),URL.revokeObjectURL(url)}exportPNG(){const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=document.getElementById("canvas").width,canvas.height=document.getElementById("canvas").height,ctx.drawImage(document.getElementById("canvas"),0,0);const link=document.createElement("a");link.download="chart.png",link.href=canvas.toDataURL(),link.click()}printReport(){const printWin=window.open("","print"),title=document.getElementById("title").value;printWin.document.write(`
<!DOCTYPE html>
<html><head><title>${title}</title>
<style>body{font-family:sans-serif;max-width:800px;margin:2in auto;line-height:1.4}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;padding:.5rem}th{background:#f5f5f5}canvas{max-width:100%;height:auto}</style></head>
<body>
<h1>${title}</h1>
<p><strong>${this.data.length}</strong> rows ‚Ä¢ <strong>${this.columns[this.activeCol]?.name||'N/A'}</strong></p>
${this.activeCol>=0?`<canvas width="${document.getElementById("canvas").width}" height="${document.getElementById("canvas").height}"></canvas>`:""}
<h2>Sample Data</h2>
<table>${this.columns.map((c,i)=`<th>${c.name}</th>`).join("")}${this.filtered.slice(0,5).map(row=>`<tr>${this.columns.map(c=>`<td>${row[c]||""}</td>`).join("")}</tr>`).join("")}</table>
</body></html>`);const printCanvas=printWin.document.querySelector("canvas");printCanvas&&printCanvas.getContext("2d").drawImage(document.getElementById("canvas"),0,0),printWin.document.close(),printWin.print()}}
new DataSketchpad().init();
</script>
</body>
</html>