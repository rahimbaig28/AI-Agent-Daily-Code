<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2026-02-08T08:50:12.631433Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Tracker Pro</title>
    <style>
        :root {
            --color-bg: #ffffff;
            --color-surface: #f5f5f5;
            --color-border: #e0e0e0;
            --color-text: #212121;
            --color-text-secondary: #666666;
            --color-primary: #1976d2;
            --color-primary-hover: #1565c0;
            --color-success: #388e3c;
            --color-warning: #f57c00;
            --color-error: #d32f2f;
            --color-paid: #4caf50;
            --color-pending: #ff9800;
            --color-overdue: #f44336;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg: #121212;
                --color-surface: #1e1e1e;
                --color-border: #333333;
                --color-text: #ffffff;
                --color-text-secondary: #b0b0b0;
                --color-primary: #64b5f6;
                --color-primary-hover: #42a5f5;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-secondary {
            background-color: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background-color: var(--color-border);
        }

        .btn-icon {
            padding: 0.5rem;
            width: 44px;
            height: 44px;
            justify-content: center;
        }

        .btn-danger {
            background-color: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c62828;
        }

        .btn:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .theme-toggle {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
        }

        .filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background-color: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            min-height: 44px;
        }

        .filter-btn.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .filter-btn:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background-color: var(--color-surface);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        .summary-label {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-primary);
        }

        .table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-surface);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--color-border);
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--color-text);
            cursor: pointer;
            user-select: none;
        }

        th:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: -2px;
        }

        td {
            padding: 1rem;
            border-top: 1px solid var(--color-border);
        }

        tbody tr:hover {
            background-color: var(--color-bg);
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--color-paid);
        }

        .status-pending {
            background-color: rgba(255, 152, 0, 0.2);
            color: var(--color-pending);
        }

        .status-overdue {
            background-color: rgba(244, 67, 54, 0.2);
            color: var(--color-overdue);
        }

        .actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem;
            width: 44px;
            height: 44px;
            font-size: 0.875rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .empty-state h2 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--color-text);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-bg);
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-md);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
        }

        input, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            background-color: var(--color-surface);
            color: var(--color-text);
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s;
            min-height: 44px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        input.error, textarea.error {
            border-color: var(--color-error);
        }

        input.success, textarea.success {
            border-color: var(--color-success);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .error-message {
            color: var(--color-error);
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: var(--color-text);
            color: var(--color-bg);
            padding: 1rem 1.5rem;
            border-radius: 4px;
            box-shadow: var(--shadow-md);
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .skeleton {
            background: linear-gradient(90deg, var(--color-surface) 25%, var(--color-border) 50%, var(--color-surface) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        .skeleton-row {
            height: 60px;
            margin-bottom: 0.5rem;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .summary {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.875rem;
            }

            th, td {
                padding: 0.75rem 0.5rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .toast {
                left: 1rem;
                right: 1rem;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0.75rem;
            }

            h1 {
                font-size: 1.25rem;
            }

            .filters {
                gap: 0.25rem;
            }

            .filter-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .summary-card {
                padding: 1rem;
            }

            .summary-label {
                font-size: 0.75rem;
            }

            .summary-value {
                font-size: 1.25rem;
            }

            .table-wrapper {
                border-radius: 4px;
            }

            th, td {
                padding: 0.5rem 0.25rem;
            }

            .actions {
                gap: 0.25rem;
            }

            .action-btn {
                padding: 0.25rem;
                width: 36px;
                height: 36px;
                font-size: 0.75rem;
            }

            .modal-content {
                padding: 1rem;
            }

            .modal-header {
                font-size: 1.25rem;
                margin-bottom: 1rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            label {
                font-size: 0.8rem;
            }

            input, textarea {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Invoice Tracker Pro</h1>
            <div class="header-actions">
                <button class="btn-icon theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle theme (Ctrl+Shift+T)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <button class="btn-primary" id="addInvoiceBtn" title="Add new invoice (Ctrl+N)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Invoice
                </button>
                <button class="btn-secondary" id="exportBtn" title="Export to CSV">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export
                </button>
            </div>
        </header>

        <div class="filters" role="group" aria-label="Filter invoices">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="paid">Paid</button>
            <button class="filter-btn" data-filter="pending">Pending</button>
            <button class="filter-btn" data-filter="overdue">Overdue</button>
        </div>

        <div class="summary">
            <div class="summary-card">
                <div class="summary-label">Total</div>
                <div class="summary-value" id="totalAmount">$0.00</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Paid</div>
                <div class="summary-value" id="paidAmount">$0.00</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Pending</div>
                <div class="summary-value" id="pendingAmount">$0.00</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Overdue</div>
                <div class="summary-value" id="overdueAmount">$0.00</div>
            </div>
        </div>

        <div class="table-wrapper">
            <table role="grid" aria-label="Invoices list">
                <thead>
                    <tr>
                        <th tabindex="0" role="columnheader" aria-sort="none">#</th>
                        <th tabindex="0" role="columnheader" aria-sort="none">Client</th>
                        <th tabindex="0" role="columnheader" aria-sort="none">Amount</th>
                        <th tabindex="0" role="columnheader" aria-sort="none">Due Date</th>
                        <th tabindex="0" role="columnheader" aria-sort="none">Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="invoiceList">
                    <tr class="skeleton-row"><td colspan="6"></td></tr>
                    <tr class="skeleton-row"><td colspan="6"></td></tr>
                    <tr class="skeleton-row"><td colspan="6"></td></tr>
                </tbody>
            </table>
        </div>

        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-state-icon">ðŸ“‹</div>
            <h2>No invoices yet</h2>
            <p>Create your first invoice to get started.</p>
            <button class="btn-primary" id="emptyAddBtn" style="margin-top: 1rem;">Add First Invoice</button>
        </div>
    </div>

    <div class="modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">Add Invoice</div>
            <form id="invoiceForm" novalidate>
                <div class="form-group">
                    <label for="clientName">Client Name *</label>
                    <input type="text" id="clientName" name="clientName" required aria-label="Client name">
                    <div class="error-message" id="clientNameError">Client name is required</div>
                </div>
                <div class="form-group">
                    <label for="amount">Amount *</label>
                    <input type="number" id="amount" name="amount" step="0.01" min="0" required aria-label="Invoice amount">
                    <div class="error-message" id="amountError">Amount must be greater than 0</div>
                </div>
                <div class="form-group">
                    <label for="dueDate">Due Date *</label>
                    <input type="date" id="dueDate" name="dueDate" required aria-label="Due date">
                    <div class="error-message" id="dueDateError">Due date is required</div>
                </div>
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" aria-label="Additional notes"></textarea>
                </div>
                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 4px; background-color: var(--color-surface); color: var(--color-text); font-family: inherit; font-size: 1rem; min-height: 44px;" aria-label="Invoice status">
                        <option value="pending">Pending</option>
                        <option value="paid">Paid</option>
                        <option value="overdue">Overdue</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn-primary">Save Invoice</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // State management
        let invoices = [];
        let history = [];
        let historyIndex = -1;
        let currentFilter = 'all';
        let editingId = null;

        const STORAGE_KEY = 'invoiceTrackerData';
        const HISTORY_LIMIT = 10;
        const AUTO_SAVE_INTERVAL = 30000;

        // DOM elements
        const modal = document.getElementById('invoiceModal');
        const form = document.getElementById('invoiceForm');
        const invoiceList = document.getElementById('invoiceList');
        const emptyState = document.getElementById('emptyState');
        const addInvoiceBtn = document.getElementById('addInvoiceBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const exportBtn = document.getElementById('exportBtn');
        const themeToggle = document.getElementById('themeToggle');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const modalTitle = document.getElementById('modalTitle');
        const emptyAddBtn = document.getElementById('emptyAddBtn');

        // Initialize
        function init() {
            loadData();
            if (invoices.length === 0) {
                addSampleData();
            }
            setupEventListeners();
            render();
            setInterval(autoSave, AUTO_SAVE_INTERVAL);
            initTheme();
        }

        // Theme management
        function initTheme() {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = saved ? saved === 'dark' : prefersDark;
            applyTheme(isDark);
        }

        function applyTheme(isDark) {
            if (isDark) {
                document.documentElement.style.colorScheme = 'dark';
            } else {
                document.documentElement.style.colorScheme = 'light';
            }
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.style.colorScheme === 'dark';
            applyTheme(!isDark);
        });

        // Event listeners
        function setupEventListeners() {
            addInvoiceBtn.addEventListener('click', openAddModal);
            emptyAddBtn.addEventListener('click', openAddModal);
            cancelBtn.addEventListener('click', closeModal);
            form.addEventListener('submit', handleFormSubmit);
            exportBtn.addEventListener('click', exportToCSV);

            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    render();
                });
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'n') {
                        e.preventDefault();
                        openAddModal();
                    } else if (e.key === 's') {
                        e.preventDefault();
                        saveData();
                        showToast('Saved');
                    } else if (e.key === 'z') {
                        e.preventDefault();
                        undo();
                    } else if (e.key === 'y') {
                        e.preventDefault();
                        redo();
                    }
                } else if (e.key === 'Escape') {
                    closeModal();
                }
            });

            // Form blur auto-save
            form.addEventListener('blur', saveData, true);
        }

        // Modal management
        function openAddModal() {
            editingId = null;
            form.reset();
            modalTitle.textContent = 'Add Invoice';
            clearErrors();
            modal.classList.add('active');
            document.getElementById('clientName').focus();
        }

        function openEditModal(id) {
            editingId = id;
            const invoice = invoices.find(i => i.id === id);
            if (!invoice) return;

            document.getElementById('clientName').value = invoice.client;
            document.getElementById('amount').value = invoice.amount;
            document.getElementById('dueDate').value = invoice.dueDate;
            document.getElementById('notes').value = invoice.notes || '';
            document.getElementById('status').value = invoice.status;
            modalTitle.textContent = 'Edit Invoice';
            clearErrors();
            modal.classList.add('active');
            document.getElementById('clientName').focus();
        }

        function closeModal() {
            modal.classList.remove('active');
            editingId = null;
            form.reset();
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('input, textarea').forEach(el => {
                el.classList.remove('error', 'success');
            });
        }

        // Form validation
        function validateForm() {
            clearErrors();
            let isValid = true;

            const clientName = document.getElementById('clientName').value.trim();
            if (!clientName) {
                showError('clientName', 'Client name is required');
                isValid = false;
            } else {
                document.getElementById('clientName').classList.add('success');
            }

            const amount = parseFloat(document.getElementById('amount').value);
            if (isNaN(amount) || amount <= 0) {
                showError('amount', 'Amount must be greater than 0');
                isValid = false;
            } else {
                document.getElementById('amount').classList.add('success');
            }

            const dueDate = document.getElementById('dueDate').value;
            if (!dueDate) {
                showError('dueDate', 'Due date is required');
                isValid = false;
            } else {
                document.getElementById('dueDate').classList.add('success');
            }

            return isValid;
        }

        function showError(fieldName, message) {
            const field = document.getElementById(fieldName);
            const errorEl = document.getElementById(fieldName + 'Error');
            field.classList.add('error');
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.add('show');
            }
        }

        // Form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            if (!validateForm()) return;

            const formData = {
                client: document.getElementById('clientName').value.trim(),
                amount: parseFloat(document.getElementById('amount').value),
                dueDate: document.getElementById('dueDate').value,
                notes: document.getElementById('notes').value.trim(),
                status: document.getElementById('status').value
            };

            if (editingId) {
                updateInvoice(editingId, formData);
            } else {
                addInvoice(formData);
            }

            closeModal();
        }

        // Invoice operations
        function addInvoice(data) {
            const invoice = {
                id: Date.now(),
                ...data,
                createdAt: new Date().toISOString()
            };
            invoices.push(invoice);
            addToHistory('add', invoice);
            saveData();
            render();
            showToast('Invoice added');
        }

        function updateInvoice(id, data) {
            const index = invoices.findIndex(i => i.id === id);
            if (index === -1) return;

            const oldInvoice = { ...invoices[index] };
            invoices[index] = { ...invoices[index], ...data };
            addToHistory('edit', { old: oldInvoice, new: invoices[index] });
            saveData();
            render();
            showToast('Invoice updated');
        }

        function deleteInvoice(id) {
            const index = invoices.findIndex(i => i.id === id);
            if (index === -1) return;

            const deleted = invoices[index];
            invoices.splice(index, 1);
            addToHistory('delete', deleted);
            saveData();
            render();
            showToast('Invoice deleted');
        }

        // History management
        function addToHistory(action, data) {
            historyIndex++;
            history = history.slice(0, historyIndex);
            history.push({ action, data, timestamp: Date.now() });
            if (history.length > HISTORY_LIMIT) {
                history.shift();
            } else {
                historyIndex++;
            }
        }

        function undo() {
            if (historyIndex < 0) return;

            const entry = history[historyIndex];
            historyIndex--;

            if (entry.action === 'add') {
                invoices = invoices.filter(i => i.id !== entry.data.id);
            } else if (entry.action === 'delete') {
                invoices.push(entry.data);
            } else if (entry.action === 'edit') {
                const index = invoices.findIndex(i => i.id === entry.data.old.id);
                if (index !== -1) invoices[index] = entry.data.old;
            }

            saveData();
            render();
            showToast('Undo');
        }

        function redo() {
            if (historyIndex >= history.length - 1) return;

            historyIndex++;
            const entry = history[historyIndex];

            if (entry.action === 'add') {
                invoices.push(entry.data);
            } else if (entry.action === 'delete') {
                invoices = invoices.filter(i => i.id !== entry.data.id);
            } else if (entry.action === 'edit') {
                const index = invoices.findIndex(i => i.id === entry.data.new.id);
                if (index !== -1) invoices[index] = entry.data.new;
            }

            saveData();
            render();
            showToast('Redo');
        }

        // Data persistence
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(invoices));
            } catch (e) {
                console.error('Storage full or unavailable');
            }
        }

        function loadData() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                invoices = data ? JSON.parse(data) : [];
            } catch (e) {
                invoices = [];
            }
        }

        function autoSave() {
            saveData();
        }

        // Sample data
        function addSampleData() {
            const today = new Date();
            const samples = [
                {
                    id: 1,
                    client: 'Acme Corp',
                    amount: 2500,
                    dueDate: new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    notes: 'Web design project',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    client: 'Tech Startup Inc',
                    amount: 5000,
                    dueDate: new Date(today.getTime() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    notes: 'Development services',
                    status: 'paid',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    client: 'Global Solutions Ltd',
                    amount: 3750,
                    dueDate: new Date(today.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    notes: 'Consulting hours',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];
            invoices = samples;
            saveData();
        }

        // Rendering
        function render() {
            const filtered = getFilteredInvoices();
            renderInvoices(filtered);
            updateSummary();
            updateEmptyState();
        }

        function getFilteredInvoices() {
            return invoices.filter(invoice => {
                if (currentFilter === 'all') return true;
                return invoice.status === currentFilter;
            }).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }

        function renderInvoices(filtered) {
            invoiceList.innerHTML = '';

            if (filtered.length === 0) {
                invoiceList.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No invoices found</td></tr>';
                return;
            }

            filtered.forEach((invoice, index) => {
                const row = document.createElement('tr');
                const statusClass = `status-${invoice.status}`;
                const formattedAmount = formatCurrency(invoice.amount);
                const formattedDate = formatDate(invoice.dueDate);

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${escapeHtml(invoice.client)}</td>
                    <td>${formattedAmount}</td>
                    <td>${formattedDate}</td>
                    <td><span class="status-badge ${statusClass}">${invoice.status}</span></td>
                    <td>
                        <div class="actions">
                            <button class="action-btn btn-secondary" onclick="openEditModal(${invoice.id})" title="Edit invoice" aria-label="Edit ${escapeHtml(invoice.client)}">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="action-btn btn-danger" onclick="deleteInvoice(${invoice.id})" title="Delete invoice" aria-label="Delete ${escapeHtml(invoice.client)}">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                invoiceList.appendChild(row);
            });
        }

        function updateSummary() {
            const total = invoices.reduce((sum, i) => sum + i.amount, 0);
            const paid = invoices.filter(i => i.status === 'paid').reduce((sum, i) => sum + i.amount, 0);
            const pending = invoices.filter(i => i.status === 'pending').reduce((sum, i) => sum + i.amount, 0);
            const overdue = invoices.filter(i => i.status === 'overdue').reduce((sum, i) => sum + i.amount, 0);

            document.getElementById('totalAmount').textContent = formatCurrency(total);
            document.getElementById('paidAmount').textContent = formatCurrency(paid);
            document.getElementById('pendingAmount').textContent = formatCurrency(pending);
            document.getElementById('overdueAmount').textContent = formatCurrency(overdue);
        }

        function updateEmptyState() {
            emptyState.style.display = invoices.length === 0 ? 'block' : 'none';
        }

        // Export
        function exportToCSV() {
            if (invoices.length === 0) {
                showToast('No invoices to export');
                return;
            }

            const headers = ['ID', 'Client', 'Amount', 'Due Date', 'Status', 'Notes'];
            const rows = invoices.map(i => [
                i.id,
                i.client,
                i.amount,
                i.dueDate,
                i.status,
                i.notes || ''
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => {
                    if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"'))) {
                        return `"${cell.replace(/"/g, '""')}"`;
                    }
                    return cell;
                }).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `invoices-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Exported to CSV');
        }

        // Utilities
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function formatDate(dateStr) {
            return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Start app
        init();
    </script>
</body>
</html>