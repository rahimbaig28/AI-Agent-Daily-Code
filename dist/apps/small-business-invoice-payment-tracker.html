<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-12-08T01:26:22.716253Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Small Business Invoice & Payment Tracker</title>
<style>
  :root {
    --color-bg-light: #f9f9f9;
    --color-text-light: #222;
    --color-bg-dark: #121212;
    --color-text-dark: #eee;
    --color-primary: #007acc;
    --color-error: #c00;
    --color-success: #080;
    --color-border-light: #ccc;
    --color-border-dark: #444;
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  }
  html {
    font-family: var(--font-family);
    line-height: 1.4;
    font-size: 16px;
  }
  body {
    margin: 0;
    background-color: var(--color-bg-light);
    color: var(--color-text-light);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  body.dark {
    background-color: var(--color-bg-dark);
    color: var(--color-text-dark);
  }
  header {
    background-color: var(--color-primary);
    color: white;
    padding: 1rem;
    text-align: center;
    font-weight: 600;
    font-size: 1.25rem;
  }
  main {
    flex: 1 0 auto;
    display: flex;
    flex-direction: column;
    max-width: 960px;
    margin: 1rem auto;
    padding: 0 1rem;
  }
  section {
    margin-bottom: 2rem;
  }
  h2 {
    margin-top: 0;
    font-weight: 600;
    border-bottom: 2px solid var(--color-primary);
    padding-bottom: 0.25rem;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  label {
    font-weight: 600;
  }
  input[type="text"],
  input[type="number"],
  input[type="date"],
  button,
  select {
    font-size: 1rem;
    padding: 0.3rem 0.5rem;
    border: 1px solid var(--color-border-light);
    border-radius: 4px;
    background-color: inherit;
    color: inherit;
  }
  body.dark input[type="text"],
  body.dark input[type="number"],
  body.dark input[type="date"],
  body.dark select {
    border-color: var(--color-border-dark);
    background-color: #222;
    color: var(--color-text-dark);
  }
  button {
    cursor: pointer;
    background-color: var(--color-primary);
    color: white;
    border: none;
    transition: background-color 0.2s ease;
  }
  button:focus,
  button:hover {
    background-color: #005fa3;
    outline: none;
  }
  button[disabled] {
    background-color: #999;
    cursor: not-allowed;
  }
  .items-container {
    border: 1px solid var(--color-border-light);
    border-radius: 4px;
    padding: 0.5rem;
    max-height: 200px;
    overflow-y: auto;
  }
  body.dark .items-container {
    border-color: var(--color-border-dark);
  }
  .item-row {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  .item-row input[type="text"],
  .item-row input[type="number"] {
    flex: 1;
  }
  .item-row input[type="number"] {
    max-width: 6rem;
  }
  .item-row button {
    background-color: var(--color-error);
    padding: 0.2rem 0.5rem;
    font-weight: 700;
  }
  .item-row button:focus,
  .item-row button:hover {
    background-color: #900;
  }
  .total-display {
    font-weight: 700;
    font-size: 1.1rem;
    margin-top: 0.5rem;
    text-align: right;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  thead {
    background-color: var(--color-primary);
    color: white;
  }
  body.dark thead {
    background-color: #005fa3;
  }
  th,
  td {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--color-border-light);
    text-align: left;
  }
  body.dark th,
  body.dark td {
    border-color: var(--color-border-dark);
  }
  th.sortable {
    cursor: pointer;
    user-select: none;
  }
  th.sortable:after {
    content: " \u25B2\u25BC";
    font-size: 0.6rem;
    color: #ccc;
    margin-left: 0.25rem;
  }
  th.sortable.sorted-asc:after {
    content: " \u25B2";
    color: white;
  }
  th.sortable.sorted-desc:after {
    content: " \u25BC";
    color: white;
  }
  .status-paid {
    color: var(--color-success);
    font-weight: 600;
  }
  .status-unpaid {
    color: var(--color-error);
    font-weight: 600;
  }
  .filter-controls {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
    align-items: center;
  }
  .filter-controls label {
    font-weight: 600;
  }
  .summary {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    font-weight: 600;
    font-size: 1.1rem;
  }
  .summary-item {
    flex: 1 1 150px;
    background-color: var(--color-primary);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    text-align: center;
  }
  body.dark .summary-item {
    background-color: #005fa3;
  }
  .theme-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: none;
    border: 2px solid var(--color-primary);
    border-radius: 4px;
    color: var(--color-primary);
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    cursor: pointer;
    user-select: none;
  }
  body.dark .theme-toggle {
    border-color: var(--color-text-dark);
    color: var(--color-text-dark);
  }
  @media (max-width: 600px) {
    .item-row {
      flex-direction: column;
      align-items: stretch;
    }
    .item-row input[type="text"],
    .item-row input[type="number"] {
      max-width: 100%;
    }
    .summary {
      flex-direction: column;
    }
  }
</style>
</head>
<body>
<header>
  Small Business Invoice & Payment Tracker
</header>
<button id="themeToggle" class="theme-toggle" aria-pressed="false" aria-label="Toggle dark/light theme">Toggle Theme</button>
<main>
  <section aria-labelledby="create-invoice-title">
    <h2 id="create-invoice-title">Create New Invoice</h2>
    <form id="invoiceForm" aria-describedby="formInstructions">
      <div>
        <label for="clientName">Client Name</label>
        <input type="text" id="clientName" name="clientName" required autocomplete="off" aria-required="true" />
      </div>
      <fieldset>
        <legend>Invoice Items</legend>
        <div class="items-container" id="itemsContainer" aria-live="polite" aria-relevant="additions removals">
          <!-- Item rows inserted here -->
        </div>
        <button type="button" id="addItemBtn" aria-label="Add new invoice item">+ Add Item</button>
      </fieldset>
      <div class="total-display" aria-live="polite" aria-atomic="true">Total: $0.00</div>
      <button type="submit" id="saveInvoiceBtn">Save Invoice</button>
      <button type="button" id="resetFormBtn">Reset Form</button>
    </form>
  </section>

  <section aria-labelledby="filter-invoices-title">
    <h2 id="filter-invoices-title">Invoices</h2>
    <div class="filter-controls" role="region" aria-label="Filter and sort invoices">
      <label for="statusFilter">Filter by status:</label>
      <select id="statusFilter" name="statusFilter" aria-controls="invoiceTable">
        <option value="all">All</option>
        <option value="paid">Paid</option>
        <option value="unpaid">Unpaid</option>
      </select>
      <label for="dateSort">Sort by date:</label>
      <select id="dateSort" name="dateSort" aria-controls="invoiceTable">
        <option value="desc">Newest first</option>
        <option value="asc">Oldest first</option>
      </select>
      <button type="button" id="addInvoiceShortcut" aria-label="Focus on create invoice client name input" title="Shortcut: Ctrl+N">New Invoice (Ctrl+N)</button>
      <button type="button" id="toggleFilterShortcut" aria-label="Toggle filter between all and unpaid" title="Shortcut: Ctrl+F">Toggle Filter (Ctrl+F)</button>
    </div>
    <div style="overflow-x:auto;">
      <table id="invoiceTable" aria-describedby="invoiceTableDesc" role="grid" tabindex="0">
        <caption id="invoiceTableDesc">List of invoices with client, date, total, status, payment date, and actions</caption>
        <thead>
          <tr>
            <th scope="col" class="sortable" data-sort-key="clientName" tabindex="0" aria-sort="none" aria-label="Client name, sortable">Client</th>
            <th scope="col" class="sortable" data-sort-key="date" tabindex="0" aria-sort="descending" aria-label="Invoice date, sortable">Date</th>
            <th scope="col" aria-label="Invoice total amount">Total</th>
            <th scope="col" class="sortable" data-sort-key="status" tabindex="0" aria-sort="none" aria-label="Status, sortable">Status</th>
            <th scope="col" class="sortable" data-sort-key="paymentDate" tabindex="0" aria-sort="none" aria-label="Payment date, sortable">Payment Date</th>
            <th scope="col" aria-label="Actions">Actions</th>
          </tr>
        </thead>
        <tbody id="invoiceTableBody">
          <!-- Invoices inserted here -->
        </tbody>
      </table>
    </div>
  </section>

  <section aria-labelledby="summary-title">
    <h2 id="summary-title">Summary Dashboard</h2>
    <div class="summary" role="region" aria-live="polite" aria-atomic="true" aria-label="Invoice summary dashboard">
      <div class="summary-item" id="totalOutstanding">Outstanding: $0.00</div>
      <div class="summary-item" id="totalReceived">Received: $0.00</div>
      <div class="summary-item" id="invoiceCount">Invoices: 0</div>
    </div>
  </section>

  <section aria-labelledby="share-data-title">
    <h2 id="share-data-title">Share / Backup Invoice Data</h2>
    <p>Use the URL below to share or backup your invoice data. The data is encoded in the URL hash.</p>
    <textarea id="shareData" rows="3" readonly aria-label="Encoded invoice data for sharing or backup"></textarea>
    <button type="button" id="copyShareDataBtn" aria-label="Copy encoded invoice data to clipboard">Copy Data</button>
    <button type="button" id="loadShareDataBtn" aria-label="Load invoice data from URL hash">Load Data from URL</button>
  </section>
</main>

<script>
(() => {
  "use strict";

  // DOM Elements
  const invoiceForm = document.getElementById("invoiceForm");
  const clientNameInput = document.getElementById("clientName");
  const itemsContainer = document.getElementById("itemsContainer");
  const addItemBtn = document.getElementById("addItemBtn");
  const totalDisplay = invoiceForm.querySelector(".total-display");
  const saveInvoiceBtn = document.getElementById("saveInvoiceBtn");
  const resetFormBtn = document.getElementById("resetFormBtn");

  const statusFilter = document.getElementById("statusFilter");
  const dateSort = document.getElementById("dateSort");
  const invoiceTableBody = document.getElementById("invoiceTableBody");

  const totalOutstandingEl = document.getElementById("totalOutstanding");
  const totalReceivedEl = document.getElementById("totalReceived");
  const invoiceCountEl = document.getElementById("invoiceCount");

  const shareDataTextarea = document.getElementById("shareData");
  const copyShareDataBtn = document.getElementById("copyShareDataBtn");
  const loadShareDataBtn = document.getElementById("loadShareDataBtn");

  const themeToggleBtn = document.getElementById("themeToggle");

  // State
  let invoices = [];
  let editingInvoiceId = null;
  let currentSortKey = "date";
  let currentSortDir = "desc";

  // Constants
  const STORAGE_KEY = "sb-invoice-tracker-data";

  // Utility functions
  function formatCurrency(num) {
    return "$" + num.toFixed(2);
  }
  function formatDateISO(date) {
    return date.toISOString().slice(0, 10);
  }
  function parseDateISO(str) {
    const d = new Date(str);
    return isNaN(d) ? null : d;
  }
  function generateId() {
    return "inv-" + Math.random().toString(36).slice(2, 10);
  }
  function deepClone(obj) {
    return JSON.parse(JSON.stringify(obj));
  }

  // Theme management
  function applyTheme(theme) {
    if (theme === "dark") {
      document.body.classList.add("dark");
      themeToggleBtn.setAttribute("aria-pressed", "true");
    } else {
      document.body.classList.remove("dark");
      themeToggleBtn.setAttribute("aria-pressed", "false");
    }
  }
  function detectSystemTheme() {
    return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  }
  function loadTheme() {
    const stored = localStorage.getItem("sb-invoice-tracker-theme");
    if (stored === "dark" || stored === "light") return stored;
    return detectSystemTheme();
  }
  function saveTheme(theme) {
    localStorage.setItem("sb-invoice-tracker-theme", theme);
  }
  themeToggleBtn.addEventListener("click", () => {
    const newTheme = document.body.classList.contains("dark") ? "light" : "dark";
    applyTheme(newTheme);
    saveTheme(newTheme);
  });

  // Invoice item row creation
  function createItemRow(desc = "", qty = 1, price = 0) {
    const row = document.createElement("div");
    row.className = "item-row";

    const descInput = document.createElement("input");
    descInput.type = "text";
    descInput.placeholder = "Description";
    descInput.value = desc;
    descInput.required = true;
    descInput.setAttribute("aria-label", "Item description");
    descInput.autocomplete = "off";

    const qtyInput = document.createElement("input");
    qtyInput.type = "number";
    qtyInput.min = "1";
    qtyInput.step = "1";
    qtyInput.value = qty;
    qtyInput.required = true;
    qtyInput.setAttribute("aria-label", "Item quantity");

    const priceInput = document.createElement("input");
    priceInput.type = "number";
    priceInput.min = "0";
    priceInput.step = "0.01";
    priceInput.value = price;
    priceInput.required = true;
    priceInput.setAttribute("aria-label", "Item unit price");

    const removeBtn = document.createElement("button");
    removeBtn.type = "button";
    removeBtn.textContent = "Ã—";
    removeBtn.title = "Remove item";
    removeBtn.setAttribute("aria-label", "Remove this item");
    removeBtn.addEventListener("click", () => {
      row.remove();
      updateTotal();
    });

    // Update total on input change
    [descInput, qtyInput, priceInput].forEach(input => {
      input.addEventListener("input", () => {
        updateTotal();
      });
    });

    row.appendChild(descInput);
    row.appendChild(qtyInput);
    row.appendChild(priceInput);
    row.appendChild(removeBtn);

    return row;
  }

  // Add new item row
  function addItemRow(desc = "", qty = 1, price = 0) {
    const row = createItemRow(desc, qty, price);
    itemsContainer.appendChild(row);
    row.querySelector("input[type=text]").focus();
    updateTotal();
  }

  // Calculate and update total display
  function updateTotal() {
    let total = 0;
    const rows = itemsContainer.querySelectorAll(".item-row");
    rows.forEach(row => {
      const qty = parseInt(row.querySelector('input[type="number"]:nth-of-type(1)').value, 10);
      const price = parseFloat(row.querySelector('input[type="number"]:nth-of-type(2)').value);
      if (!isNaN(qty) && !isNaN(price)) {
        total += qty * price;
      }
    });
    totalDisplay.textContent = `Total: ${formatCurrency(total)}`;
  }

  // Reset form to initial state
  function resetForm() {
    invoiceForm.reset();
    itemsContainer.innerHTML = "";
    addItemRow();
    editingInvoiceId = null;
    saveInvoiceBtn.textContent = "Save Invoice";
    updateTotal();
  }

  // Load invoices from localStorage
  function loadInvoices() {
    try {
      const data = localStorage.getItem(STORAGE_KEY);
      if (data) {
        invoices = JSON.parse(data);
      } else {
        invoices = [];
      }
    } catch {
      invoices = [];
    }
  }

  // Save invoices to localStorage
  function saveInvoices() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(invoices));
  }

  // Render invoices table based on filters and sorting
  function renderInvoices() {
    const filter = statusFilter.value;
    const sortKey = currentSortKey;
    const sortDir = currentSortDir;

    let filtered = invoices.filter(inv => {
      if (filter === "all") return true;
      if (filter === "paid") return inv.status === "paid";
      if (filter === "unpaid") return inv.status === "unpaid";
      return true;
    });

    filtered.sort((a, b) => {
      let valA = a[sortKey];
      let valB = b[sortKey];
      if (sortKey === "date" || sortKey === "paymentDate") {
        valA = valA ? new Date(valA) : new Date(0);
        valB = valB ? new Date(valB) : new Date(0);
      } else {
        valA = valA || "";
        valB = valB || "";
      }
      if (valA < valB) return sortDir === "asc" ? -1 : 1;
      if (valA > valB) return sortDir === "asc" ? 1 : -1;
      return 0;
    });

    invoiceTableBody.innerHTML = "";
    if (filtered.length === 0) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 6;
      td.textContent = "No invoices found.";
      td.style.textAlign = "center";
      tr.appendChild(td);
      invoiceTableBody.appendChild(tr);
      return;
    }

    filtered.forEach(inv => {
      const tr = document.createElement("tr");
      // Client
      const tdClient = document.createElement("td");
      tdClient.textContent = inv.clientName;
      tr.appendChild(tdClient);
      // Date
      const tdDate = document.createElement("td");
      tdDate.textContent = inv.date ? formatDateISO(new Date(inv.date)) : "";
      tr.appendChild(tdDate);
      // Total
      const tdTotal = document.createElement("td");
      tdTotal.textContent = formatCurrency(inv.total);
      tr.appendChild(tdTotal);
      // Status
      const tdStatus = document.createElement("td");
      tdStatus.textContent = inv.status === "paid" ? "Paid" : "Unpaid";
      tdStatus.className = inv.status === "paid" ? "status-paid" : "status-unpaid";
      tr.appendChild(tdStatus);
      // Payment Date
      const tdPayDate = document.createElement("td");
      tdPayDate.textContent = inv.paymentDate ? formatDateISO(new Date(inv.paymentDate)) : "";
      tr.appendChild(tdPayDate);
      // Actions
      const tdActions = document.createElement("td");

      // Edit button
      const editBtn = document.createElement("button");
      editBtn.type = "button";
      editBtn.textContent = "Edit";
      editBtn.setAttribute("aria-label", `Edit invoice for ${inv.clientName}`);
      editBtn.addEventListener("click", () => {
        startEditInvoice(inv.id);
      });
      tdActions.appendChild(editBtn);

      // Delete button
      const delBtn = document.createElement("button");
      delBtn.type = "button";
      delBtn.textContent = "Delete";
      delBtn.setAttribute("aria-label", `Delete invoice for ${inv.clientName}`);
      delBtn.style.marginLeft = "0.5rem";
      delBtn.addEventListener("click", () => {
        if (confirm(`Delete invoice for ${inv.clientName}? This cannot be undone.`)) {
          invoices = invoices.filter(i => i.id !== inv.id);
          saveInvoices();
          renderInvoices();
          updateSummary();
          if (editingInvoiceId === inv.id) resetForm();
          updateShareData();
        }
      });
      tdActions.appendChild(delBtn);

      // Toggle paid/unpaid button
      const toggleBtn = document.createElement("button");
      toggleBtn.type = "button";
      toggleBtn.textContent = inv.status === "paid" ? "Mark Unpaid" : "Mark Paid";
      toggleBtn.style.marginLeft = "0.5rem";
      toggleBtn.setAttribute("aria-label", `${toggleBtn.textContent} for invoice of ${inv.clientName}`);
      toggleBtn.addEventListener("click", () => {
        if (inv.status === "paid") {
          inv.status = "unpaid";
          inv.paymentDate = null;
        } else {
          inv.status = "paid";
          inv.paymentDate = formatDateISO(new Date());
        }
        saveInvoices();
        renderInvoices();
        updateSummary();
        updateShareData();
      });
      tdActions.appendChild(toggleBtn);

      tr.appendChild(tdActions);

      invoiceTableBody.appendChild(tr);
    });
  }

  // Update summary dashboard
  function updateSummary() {
    let outstanding = 0;
    let received = 0;
    invoices.forEach(inv => {
      if (inv.status === "paid") {
        received += inv.total;
      } else {
        outstanding += inv.total;
      }
    });
    totalOutstandingEl.textContent = `Outstanding: ${formatCurrency(outstanding)}`;
    totalReceivedEl.textContent = `Received: ${formatCurrency(received)}`;
    invoiceCountEl.textContent = `Invoices: ${invoices.length}`;
  }

  // Start editing an invoice
  function startEditInvoice(id) {
    const inv = invoices.find(i => i.id === id);
    if (!inv) return;
    editingInvoiceId = id;
    clientNameInput.value = inv.clientName;
    itemsContainer.innerHTML = "";
    inv.items.forEach(item => {
      addItemRow(item.description, item.quantity, item.unitPrice);
    });
    updateTotal();
    saveInvoiceBtn.textContent = "Update Invoice";
    // Scroll to form and focus client name
    clientNameInput.focus();
  }

  // Serialize invoices to URL hash (compressed base64 JSON)
  function updateShareData() {
    try {
      const json = JSON.stringify(invoices);
      const encoded = btoa(encodeURIComponent(json));
      shareDataTextarea.value = encoded;
      window.location.hash = encoded;
    } catch {
      shareDataTextarea.value = "";
    }
  }

  // Load invoices from URL hash
  function loadFromUrlHash() {
    try {
      const hash = window.location.hash.slice(1);
      if (!hash) return false;
      const json = decodeURIComponent(atob(hash));
      const data = JSON.parse(json);
      if (Array.isArray(data)) {
        invoices = data;
        saveInvoices();
        renderInvoices();
        updateSummary();
        updateShareData();
        return true;
      }
    } catch {
      // ignore errors
    }
    return false;
  }

  // Copy share data textarea content to clipboard
  copyShareDataBtn.addEventListener("click", () => {
    shareDataTextarea.select();
    shareDataTextarea.setSelectionRange(0, 99999);
    try {
      document.execCommand("copy");
      copyShareDataBtn.textContent = "Copied!";
      setTimeout(() => {
        copyShareDataBtn.textContent = "Copy Data";
      }, 1500);
    } catch {
      alert("Copy failed. Please copy manually.");
    }
  });

  // Load data from URL hash button
  loadShareDataBtn.addEventListener("click", () => {
    if (loadFromUrlHash()) {
      alert("Invoice data loaded from URL.");
    } else {
      alert("No valid invoice data found in URL.");
    }
  });

  // Add new item button
  addItemBtn.addEventListener("click", () => {
    addItemRow();
  });

  // Form submit handler
  invoiceForm.addEventListener("submit", e => {
    e.preventDefault();
    const clientName = clientNameInput.value.trim();
    if (!clientName) {
      alert("Client name is required.");
      clientNameInput.focus();
      return;
    }
    const itemRows = itemsContainer.querySelectorAll(".item-row");
    if (itemRows.length === 0) {
      alert("Add at least one invoice item.");
      addItemBtn.focus();
      return;
    }
    const items = [];
    for (const row of itemRows) {
      const desc = row.querySelector('input[type="text"]').value.trim();
      const qty = parseInt(row.querySelector('input[type="number"]:nth-of-type(1)').value, 10);
      const price = parseFloat(row.querySelector('input[type="number"]:nth-of-type(2)').value);
      if (!desc) {
        alert("Item description cannot be empty.");
        row.querySelector('input[type="text"]').focus();
        return;
      }
      if (isNaN(qty) || qty < 1) {
        alert("Item quantity must be at least 1.");
        row.querySelector('input[type="number"]:nth-of-type(1)').focus();
        return;
      }
      if (isNaN(price) || price < 0) {
        alert("Item price must be 0 or more.");
        row.querySelector('input[type="number"]:nth-of-type(2)').focus();
        return;
      }
      items.push({ description: desc, quantity: qty, unitPrice: price });
    }
    const total = items.reduce((acc, i) => acc + i.quantity * i.unitPrice, 0);
    const nowISO = new Date().toISOString();

    if (editingInvoiceId) {
      // Update existing invoice
      const inv = invoices.find(i => i.id === editingInvoiceId);
      if (!inv) return;
      inv.clientName = clientName;
      inv.items = items;
      inv.total = total;
      // Keep original date and payment info
    } else {
      // New invoice
      const newInvoice = {
        id: generateId(),
        clientName,
        items,
        total,
        date: nowISO,
        status: "unpaid",
        paymentDate: null,
      };
      invoices.push(newInvoice);
    }
    saveInvoices();
    renderInvoices();
    updateSummary();
    updateShareData();
    resetForm();
  });

  // Reset form button
  resetFormBtn.addEventListener("click", e => {
    e.preventDefault();
    resetForm();
  });

  // Filters change handlers
  statusFilter.addEventListener("change", () => {
    renderInvoices();
  });
  dateSort.addEventListener("change", () => {
    currentSortKey = "date";
    currentSortDir = dateSort.value;
    updateSortIndicators();
    renderInvoices();
  });

  // Table header sorting
  const sortableHeaders = document.querySelectorAll("th.sortable");
  sortableHeaders.forEach(th => {
    th.addEventListener("click", () => {
      const key = th.dataset.sortKey;
      if (currentSortKey === key) {
        currentSortDir = currentSortDir === "asc" ? "desc" : "asc";
      } else {
        currentSortKey = key;
        currentSortDir = "asc";
      }
      updateSortIndicators();
      renderInvoices();
    });
    th.addEventListener("keydown", e => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        th.click();
      }
    });
  });
  function updateSortIndicators() {
    sortableHeaders.forEach(th => {
      th.classList.remove("sorted-asc", "sorted-desc");
      th.setAttribute("aria-sort", "none");
      if (th.dataset.sortKey === currentSortKey) {
        th.classList.add(currentSortDir === "asc" ? "sorted-asc" : "sorted-desc");
        th.setAttribute("aria-sort", currentSortDir === "asc" ? "ascending" : "descending");
      }
    });
    // Sync dateSort select if sorting by date
    if (currentSortKey === "date") {
      dateSort.value = currentSortDir;
    }
  }

  // Keyboard shortcuts
  document.addEventListener("keydown", e => {
    if (e.ctrlKey && !e.shiftKey && !e.altKey) {
      if (e.key.toLowerCase() === "n") {
        e.preventDefault();
        clientNameInput.focus();
      } else if (e.key.toLowerCase() === "f") {
        e.preventDefault();
        // Toggle filter between all and unpaid
        if (statusFilter.value === "all") {
          statusFilter.value = "unpaid";
        } else {
          statusFilter.value = "all";
        }
        statusFilter.dispatchEvent(new Event("change"));
      }
    }
  });

  // Initialize form with one item row
  function initForm() {
    itemsContainer.innerHTML = "";
    addItemRow();
    updateTotal();
  }

  // Load data from localStorage or URL hash
  function initData() {
    if (!loadFromUrlHash()) {
      loadInvoices();
    }
  }

  // Initialization
  function init() {
    // Theme
    applyTheme(loadTheme());

    initForm();
    initData();
    renderInvoices();
    updateSummary();
    updateSortIndicators();
    updateShareData();
  }

  init();
})();
</script>
</body>
</html>