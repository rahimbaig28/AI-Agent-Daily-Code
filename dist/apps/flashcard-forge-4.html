<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2026-02-12T22:49:24.975760Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Flashcard Forge - Offline-first flashcard study app">
    <title>Flashcard Forge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f9fafb;
            --surface: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        body.high-contrast {
            --bg: #000000;
            --surface: #1a1a1a;
            --text: #ffffff;
            --text-light: #cccccc;
            --border: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--primary);
            color: white;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        button:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        button.secondary {
            background-color: var(--border);
            color: var(--text);
        }

        button.danger {
            background-color: var(--danger);
        }

        button.success {
            background-color: var(--success);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border);
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-light);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-btn:hover {
            color: var(--text);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .deck-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .deck-card {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow);
        }

        .deck-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .deck-card h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .deck-card p {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .deck-actions {
            display: flex;
            gap: 8px;
        }

        .deck-actions button {
            flex: 1;
            padding: 6px 12px;
            font-size: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--surface);
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            font-size: 22px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            background-color: var(--bg);
            color: var(--text);
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .study-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .study-header {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .study-header h2 {
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-light);
        }

        .card-flip {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 40px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            font-size: 24px;
            font-weight: 500;
            word-wrap: break-word;
            user-select: none;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card.flipped {
            background-color: var(--primary);
            color: white;
        }

        .card-counter {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .study-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .study-controls button {
            flex: 1;
            max-width: 150px;
        }

        .answer-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .answer-buttons button {
            flex: 1;
            max-width: 150px;
        }

        .stats-panel {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .card-item {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }

        .card-item:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-item h4 {
            margin-bottom: 10px;
            font-size: 16px;
            word-break: break-word;
        }

        .card-item p {
            color: var(--text-light);
            font-size: 13px;
            margin-bottom: 15px;
            word-break: break-word;
        }

        .card-item-actions {
            display: flex;
            gap: 8px;
        }

        .card-item-actions button {
            flex: 1;
            padding: 6px 12px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--text);
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }

            .deck-list {
                grid-template-columns: 1fr;
            }

            .card {
                min-height: 200px;
                padding: 30px;
                font-size: 18px;
            }

            header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header-controls {
                width: 100%;
                justify-content: flex-start;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease-out;
            z-index: 2000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .drag-handle {
            cursor: grab;
            color: var(--text-light);
            margin-right: 10px;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .deck-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.2s;
        }

        .deck-item:hover {
            box-shadow: var(--shadow);
        }

        .deck-item.dragging {
            opacity: 0.5;
        }

        .deck-item-name {
            flex: 1;
            font-weight: 500;
        }

        .deck-item-count {
            color: var(--text-light);
            font-size: 12px;
            margin-right: 15px;
        }

        .deck-item-actions {
            display: flex;
            gap: 8px;
        }

        .deck-item-actions button {
            padding: 4px 8px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Flashcard Forge</h1>
            <div class="header-controls">
                <button class="secondary" id="contrastToggle" aria-label="Toggle high contrast mode">üåô Contrast</button>
                <button class="secondary" id="shareBtn" aria-label="Share current deck via URL">üì§ Share</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="decks" aria-label="View all decks">üìö Decks</button>
            <button class="tab-btn" data-tab="new-deck" aria-label="Create new deck">‚ûï New Deck</button>
            <button class="tab-btn" data-tab="study" aria-label="Study mode">üéØ Study</button>
        </div>

        <!-- Decks Tab -->
        <div id="decks" class="tab-content active">
            <div id="deckList" class="deck-list"></div>
            <div id="emptyDecks" class="empty-state" style="display: none;">
                <h3>No decks yet</h3>
                <p>Create your first deck to get started</p>
            </div>
        </div>

        <!-- New Deck Tab -->
        <div id="new-deck" class="tab-content">
            <div style="max-width: 600px;">
                <div class="form-group">
                    <label for="deckName">Deck Name</label>
                    <input type="text" id="deckName" placeholder="e.g., Spanish Vocabulary" aria-label="Deck name">
                    <div class="error" id="deckNameError"></div>
                </div>

                <button id="createDeckBtn" aria-label="Create new deck">Create Deck</button>

                <div id="currentDeckSection" style="display: none; margin-top: 40px;">
                    <h2 id="currentDeckTitle" style="margin-bottom: 20px;"></h2>

                    <div class="stats-panel">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="deckSize">0</div>
                                <div class="stat-label">Cards</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="masteryPercent">0%</div>
                                <div class="stat-label">Mastery</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="streakCount">0</div>
                                <div class="stat-label">Streak</div>
                            </div>
                        </div>
                        <button class="secondary danger" id="resetStatsBtn" style="width: 100%;" aria-label="Reset all statistics">Reset Stats</button>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="cardQuestion">Question</label>
                        <textarea id="cardQuestion" placeholder="Enter question" aria-label="Card question"></textarea>
                        <div class="error" id="questionError"></div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="cardAnswer">Answer</label>
                        <textarea id="cardAnswer" placeholder="Enter answer" aria-label="Card answer"></textarea>
                        <div class="error" id="answerError"></div>
                    </div>

                    <button id="addCardBtn" aria-label="Add card to deck">Add Card</button>

                    <div id="cardsGrid" class="cards-grid" style="margin-top: 30px;"></div>

                    <div id="emptyCards" class="empty-state" style="display: none;">
                        <h3>No cards yet</h3>
                        <p>Add your first card above</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Study Tab -->
        <div id="study" class="tab-content">
            <div id="studySelectDeck" style="display: none;">
                <div class="empty-state">
                    <h3>Select a deck to study</h3>
                    <p>Go to the Decks tab to choose a deck</p>
                </div>
            </div>

            <div id="studyMode" class="study-container" style="display: none;">
                <div class="study-header">
                    <h2 id="studyDeckName"></h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="studyProgress"></div>
                    </div>
                    <div class="progress-text" id="studyProgressText"></div>
                </div>

                <div class="card-counter" id="cardCounter"></div>

                <div class="card-flip">
                    <div class="card" id="studyCard" role="button" tabindex="0" aria-label="Flashcard - click or press spacebar to flip">
                        <span id="cardContent"></span>
                    </div>
                </div>

                <div class="study-controls">
                    <button id="prevBtn" aria-label="Previous card">‚Üê Prev</button>
                    <button id="nextBtn" aria-label="Next card">Next ‚Üí</button>
                </div>

                <div class="answer-buttons">
                    <button class="danger" id="incorrectBtn" aria-label="Mark as incorrect (N)">‚úó Incorrect</button>
                    <button class="success" id="correctBtn" aria-label="Mark as correct (Enter)">‚úì Correct</button>
                </div>

                <div style="margin-top: 30px;">
                    <button class="secondary" id="exitStudyBtn" style="width: 100%;" aria-label="Exit study mode">Exit Study</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State Management
        const state = {
            decks: [],
            currentDeck: null,
            currentCardIndex: 0,
            studyMode: false,
            autoSaveTimer: null,
            draggedDeck: null
        };

        // DOM Elements
        const elements = {
            tabs: document.querySelectorAll('.tab-btn'),
            tabContents: document.querySelectorAll('.tab-content'),
            deckList: document.getElementById('deckList'),
            deckName: document.getElementById('deckName'),
            createDeckBtn: document.getElementById('createDeckBtn'),
            currentDeckSection: document.getElementById('currentDeckSection'),
            currentDeckTitle: document.getElementById('currentDeckTitle'),
            cardQuestion: document.getElementById('cardQuestion'),
            cardAnswer: document.getElementById('cardAnswer'),
            addCardBtn: document.getElementById('addCardBtn'),
            cardsGrid: document.getElementById('cardsGrid'),
            emptyCards: document.getElementById('emptyCards'),
            emptyDecks: document.getElementById('emptyDecks'),
            studyCard: document.getElementById('studyCard'),
            cardContent: document.getElementById('cardContent'),
            cardCounter: document.getElementById('cardCounter'),
            studyProgress: document.getElementById('studyProgress'),
            studyProgressText: document.getElementById('studyProgressText'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            correctBtn: document.getElementById('correctBtn'),
            incorrectBtn: document.getElementById('incorrectBtn'),
            exitStudyBtn: document.getElementById('exitStudyBtn'),
            studyMode: document.getElementById('studyMode'),
            studySelectDeck: document.getElementById('studySelectDeck'),
            studyDeckName: document.getElementById('studyDeckName'),
            contrastToggle: document.getElementById('contrastToggle'),
            shareBtn: document.getElementById('shareBtn'),
            resetStatsBtn: document.getElementById('resetStatsBtn'),
            deckSize: document.getElementById('deckSize'),
            masteryPercent: document.getElementById('masteryPercent'),
            streakCount: document.getElementById('streakCount')
        };

        // Initialize
        function init() {
            loadFromLocalStorage();
            parseUrlHash();
            setupEventListeners();
            loadContrastPreference();
            render();
        }

        function setupEventListeners() {
            // Tab navigation
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Deck creation
            elements.createDeckBtn.addEventListener('click', createDeck);
            elements.deckName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') createDeck();
            });

            // Card management
            elements.addCardBtn.addEventListener('click', addCard);
            elements.cardQuestion.addEventListener('keypress', (e) => {
                if (e.ctrlKey && e.key === 'Enter') addCard();
            });
            elements.cardAnswer.addEventListener('keypress', (e) => {
                if (e.ctrlKey && e.key === 'Enter') addCard();
            });

            // Study mode
            elements.prevBtn.addEventListener('click', previousCard);
            elements.nextBtn.addEventListener('click', nextCard);
            elements.correctBtn.addEventListener('click', markCorrect);
            elements.incorrectBtn.addEventListener('click', markIncorrect);
            elements.exitStudyBtn.addEventListener('click', exitStudy);
            elements.studyCard.addEventListener('click', flipCard);
            elements.studyCard.addEventListener('keypress', (e) => {
                if (e.key === ' ') {
                    e.preventDefault();
                    flipCard();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (!state.studyMode) return;
                if (e.key === 'Enter') markCorrect();
                if (e.key === 'n' || e.key === 'N') markIncorrect();
                if (e.key === 'Escape') exitStudy();
                if (e.key === 'ArrowLeft') previousCard();
                if (e.key === 'ArrowRight') nextCard();
            });

            // Contrast toggle
            elements.contrastToggle.addEventListener('click', toggleContrast);

            // Share button
            elements.shareBtn.addEventListener('click', shareDeck);

            // Reset stats
            elements.resetStatsBtn.addEventListener('click', resetStats);

            // Auto-save on input
            elements.cardQuestion.addEventListener('input', scheduleAutoSave);
            elements.cardAnswer.addEventListener('input', scheduleAutoSave);
        }

        function switchTab(tabName) {
            elements.tabs.forEach(tab => tab.classList.remove('active'));
            elements.tabContents.forEach(content => content.classList.remove('active'));

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'study') {
                renderStudyMode();
            }
        }

        function createDeck() {
            const name = elements.deckName.value.trim();
            const nameError = document.getElementById('deckNameError');

            nameError.textContent = '';

            if (!name) {
                nameError.textContent = 'Deck name is required';
                return;
            }

            if (state.decks.some(d => d.name === name)) {
                nameError.textContent = 'Deck name already exists';
                return;
            }

            const newDeck = {
                id: Date.now(),
                name,
                cards: [],
                stats: { correct: 0, total: 0, streak: 0 }
            };

            state.decks.push(newDeck);
            state.currentDeck = newDeck;
            elements.deckName.value = '';
            saveToLocalStorage();
            render();
            showToast('Deck created!');
        }

        function selectDeck(deckId) {
            state.currentDeck = state.decks.find(d => d.id === deckId);
            switchTab('new-deck');
            render();
        }

        function deleteDeck(deckId) {
            if (!confirm('Delete this deck? This cannot be undone.')) return;

            state.decks = state.decks.filter(d => d.id !== deckId);
            if (state.currentDeck?.id === deckId) {
                state.currentDeck = null;
            }
            saveToLocalStorage();
            render();
            showToast('Deck deleted');
        }

        function addCard() {
            if (!state.currentDeck) return;

            const question = elements.cardQuestion.value.trim();
            const answer = elements.cardAnswer.value.trim();
            const questionError = document.getElementById('questionError');
            const answerError = document.getElementById('answerError');

            questionError.textContent = '';
            answerError.textContent = '';

            if (!question) {
                questionError.textContent = 'Question is required';
                return;
            }

            if (!answer) {
                answerError.textContent = 'Answer is required';
                return;
            }

            if (state.currentDeck.cards.length >= 50) {
                showToast('Maximum 50 cards per deck', 'warning');
                return;
            }

            const newCard = {
                id: Date.now(),
                question,
                answer,
                correct: 0,
                incorrect: 0,
                flipped: false
            };

            state.currentDeck.cards.push(newCard);
            state.currentDeck.stats.total++;
            elements.cardQuestion.value = '';
            elements.cardAnswer.value = '';
            saveToLocalStorage();
            render();
            showToast('Card added!');
        }

        function editCard(cardId) {
            const card = state.currentDeck.cards.find(c => c.id === cardId);
            if (!card) return;

            elements.cardQuestion.value = card.question;
            elements.cardAnswer.value = card.answer;
            deleteCard(cardId);
            elements.cardQuestion.focus();
        }

        function deleteCard(cardId) {
            if (!confirm('Delete this card?')) return;

            state.currentDeck.cards = state.currentDeck.cards.filter(c => c.id !== cardId);
            state.currentDeck.stats.total--;
            saveToLocalStorage();
            render();
            showToast('Card deleted');
        }

        function startStudy(deckId) {
            state.currentDeck = state.decks.find(d => d.id === deckId);
            state.studyMode = true;
            state.currentCardIndex = 0;
            switchTab('study');
            render();
        }

        function exitStudy() {
            state.studyMode = false;
            state.currentCardIndex = 0;
            switchTab('decks');
            render();
        }

        function flipCard() {
            const card = state.currentDeck.cards[state.currentCardIndex];
            if (card) {
                card.flipped = !card.flipped;
                render();
            }
        }

        function nextCard() {
            if (state.currentCardIndex < state.currentDeck.cards.length - 1) {
                state.currentCardIndex++;
                state.currentDeck.cards[state.currentCardIndex].flipped = false;
                render();
            }
        }

        function previousCard() {
            if (state.currentCardIndex > 0) {
                state.currentCardIndex--;
                state.currentDeck.cards[state.currentCardIndex].flipped = false;
                render();
            }
        }

        function markCorrect() {
            const card = state.currentDeck.cards[state.currentCardIndex];
            if (card) {
                card.correct++;
                state.currentDeck.stats.correct++;
                state.currentDeck.stats.streak++;
                saveToLocalStorage();
                showToast('‚úì Correct!', 'success');
                nextCard();
            }
        }

        function markIncorrect() {
            const card = state.currentDeck.cards[state.currentCardIndex];
            if (card) {
                card.incorrect++;
                state.currentDeck.stats.streak = 0;
                saveToLocalStorage();
                showToast('‚úó Incorrect', 'danger');
                nextCard();
            }
        }

        function resetStats() {
            if (!confirm('Reset all statistics for this deck?')) return;

            state.currentDeck.cards.forEach(card => {
                card.correct = 0;
                card.incorrect = 0;
            });
            state.currentDeck.stats = { correct: 0, total: state.currentDeck.cards.length, streak: 0 };
            saveToLocalStorage();
            render();
            showToast('Stats reset');
        }

        function renderStudyMode() {
            if (!state.currentDeck || state.currentDeck.cards.length === 0) {
                elements.studyMode.style.display = 'none';
                elements.studySelectDeck.style.display = 'block';
                return;
            }

            elements.studyMode.style.display = 'block';
            elements.studySelectDeck.style.display = 'none';

            const card = state.currentDeck.cards[state.currentCardIndex];
            const progress = ((state.currentCardIndex + 1) / state.currentDeck.cards.length) * 100;

            elements.studyDeckName.textContent = state.currentDeck.name;
            elements.studyProgress.style.width = progress + '%';
            elements.studyProgressText.textContent = `Card ${state.currentCardIndex + 1} of ${state.currentDeck.cards.length}`;
            elements.cardCounter.textContent = `${state.currentCardIndex + 1} / ${state.currentDeck.cards.length}`;

            if (card) {
                elements.cardContent.textContent = card.flipped ? card.answer : card.question;
                elements.studyCard.setAttribute('aria-label', `Flashcard - ${card.flipped ? 'Answer' : 'Question'}: ${card.flipped ? card.answer : card.question}`);
                elements.studyCard.classList.toggle('flipped', card.flipped);
            }

            elements.prevBtn.disabled = state.currentCardIndex === 0;
            elements.nextBtn.disabled = state.currentCardIndex === state.currentDeck.cards.length - 1;
        }

        function render() {
            if (state.studyMode) {
                renderStudyMode();
            } else {
                renderDecks();
                renderCurrentDeck();
            }
        }

        function renderDecks() {
            elements.deckList.innerHTML = '';

            if (state.decks.length === 0) {
                elements.emptyDecks.style.display = 'block';
                return;
            }

            elements.emptyDecks.style.display = 'none';

            state.decks.forEach(deck => {
                const masteryPercent = deck.stats.total > 0 ? Math.round((deck.stats.correct / deck.stats.total) * 100) : 0;
                const deckEl = document.createElement('div');
                deckEl.className = 'deck-card';
                deckEl.innerHTML = `
                    <h3>${escapeHtml(deck.name)}</h3>
                    <p>${deck.cards.length} card${deck.cards.length !== 1 ? 's' : ''} ‚Ä¢ ${masteryPercent}% mastery</p>
                    <div class="deck-actions">
                        <button class="success" onclick="startStudy(${deck.id})" aria-label="Start studying ${deck.name}">Study</button>
                        <button onclick="selectDeck(${deck.id})" aria-label="Edit ${deck.name}">Edit</button>
                        <button class="danger" onclick="deleteDeck(${deck.id})" aria-label="Delete ${deck.name}">Delete</button>
                    </div>
                `;
                elements.deckList.appendChild(deckEl);
            });
        }

        function renderCurrentDeck() {
            if (!state.currentDeck) {
                elements.currentDeckSection.style.display = 'none';
                return;
            }

            elements.currentDeckSection.style.display = 'block';
            elements.currentDeckTitle.textContent = escapeHtml(state.currentDeck.name);

            const masteryPercent = state.currentDeck.stats.total > 0 ? Math.round((state.currentDeck.stats.correct / state.currentDeck.stats.total) * 100) : 0;
            elements.deckSize.textContent = state.currentDeck.cards.length;
            elements.masteryPercent.textContent = masteryPercent + '%';
            elements.streakCount.textContent = state.currentDeck.stats.streak;

            elements.cardsGrid.innerHTML = '';

            if (state.currentDeck.cards.length === 0) {
                elements.emptyCards.style.display = 'block';
                return;
            }

            elements.emptyCards.style.display = 'none';

            state.currentDeck.cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card-item';
                const total = card.correct + card.incorrect;
                const accuracy = total > 0 ? Math.round((card.correct / total) * 100) : 0;
                cardEl.innerHTML = `
                    <h4>${escapeHtml(card.question)}</h4>
                    <p>${escapeHtml(card.answer)}</p>
                    <p style="font-size: 12px; color: var(--text-light);">${card.correct}‚úì ${card.incorrect}‚úó (${accuracy}%)</p>
                    <div class="card-item-actions">
                        <button onclick="editCard(${card.id})" aria-label="Edit card">Edit</button>
                        <button class="danger" onclick="deleteCard(${card.id})" aria-label="Delete card">Delete</button>
                    </div>
                `;
                elements.cardsGrid.appendChild(cardEl);
            });
        }

        function saveToLocalStorage() {
            localStorage.setItem('flashcardForgeDecks', JSON.stringify(state.decks));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('flashcardForgeDecks');
            if (saved) {
                try {
                    state.decks = JSON.parse(saved);
                } catch (e) {
                    console.error('Failed to load decks', e);
                }
            }
        }

        function scheduleAutoSave() {
            clearTimeout(state.autoSaveTimer);
            state.autoSaveTimer = setTimeout(() => {
                saveToLocalStorage();
            }, 5 * 60 * 1000); // 5 minutes
        }

        function encodeToHash() {
            if (!state.currentDeck) return;

            const deckData = {
                name: state.currentDeck.name,
                cards: state.currentDeck.cards.map(c => ({
                    question: c.question,
                    answer: c.answer
                }))
            };

            const encoded = btoa(JSON.stringify(deckData));
            const url = window.location.origin + window.location.pathname + '#' + encoded;
            return url;
        }

        function parseUrlHash() {
            const hash = window.location.hash.slice(1);
            if (!hash) return;

            try {
                const decoded = JSON.parse(atob(hash));
                if (decoded.name && decoded.cards) {
                    const newDeck = {
                        id: Date.now(),
                        name: decoded.name + ' (Shared)',
                        cards: decoded.cards.map(c => ({
                            id: Date.now() + Math.random(),
                            question: c.question,
                            answer: c.answer,
                            correct: 0,
                            incorrect: 0,
                            flipped: false
                        })),
                        stats: { correct: 0, total: decoded.cards.length, streak: 0 }
                    };

                    if (!state.decks.some(d => d.name === newDeck.name)) {
                        state.decks.push(newDeck);
                        saveToLocalStorage();
                        showToast('Shared deck imported!');
                    }
                }
            } catch (e) {
                console.error('Failed to parse shared deck', e);
            }

            window.location.hash = '';
        }

        function shareDeck() {
            if (!state.currentDeck) {
                showToast('Select a deck to share', 'warning');
                return;
            }

            const url = encodeToHash();
            navigator.clipboard.writeText(url).then(() => {
                showToast('Deck link copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy link', 'danger');
            });
        }

        function toggleContrast() {
            document.body.classList.toggle('high-contrast');
            const isHighContrast = document.body.classList.contains('high-contrast');
            localStorage.setItem('flashcardForgeContrast', isHighContrast);
        }

        function loadContrastPreference() {
            const saved = localStorage.getItem('flashcardForgeContrast');
            if (saved === 'true') {
                document.body.classList.add('high-contrast');
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            if (type === 'danger') toast.style.backgroundColor = 'var(--danger)';
            if (type === 'warning') toast.style.backgroundColor = 'var(--warning)';
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize app
        init();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            const swCode = `
                self.addEventListener('install', (e) => {
                    e.waitUntil(caches.open('flashcard-forge-v1').then((cache) => {
                        return cache.addAll(['/']);
                    }));
                });

                self.addEventListener('fetch', (e) => {
                    e.respondWith(caches.match(e.request).then((response) => {
                        return response || fetch(e.request);
                    }));
                });
            `;

            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swUrl).catch(() => {
                // Service worker registration failed, app still works offline with localStorage
            });
        }
    </script>
</body>
</html>